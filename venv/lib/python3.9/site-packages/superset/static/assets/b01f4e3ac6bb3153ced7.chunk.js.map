{"version":3,"file":"b01f4e3ac6bb3153ced7.chunk.js","mappings":"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","sources":["webpack://superset/./plugins/plugin-chart-echarts/src/Waterfall/EchartsWaterfall.tsx","webpack://superset/./plugins/plugin-chart-echarts/src/components/Echart.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport Echart from '../components/Echart';\nimport { WaterfallChartTransformedProps } from './types';\nimport { EventHandlers } from '../types';\n\nexport default function EchartsWaterfall(\n  props: WaterfallChartTransformedProps,\n) {\n  const { height, width, echartOptions, refs, onLegendStateChanged } = props;\n\n  const eventHandlers: EventHandlers = {\n    legendselectchanged: payload => {\n      onLegendStateChanged?.(payload.selected);\n    },\n    legendselectall: payload => {\n      onLegendStateChanged?.(payload.selected);\n    },\n    legendinverseselect: payload => {\n      onLegendStateChanged?.(payload.selected);\n    },\n  };\n\n  return (\n    <Echart\n      refs={refs}\n      height={height}\n      width={width}\n      echartOptions={echartOptions}\n      eventHandlers={eventHandlers}\n    />\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  useRef,\n  useEffect,\n  useMemo,\n  forwardRef,\n  useImperativeHandle,\n  useLayoutEffect,\n  useCallback,\n  Ref,\n} from 'react';\n\nimport { styled } from '@superset-ui/core';\nimport { use, init, EChartsType } from 'echarts/core';\nimport {\n  SankeyChart,\n  PieChart,\n  BarChart,\n  FunnelChart,\n  GaugeChart,\n  GraphChart,\n  LineChart,\n  ScatterChart,\n  RadarChart,\n  BoxplotChart,\n  TreeChart,\n  TreemapChart,\n  HeatmapChart,\n  SunburstChart,\n} from 'echarts/charts';\nimport { CanvasRenderer } from 'echarts/renderers';\nimport {\n  TooltipComponent,\n  GridComponent,\n  VisualMapComponent,\n  LegendComponent,\n  DataZoomComponent,\n  ToolboxComponent,\n  GraphicComponent,\n  AriaComponent,\n  MarkAreaComponent,\n  MarkLineComponent,\n} from 'echarts/components';\nimport { LabelLayout } from 'echarts/features';\nimport { EchartsHandler, EchartsProps, EchartsStylesProps } from '../types';\n\nconst Styles = styled.div<EchartsStylesProps>`\n  height: ${({ height }) => height};\n  width: ${({ width }) => width};\n`;\n\nuse([\n  CanvasRenderer,\n  BarChart,\n  BoxplotChart,\n  FunnelChart,\n  GaugeChart,\n  GraphChart,\n  HeatmapChart,\n  LineChart,\n  PieChart,\n  RadarChart,\n  SankeyChart,\n  ScatterChart,\n  SunburstChart,\n  TreeChart,\n  TreemapChart,\n  AriaComponent,\n  DataZoomComponent,\n  GraphicComponent,\n  GridComponent,\n  MarkAreaComponent,\n  MarkLineComponent,\n  LegendComponent,\n  ToolboxComponent,\n  TooltipComponent,\n  VisualMapComponent,\n  LabelLayout,\n]);\n\nfunction Echart(\n  {\n    width,\n    height,\n    echartOptions,\n    eventHandlers,\n    zrEventHandlers,\n    selectedValues = {},\n    refs,\n  }: EchartsProps,\n  ref: Ref<EchartsHandler>,\n) {\n  const divRef = useRef<HTMLDivElement>(null);\n  if (refs) {\n    // eslint-disable-next-line no-param-reassign\n    refs.divRef = divRef;\n  }\n  const chartRef = useRef<EChartsType>();\n  const currentSelection = useMemo(\n    () => Object.keys(selectedValues) || [],\n    [selectedValues],\n  );\n  const previousSelection = useRef<string[]>([]);\n\n  useImperativeHandle(ref, () => ({\n    getEchartInstance: () => chartRef.current,\n  }));\n\n  useEffect(() => {\n    if (!divRef.current) return;\n    if (!chartRef.current) {\n      chartRef.current = init(divRef.current);\n    }\n\n    Object.entries(eventHandlers || {}).forEach(([name, handler]) => {\n      chartRef.current?.off(name);\n      chartRef.current?.on(name, handler);\n    });\n\n    Object.entries(zrEventHandlers || {}).forEach(([name, handler]) => {\n      chartRef.current?.getZr().off(name);\n      chartRef.current?.getZr().on(name, handler);\n    });\n\n    chartRef.current.setOption(echartOptions, true);\n  }, [echartOptions, eventHandlers, zrEventHandlers]);\n\n  // highlighting\n  useEffect(() => {\n    if (!chartRef.current) return;\n    chartRef.current.dispatchAction({\n      type: 'downplay',\n      dataIndex: previousSelection.current.filter(\n        value => !currentSelection.includes(value),\n      ),\n    });\n    if (currentSelection.length) {\n      chartRef.current.dispatchAction({\n        type: 'highlight',\n        dataIndex: currentSelection,\n      });\n    }\n    previousSelection.current = currentSelection;\n  }, [currentSelection]);\n\n  const handleSizeChange = useCallback(\n    ({ width, height }: { width: number; height: number }) => {\n      if (chartRef.current) {\n        chartRef.current.resize({ width, height });\n      }\n    },\n    [],\n  );\n\n  // did mount\n  useEffect(() => {\n    handleSizeChange({ width, height });\n    return () => chartRef.current?.dispose();\n  }, []);\n\n  useLayoutEffect(() => {\n    handleSizeChange({ width, height });\n  }, [width, height, handleSizeChange]);\n\n  return <Styles ref={divRef} height={height} width={width} />;\n}\n\nexport default forwardRef(Echart);\n"],"names":["EchartsWaterfall","props","height","width","echartOptions","refs","onLegendStateChanged","eventHandlers","legendselectchanged","payload","selected","legendselectall","legendinverseselect","_jsx","Echart","Styles","styled","div","zrEventHandlers","selectedValues","ref","divRef","useRef","chartRef","currentSelection","useMemo","Object","keys","previousSelection","useImperativeHandle","getEchartInstance","current","useEffect","init","entries","forEach","name","handler","_chartRef$current","_chartRef$current2","off","on","_chartRef$current3","_chartRef$current4","getZr","setOption","dispatchAction","type","dataIndex","filter","value","includes","length","handleSizeChange","useCallback","resize","_chartRef$current5","dispose","useLayoutEffect","use","CanvasRenderer","BarChart","BoxplotChart","FunnelChart","GaugeChart","GraphChart","HeatmapChart","LineChart","PieChart","RadarChart","SankeyChart","ScatterChart","SunburstChart","TreeChart","TreemapChart","AriaComponent","DataZoomComponent","GraphicComponent","GridComponent","MarkAreaComponent","MarkLineComponent","LegendComponent","ToolboxComponent","TooltipComponent","VisualMapComponent","LabelLayout","forwardRef"],"sourceRoot":""}
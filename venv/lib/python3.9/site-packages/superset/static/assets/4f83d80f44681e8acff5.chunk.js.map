{"version":3,"file":"4f83d80f44681e8acff5.chunk.js","mappings":"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","sources":["webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils/explore.ts","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils/safeStringify.ts","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/layers/index.ts","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/Multi/Multi.tsx","webpack://superset/../../../src/arc-layer/arc-layer-vertex.glsl.ts","webpack://superset/../../../src/arc-layer/arc-layer.ts","webpack://superset/../../../src/arc-layer/arc-layer-fragment.glsl.ts","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/layers/Arc/Arc.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/layers/Contour/Contour.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/layers/Geojson/Geojson.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/layers/Grid/Grid.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/layers/Heatmap/Heatmap.tsx","webpack://superset/./node_modules/d3-hexbin/src/hexbin.js","webpack://superset/../../../src/hexagon-layer/hexagon-layer.ts","webpack://superset/../../../src/hexagon-layer/hexagon-aggregator.js","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/layers/Hex/Hex.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/layers/Path/Path.tsx","webpack://superset/../../../src/polygon-layer/polygon-layer.ts","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils.ts","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils/getPointsFromPolygon.ts","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/layers/Polygon/Polygon.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils/geo.ts","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/layers/Scatter/Scatter.tsx","webpack://superset/../../../src/screen-grid-layer/screen-grid-layer-vertex.glsl.ts","webpack://superset/../../../src/screen-grid-layer/screen-grid-cell-layer.ts","webpack://superset/../../../src/screen-grid-layer/screen-grid-layer-fragment.glsl.ts","webpack://superset/../../../src/screen-grid-layer/screen-grid-layer.ts","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/layers/Screengrid/Screengrid.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport URI from 'urijs';\nimport { JsonObject } from '@superset-ui/core';\nimport { safeStringify } from './safeStringify';\n\nconst MAX_URL_LENGTH = 8000;\n\nexport function getURIDirectory(endpointType = 'base') {\n  // Building the directory part of the URI\n  let directory = '/explore/';\n  if (['json', 'csv', 'query', 'results', 'samples'].includes(endpointType)) {\n    directory = '/superset/explore_json/';\n  }\n\n  return directory;\n}\n\nexport function getExploreLongUrl(\n  formData: JsonObject,\n  endpointType: string,\n  allowOverflow = true,\n  extraSearch = {},\n): string | undefined {\n  if (!formData.datasource) {\n    return undefined;\n  }\n\n  const uri = new URI('/');\n  const directory = getURIDirectory(endpointType);\n  const search = uri.search(true);\n  Object.keys(extraSearch).forEach(key => {\n    search[key] = extraSearch[key];\n  });\n  search.form_data = safeStringify(formData);\n  if (endpointType === 'standalone') {\n    search.standalone = 'true';\n  }\n  const url = uri.directory(directory).search(search).toString();\n  if (!allowOverflow && url.length > MAX_URL_LENGTH) {\n    const minimalFormData = {\n      datasource: formData.datasource,\n      viz_type: formData.viz_type,\n    };\n\n    return getExploreLongUrl(minimalFormData, endpointType, false, {\n      URL_IS_TOO_LONG_TO_SHARE: null,\n    });\n  }\n\n  return url;\n}\n","/* eslint-disable consistent-return */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { JsonObject } from '@superset-ui/core';\n\n/**\n * A Stringify function that will not crash when it runs into circular JSON references,\n * unlike JSON.stringify. Any circular references are simply omitted, as if there had\n * been no data present\n * @param object any JSON object to be stringified\n */\n\n// eslint-disable-next-line import/prefer-default-export\nexport function safeStringify(object: JsonObject) {\n  const cache = new Set();\n\n  return JSON.stringify(object, (key, value) => {\n    if (typeof value === 'object' && value !== null) {\n      if (cache.has(value)) {\n        // We've seen this object before\n        try {\n          // Quick deep copy to duplicate if this is a repeat rather than a circle.\n          return JSON.parse(JSON.stringify(value));\n        } catch (error) {\n          // Discard key if value cannot be duplicated.\n          return;\n        }\n      }\n      // Store the value in our cache.\n      cache.add(value);\n    }\n\n    return value;\n  });\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport { getLayer as deck_grid } from './Grid/Grid';\nimport { getLayer as deck_screengrid } from './Screengrid/Screengrid';\nimport { getLayer as deck_path } from './Path/Path';\nimport { getLayer as deck_hex } from './Hex/Hex';\nimport { getLayer as deck_scatter } from './Scatter/Scatter';\nimport { getLayer as deck_geojson } from './Geojson/Geojson';\nimport { getLayer as deck_arc } from './Arc/Arc';\nimport { getLayer as deck_polygon } from './Polygon/Polygon';\nimport { getLayer as deck_heatmap } from './Heatmap/Heatmap';\nimport { getLayer as deck_contour } from './Contour/Contour';\n\nconst layerGenerators = {\n  deck_grid,\n  deck_screengrid,\n  deck_path,\n  deck_hex,\n  deck_scatter,\n  deck_geojson,\n  deck_arc,\n  deck_polygon,\n  deck_heatmap,\n  deck_contour,\n};\n\nexport default layerGenerators;\n","/* eslint-disable react/jsx-handler-names */\n/* eslint-disable react/no-access-state-in-setstate */\n/* eslint-disable camelcase */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { memo, useCallback, useEffect, useRef, useState } from 'react';\nimport { isEqual } from 'lodash';\nimport {\n  Datasource,\n  HandlerFunction,\n  JsonObject,\n  JsonValue,\n  QueryFormData,\n  SupersetClient,\n  usePrevious,\n} from '@superset-ui/core';\nimport { Layer } from 'deck.gl/typed';\n\nimport {\n  DeckGLContainerHandle,\n  DeckGLContainerStyledWrapper,\n} from '../DeckGLContainer';\nimport { getExploreLongUrl } from '../utils/explore';\nimport layerGenerators from '../layers';\nimport { Viewport } from '../utils/fitViewport';\nimport { TooltipProps } from '../components/Tooltip';\n\nexport type DeckMultiProps = {\n  formData: QueryFormData;\n  payload: JsonObject;\n  setControlValue: (control: string, value: JsonValue) => void;\n  viewport: Viewport;\n  onAddFilter: HandlerFunction;\n  height: number;\n  width: number;\n  datasource: Datasource;\n  onSelect: () => void;\n};\n\nconst DeckMulti = (props: DeckMultiProps) => {\n  const containerRef = useRef<DeckGLContainerHandle>();\n\n  const [viewport, setViewport] = useState<Viewport>();\n  const [subSlicesLayers, setSubSlicesLayers] = useState<Record<number, Layer>>(\n    {},\n  );\n\n  const setTooltip = useCallback((tooltip: TooltipProps['tooltip']) => {\n    const { current } = containerRef;\n    if (current) {\n      current.setTooltip(tooltip);\n    }\n  }, []);\n\n  const loadLayers = useCallback(\n    (formData: QueryFormData, payload: JsonObject, viewport?: Viewport) => {\n      setViewport(viewport);\n      setSubSlicesLayers({});\n      payload.data.slices.forEach(\n        (subslice: { slice_id: number } & JsonObject) => {\n          // Filters applied to multi_deck are passed down to underlying charts\n          // note that dashboard contextual information (filter_immune_slices and such) aren't\n          // taken into consideration here\n          const filters = [\n            ...(subslice.form_data.filters || []),\n            ...(formData.filters || []),\n            ...(formData.extra_filters || []),\n          ];\n          const subsliceCopy = {\n            ...subslice,\n            form_data: {\n              ...subslice.form_data,\n              filters,\n            },\n          };\n\n          const url = getExploreLongUrl(subsliceCopy.form_data, 'json');\n\n          if (url) {\n            SupersetClient.get({\n              endpoint: url,\n            })\n              .then(({ json }) => {\n                const layer = layerGenerators[subsliceCopy.form_data.viz_type](\n                  subsliceCopy.form_data,\n                  json,\n                  props.onAddFilter,\n                  setTooltip,\n                  props.datasource,\n                  [],\n                  props.onSelect,\n                );\n                setSubSlicesLayers(subSlicesLayers => ({\n                  ...subSlicesLayers,\n                  [subsliceCopy.slice_id]: layer,\n                }));\n              })\n              .catch(() => {});\n          }\n        },\n      );\n    },\n    [props.datasource, props.onAddFilter, props.onSelect, setTooltip],\n  );\n\n  const prevDeckSlices = usePrevious(props.formData.deck_slices);\n  useEffect(() => {\n    const { formData, payload } = props;\n    const hasChanges = !isEqual(prevDeckSlices, formData.deck_slices);\n    if (hasChanges) {\n      loadLayers(formData, payload);\n    }\n  }, [loadLayers, prevDeckSlices, props]);\n\n  const { payload, formData, setControlValue, height, width } = props;\n  const layers = Object.values(subSlicesLayers);\n\n  return (\n    <DeckGLContainerStyledWrapper\n      ref={containerRef}\n      mapboxApiAccessToken={payload.data.mapboxApiKey}\n      viewport={viewport || props.viewport}\n      layers={layers}\n      mapStyle={formData.mapbox_style}\n      setControlValue={setControlValue}\n      onViewportChange={setViewport}\n      height={height}\n      width={width}\n    />\n  );\n};\n\nexport default memo(DeckMulti);\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nexport default `\\\n#define SHADER_NAME arc-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceSourcePositions64Low;\nattribute vec3 instanceTargetPositions;\nattribute vec3 instanceTargetPositions64Low;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\nattribute float instanceHeights;\nattribute float instanceTilts;\n\nuniform bool greatCircle;\nuniform bool useShortestPath;\nuniform float numSegments;\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform int widthUnits;\n\nvarying vec4 vColor;\nvarying vec2 uv;\nvarying float isValid;\n\nfloat paraboloid(float distance, float sourceZ, float targetZ, float ratio) {\n  // d: distance on the xy plane\n  // r: ratio of the current point\n  // p: ratio of the peak of the arc\n  // h: height multiplier\n  // z = f(r) = sqrt(r * (p * 2 - r)) * d * h\n  // f(0) = 0\n  // f(1) = dz\n\n  float deltaZ = targetZ - sourceZ;\n  float dh = distance * instanceHeights;\n  if (dh == 0.0) {\n    return sourceZ + deltaZ * ratio;\n  }\n  float unitZ = deltaZ / dh;\n  float p2 = unitZ * unitZ + 1.0;\n\n  // sqrt does not deal with negative values, manually flip source and target if delta.z < 0\n  float dir = step(deltaZ, 0.0);\n  float z0 = mix(sourceZ, targetZ, dir);\n  float r = mix(ratio, 1.0 - ratio, dir);\n  return sqrt(r * (p2 - r)) * dh + z0;\n}\n\n// offset vector by strokeWidth pixels\n// offset_direction is -1 (left) or 1 (right)\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  return dir_screenspace * offset_direction * width / 2.0;\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\n\nvec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {\n  float distance = length(source.xy - target.xy);\n  float z = paraboloid(distance, source.z, target.z, segmentRatio);\n\n  float tiltAngle = radians(instanceTilts);\n  vec2 tiltDirection = normalize(target.xy - source.xy);\n  vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);\n\n  return vec3(\n    mix(source.xy, target.xy, segmentRatio) + tilt,\n    z * cos(tiltAngle)\n  );\n}\n\n/* Great circle interpolation\n * http://www.movable-type.co.uk/scripts/latlong.html\n */\nfloat getAngularDist (vec2 source, vec2 target) {\n  vec2 sourceRadians = radians(source);\n  vec2 targetRadians = radians(target);\n  vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);\n  vec2 shd_sq = sin_half_delta * sin_half_delta;\n\n  float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;\n  return 2.0 * asin(sqrt(a));\n}\n\nvec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {\n  vec2 lngLat;\n\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  if(abs(angularDist - PI) < 0.001) {\n    lngLat = (1.0 - t) * source.xy + t * target.xy;\n  } else {\n    float a = sin((1.0 - t) * angularDist);\n    float b = sin(t * angularDist);\n    vec3 p = source3D.yxz * a + target3D.yxz * b;\n    lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));\n  }\n\n  float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);\n\n  return vec3(lngLat, z);\n}\n\n/* END GREAT CIRCLE */\n\nvoid main(void) {\n  geometry.worldPosition = instanceSourcePositions;\n  geometry.worldPositionAlt = instanceTargetPositions;\n\n  float segmentIndex = positions.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));\n  float nextSegmentRatio = getSegmentRatio(min(numSegments - 1.0, segmentIndex + 1.0));\n\n  // if it's the first point, use next - current as direction\n  // otherwise use current - prev\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  isValid = 1.0;\n\n  uv = vec2(segmentRatio, positions.y);\n  geometry.uv = uv;\n  geometry.pickingColor = instancePickingColors;\n\n  vec4 curr;\n  vec4 next;\n  vec3 source;\n  vec3 target;\n\n  if ((greatCircle || project_uProjectionMode == PROJECTION_MODE_GLOBE) && project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n    source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));\n    target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));\n    float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);\n\n    vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);\n    vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);\n    vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);\n\n    if (abs(currPos.x - prevPos.x) > 180.0) {\n      indexDir = -1.0;\n      isValid = 0.0;\n    } else if (abs(currPos.x - nextPos.x) > 180.0) {\n      indexDir = 1.0;\n      isValid = 0.0;\n    }\n    nextPos = indexDir < 0.0 ? prevPos : nextPos;\n    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;\n\n    if (isValid == 0.0) {\n      // split at the 180th meridian\n      nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;\n      float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);\n      currPos = mix(currPos, nextPos, t);\n      segmentRatio = mix(segmentRatio, nextSegmentRatio, t);\n    }\n\n    vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);\n    vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);\n  \n    curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);\n    next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));\n  \n  } else {\n    vec3 source_world = instanceSourcePositions;\n    vec3 target_world = instanceTargetPositions;\n    if (useShortestPath) {\n      source_world.x = mod(source_world.x + 180., 360.0) - 180.;\n      target_world.x = mod(target_world.x + 180., 360.0) - 180.;\n\n      float deltaLng = target_world.x - source_world.x;\n      if (deltaLng > 180.) target_world.x -= 360.;\n      if (deltaLng < -180.) source_world.x -= 360.;\n    }\n    source = project_position(source_world, instanceSourcePositions64Low);\n    target = project_position(target_world, instanceTargetPositions64Low);\n\n    // common x at longitude=-180\n    float antiMeridianX = 0.0;\n\n    if (useShortestPath) {\n      if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\n        antiMeridianX = -(project_uCoordinateOrigin.x + 180.) / 360. * TILE_SIZE;\n      }\n      float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);\n\n      if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {\n        isValid = 0.0;\n        indexDir = sign(segmentRatio - thresholdRatio);\n        segmentRatio = thresholdRatio;\n      }\n    }\n\n    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;\n    vec3 currPos = interpolateFlat(source, target, segmentRatio);\n    vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);\n\n    if (useShortestPath) {\n      if (nextPos.x < antiMeridianX) {\n        currPos.x += TILE_SIZE;\n        nextPos.x += TILE_SIZE;\n      }\n    }\n\n    curr = project_common_position_to_clipspace(vec4(currPos, 1.0));\n    next = project_common_position_to_clipspace(vec4(nextPos, 1.0));\n    geometry.position = vec4(currPos, 1.0);\n  }\n\n  // Multiply out width and clamp to limits\n  // mercator pixels are interpreted as screen pixels\n  float widthPixels = clamp(\n    project_size_to_pixel(instanceWidths * widthScale, widthUnits),\n    widthMinPixels, widthMaxPixels\n  );\n\n  // extrude\n  vec3 offset = vec3(\n    getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),\n    0.0);\n  DECKGL_FILTER_SIZE(offset, geometry);\n  DECKGL_FILTER_GL_POSITION(curr, geometry);\n  gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);\n  vColor = vec4(color.rgb, color.a * opacity);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n`;\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport {\n  Layer,\n  project32,\n  picking,\n  UNIT,\n  UpdateParameters,\n  LayerProps,\n  LayerDataSource,\n  Unit,\n  AccessorFunction,\n  Position,\n  Accessor,\n  Color,\n  DefaultProps\n} from '@deck.gl/core';\n\nimport GL from '@luma.gl/constants';\nimport {Model, Geometry} from '@luma.gl/core';\n\nimport vs from './arc-layer-vertex.glsl';\nimport fs from './arc-layer-fragment.glsl';\n\nconst DEFAULT_COLOR: [number, number, number, number] = [0, 0, 0, 255];\n\nconst defaultProps: DefaultProps<ArcLayerProps> = {\n  getSourcePosition: {type: 'accessor', value: x => x.sourcePosition},\n  getTargetPosition: {type: 'accessor', value: x => x.targetPosition},\n  getSourceColor: {type: 'accessor', value: DEFAULT_COLOR},\n  getTargetColor: {type: 'accessor', value: DEFAULT_COLOR},\n  getWidth: {type: 'accessor', value: 1},\n  getHeight: {type: 'accessor', value: 1},\n  getTilt: {type: 'accessor', value: 0},\n\n  greatCircle: false,\n\n  widthUnits: 'pixels',\n  widthScale: {type: 'number', value: 1, min: 0},\n  widthMinPixels: {type: 'number', value: 0, min: 0},\n  widthMaxPixels: {type: 'number', value: Number.MAX_SAFE_INTEGER, min: 0}\n};\n\n/** All properties supported by ArcLayer. */\nexport type ArcLayerProps<DataT = any> = _ArcLayerProps<DataT> & LayerProps;\n\n/** Properties added by ArcLayer. */\ntype _ArcLayerProps<DataT> = {\n  data: LayerDataSource<DataT>;\n  /**\n   * If `true`, create the arc along the shortest path on the earth surface.\n   * @default false\n   */\n  greatCircle?: boolean;\n\n  /**\n   * The units of the line width, one of `'meters'`, `'common'`, and `'pixels'`\n   * @default 'pixels'\n   */\n  widthUnits?: Unit;\n\n  /**\n   * The scaling multiplier for the width of each line.\n   * @default 1\n   */\n  widthScale?: number;\n\n  /**\n   * The minimum line width in pixels.\n   * @default 0\n   */\n  widthMinPixels?: number;\n\n  /**\n   * The maximum line width in pixels.\n   * @default Number.MAX_SAFE_INTEGER\n   */\n  widthMaxPixels?: number;\n\n  /**\n   * Method called to retrieve the source position of each object.\n   * @default object => object.sourcePosition\n   */\n  getSourcePosition?: AccessorFunction<DataT, Position>;\n\n  /**\n   * Method called to retrieve the target position of each object.\n   * @default object => object.targetPosition\n   */\n  getTargetPosition?: AccessorFunction<DataT, Position>;\n\n  /**\n   * The rgba color is in the format of `[r, g, b, [a]]`.\n   * @default [0, 0, 0, 255]\n   */\n  getSourceColor?: Accessor<DataT, Color>;\n\n  /**\n   * The rgba color is in the format of `[r, g, b, [a]]`.\n   * @default [0, 0, 0, 255]\n   */\n  getTargetColor?: Accessor<DataT, Color>;\n\n  /**\n   * The line width of each object, in units specified by `widthUnits`.\n   * @default 1\n   */\n  getWidth?: Accessor<DataT, number>;\n\n  /**\n   * Multiplier of layer height. `0` will make the layer flat.\n   * @default 1\n   */\n  getHeight?: Accessor<DataT, number>;\n\n  /**\n   * Use to tilt the arc to the side if you have multiple arcs with the same source and target positions.\n   * @default 0\n   */\n  getTilt?: Accessor<DataT, number>;\n};\n\n/** Render raised arcs joining pairs of source and target coordinates. */\nexport default class ArcLayer<DataT = any, ExtraPropsT extends {} = {}> extends Layer<\n  ExtraPropsT & Required<_ArcLayerProps<DataT>>\n> {\n  static layerName = 'ArcLayer';\n  static defaultProps = defaultProps;\n\n  state!: Layer['state'] & {\n    model?: Model;\n  };\n\n  getBounds(): [number[], number[]] | null {\n    return this.getAttributeManager()?.getBounds([\n      'instanceSourcePositions',\n      'instanceTargetPositions'\n    ]);\n  }\n\n  getShaders() {\n    return super.getShaders({vs, fs, modules: [project32, picking]}); // 'project' module added by default.\n  }\n\n  // This layer has its own wrapLongitude logic\n  get wrapLongitude() {\n    return false;\n  }\n\n  initializeState() {\n    const attributeManager = this.getAttributeManager()!;\n\n    /* eslint-disable max-len */\n    attributeManager.addInstanced({\n      instanceSourcePositions: {\n        size: 3,\n        type: GL.DOUBLE,\n        fp64: this.use64bitPositions(),\n        transition: true,\n        accessor: 'getSourcePosition'\n      },\n      instanceTargetPositions: {\n        size: 3,\n        type: GL.DOUBLE,\n        fp64: this.use64bitPositions(),\n        transition: true,\n        accessor: 'getTargetPosition'\n      },\n      instanceSourceColors: {\n        size: this.props.colorFormat.length,\n        type: GL.UNSIGNED_BYTE,\n        normalized: true,\n        transition: true,\n        accessor: 'getSourceColor',\n        defaultValue: DEFAULT_COLOR\n      },\n      instanceTargetColors: {\n        size: this.props.colorFormat.length,\n        type: GL.UNSIGNED_BYTE,\n        normalized: true,\n        transition: true,\n        accessor: 'getTargetColor',\n        defaultValue: DEFAULT_COLOR\n      },\n      instanceWidths: {\n        size: 1,\n        transition: true,\n        accessor: 'getWidth',\n        defaultValue: 1\n      },\n      instanceHeights: {\n        size: 1,\n        transition: true,\n        accessor: 'getHeight',\n        defaultValue: 1\n      },\n      instanceTilts: {\n        size: 1,\n        transition: true,\n        accessor: 'getTilt',\n        defaultValue: 0\n      }\n    });\n    /* eslint-enable max-len */\n  }\n\n  updateState(opts: UpdateParameters<this>): void {\n    super.updateState(opts);\n    // Re-generate model if geometry changed\n    if (opts.changeFlags.extensionsChanged) {\n      const {gl} = this.context;\n      this.state.model?.delete();\n      this.state.model = this._getModel(gl);\n      this.getAttributeManager()!.invalidateAll();\n    }\n  }\n\n  draw({uniforms}) {\n    const {widthUnits, widthScale, widthMinPixels, widthMaxPixels, greatCircle, wrapLongitude} =\n      this.props;\n\n    this.state.model\n      .setUniforms(uniforms)\n      .setUniforms({\n        greatCircle,\n        widthUnits: UNIT[widthUnits],\n        widthScale,\n        widthMinPixels,\n        widthMaxPixels,\n        useShortestPath: wrapLongitude\n      })\n      .draw();\n  }\n\n  protected _getModel(gl: WebGLRenderingContext): Model {\n    let positions: number[] = [];\n    const NUM_SEGMENTS = 50;\n    /*\n     *  (0, -1)-------------_(1, -1)\n     *       |          _,-\"  |\n     *       o      _,-\"      o\n     *       |  _,-\"          |\n     *   (0, 1)\"-------------(1, 1)\n     */\n    for (let i = 0; i < NUM_SEGMENTS; i++) {\n      positions = positions.concat([i, 1, 0, i, -1, 0]);\n    }\n\n    const model = new Model(gl, {\n      ...this.getShaders(),\n      id: this.props.id,\n      geometry: new Geometry({\n        drawMode: GL.TRIANGLE_STRIP,\n        attributes: {\n          positions: new Float32Array(positions)\n        }\n      }),\n      isInstanced: true\n    });\n\n    model.setUniforms({numSegments: NUM_SEGMENTS});\n\n    return model;\n  }\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nexport default `\\\n#define SHADER_NAME arc-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 uv;\nvarying float isValid;\n\nvoid main(void) {\n  if (isValid == 0.0) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n  geometry.uv = uv;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n`;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ArcLayer } from 'deck.gl/typed';\nimport {\n  HandlerFunction,\n  JsonObject,\n  QueryFormData,\n  t,\n} from '@superset-ui/core';\nimport { commonLayerProps } from '../common';\nimport { createCategoricalDeckGLComponent } from '../../factory';\nimport TooltipRow from '../../TooltipRow';\nimport { TooltipProps } from '../../components/Tooltip';\nimport { Point } from '../../types';\n\nfunction getPoints(data: JsonObject[]) {\n  const points: Point[] = [];\n  data.forEach(d => {\n    points.push(d.sourcePosition);\n    points.push(d.targetPosition);\n  });\n\n  return points;\n}\n\nfunction setTooltipContent(formData: QueryFormData) {\n  return (o: JsonObject) => (\n    <div className=\"deckgl-tooltip\">\n      <TooltipRow\n        label={t('Start (Longitude, Latitude): ')}\n        value={`${o.object?.sourcePosition?.[0]}, ${o.object?.sourcePosition?.[1]}`}\n      />\n      <TooltipRow\n        label={t('End (Longitude, Latitude): ')}\n        value={`${o.object?.targetPosition?.[0]}, ${o.object?.targetPosition?.[1]}`}\n      />\n      {formData.dimension && (\n        <TooltipRow\n          label={`${formData?.dimension}: `}\n          value={`${o.object?.cat_color}`}\n        />\n      )}\n    </div>\n  );\n}\n\nexport function getLayer(\n  fd: QueryFormData,\n  payload: JsonObject,\n  onAddFilter: HandlerFunction,\n  setTooltip: (tooltip: TooltipProps['tooltip']) => void,\n) {\n  const data = payload.data.features;\n  const sc = fd.color_picker;\n  const tc = fd.target_color_picker;\n\n  return new ArcLayer({\n    data,\n    getSourceColor: d =>\n      d.sourceColor || d.color || [sc.r, sc.g, sc.b, 255 * sc.a],\n    getTargetColor: d =>\n      d.targetColor || d.color || [tc.r, tc.g, tc.b, 255 * tc.a],\n    id: `path-layer-${fd.slice_id}` as const,\n    strokeWidth: fd.stroke_width ? fd.stroke_width : 3,\n    ...commonLayerProps(fd, setTooltip, setTooltipContent(fd)),\n  });\n}\n\nexport default createCategoricalDeckGLComponent(getLayer, getPoints);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ContourLayer } from 'deck.gl';\nimport { t } from '@superset-ui/core';\nimport { commonLayerProps } from '../common';\nimport sandboxedEval from '../../utils/sandbox';\nimport { createDeckGLComponent, getLayerType } from '../../factory';\nimport { ColorType } from '../../types';\nimport TooltipRow from '../../TooltipRow';\n\nfunction setTooltipContent(o: any) {\n  return (\n    <div className=\"deckgl-tooltip\">\n      <TooltipRow\n        label={t('Centroid (Longitude and Latitude): ')}\n        value={`(${o?.coordinate[0]}, ${o?.coordinate[1]})`}\n      />\n      <TooltipRow\n        label={t('Threshold: ')}\n        value={`${o?.object?.contour?.threshold}`}\n      />\n    </div>\n  );\n}\nexport const getLayer: getLayerType<unknown> = function (\n  formData,\n  payload,\n  onAddFilter,\n  setTooltip,\n) {\n  const fd = formData;\n  const {\n    aggregation = 'SUM',\n    js_data_mutator: jsFnMutator,\n    contours: rawContours,\n    cellSize = '200',\n  } = fd;\n  let data = payload.data.features;\n\n  const contours = rawContours?.map(\n    (contour: {\n      color: ColorType;\n      lowerThreshold: number;\n      upperThreshold?: number;\n      strokeWidth?: number;\n    }) => {\n      const { lowerThreshold, upperThreshold, color, strokeWidth } = contour;\n      if (upperThreshold) {\n        // Isoband format\n        return {\n          threshold: [lowerThreshold, upperThreshold],\n          color: [color.r, color.g, color.b],\n        };\n      }\n      // Isoline format\n      return {\n        threshold: lowerThreshold,\n        color: [color.r, color.g, color.b],\n        strokeWidth,\n      };\n    },\n  );\n\n  if (jsFnMutator) {\n    // Applying user defined data mutator if defined\n    const jsFnMutatorFunction = sandboxedEval(fd.js_data_mutator);\n    data = jsFnMutatorFunction(data);\n  }\n\n  return new ContourLayer({\n    id: `contourLayer-${fd.slice_id}`,\n    data,\n    contours,\n    cellSize: Number(cellSize || '200'),\n    aggregation: aggregation.toUpperCase(),\n    getPosition: (d: { position: number[]; weight: number }) => d.position,\n    getWeight: (d: { weight: number }) => d.weight || 0,\n    ...commonLayerProps(fd, setTooltip, setTooltipContent),\n  });\n};\n\nfunction getPoints(data: any[]) {\n  return data.map(d => d.position);\n}\n\nexport default createDeckGLComponent(getLayer, getPoints);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { memo, useCallback, useMemo, useRef } from 'react';\nimport { GeoJsonLayer } from 'deck.gl/typed';\nimport geojsonExtent from '@mapbox/geojson-extent';\nimport {\n  HandlerFunction,\n  JsonObject,\n  JsonValue,\n  QueryFormData,\n} from '@superset-ui/core';\n\nimport {\n  DeckGLContainerHandle,\n  DeckGLContainerStyledWrapper,\n} from '../../DeckGLContainer';\nimport { hexToRGB } from '../../utils/colors';\nimport sandboxedEval from '../../utils/sandbox';\nimport { commonLayerProps } from '../common';\nimport TooltipRow from '../../TooltipRow';\nimport fitViewport, { Viewport } from '../../utils/fitViewport';\nimport { TooltipProps } from '../../components/Tooltip';\n\nconst propertyMap = {\n  fillColor: 'fillColor',\n  color: 'fillColor',\n  fill: 'fillColor',\n  'fill-color': 'fillColor',\n  strokeColor: 'strokeColor',\n  'stroke-color': 'strokeColor',\n  'stroke-width': 'strokeWidth',\n};\n\nconst alterProps = (props: JsonObject, propOverrides: JsonObject) => {\n  const newProps: JsonObject = {};\n  Object.keys(props).forEach(k => {\n    if (k in propertyMap) {\n      newProps[propertyMap[k]] = props[k];\n    } else {\n      newProps[k] = props[k];\n    }\n  });\n  if (typeof props.fillColor === 'string') {\n    newProps.fillColor = hexToRGB(props.fillColor);\n  }\n  if (typeof props.strokeColor === 'string') {\n    newProps.strokeColor = hexToRGB(props.strokeColor);\n  }\n\n  return {\n    ...newProps,\n    ...propOverrides,\n  };\n};\nlet features: JsonObject[];\nconst recurseGeoJson = (\n  node: JsonObject,\n  propOverrides: JsonObject,\n  extraProps?: JsonObject,\n) => {\n  if (node?.features) {\n    node.features.forEach((obj: JsonObject) => {\n      recurseGeoJson(obj, propOverrides, node.extraProps || extraProps);\n    });\n  }\n  if (node?.geometry) {\n    const newNode = {\n      ...node,\n      properties: alterProps(node.properties, propOverrides),\n    } as JsonObject;\n    if (!newNode.extraProps) {\n      newNode.extraProps = extraProps;\n    }\n    features.push(newNode);\n  }\n};\n\nfunction setTooltipContent(o: JsonObject) {\n  return (\n    o.object?.extraProps && (\n      <div className=\"deckgl-tooltip\">\n        {Object.keys(o.object.extraProps).map((prop, index) => (\n          <TooltipRow\n            key={`prop-${index}`}\n            label={`${prop}: `}\n            value={`${o.object.extraProps?.[prop]}`}\n          />\n        ))}\n      </div>\n    )\n  );\n}\n\nconst getFillColor = (feature: JsonObject) => feature?.properties?.fillColor;\nconst getLineColor = (feature: JsonObject) => feature?.properties?.strokeColor;\n\nexport function getLayer(\n  formData: QueryFormData,\n  payload: JsonObject,\n  onAddFilter: HandlerFunction,\n  setTooltip: (tooltip: TooltipProps['tooltip']) => void,\n) {\n  const fd = formData;\n  const fc = fd.fill_color_picker;\n  const sc = fd.stroke_color_picker;\n  const fillColor = [fc.r, fc.g, fc.b, 255 * fc.a];\n  const strokeColor = [sc.r, sc.g, sc.b, 255 * sc.a];\n  const propOverrides: JsonObject = {};\n  if (fillColor[3] > 0) {\n    propOverrides.fillColor = fillColor;\n  }\n  if (strokeColor[3] > 0) {\n    propOverrides.strokeColor = strokeColor;\n  }\n\n  features = [];\n  recurseGeoJson(payload.data, propOverrides);\n\n  let jsFnMutator;\n  if (fd.js_data_mutator) {\n    // Applying user defined data mutator if defined\n    jsFnMutator = sandboxedEval(fd.js_data_mutator);\n    features = jsFnMutator(features);\n  }\n\n  return new GeoJsonLayer({\n    id: `geojson-layer-${fd.slice_id}` as const,\n    data: features,\n    extruded: fd.extruded,\n    filled: fd.filled,\n    stroked: fd.stroked,\n    getFillColor,\n    getLineColor,\n    getLineWidth: fd.line_width || 1,\n    pointRadiusScale: fd.point_radius_scale,\n    lineWidthUnits: fd.line_width_unit,\n    ...commonLayerProps(fd, setTooltip, setTooltipContent),\n  });\n}\n\nexport type DeckGLGeoJsonProps = {\n  formData: QueryFormData;\n  payload: JsonObject;\n  setControlValue: (control: string, value: JsonValue) => void;\n  viewport: Viewport;\n  onAddFilter: HandlerFunction;\n  height: number;\n  width: number;\n};\n\nconst DeckGLGeoJson = (props: DeckGLGeoJsonProps) => {\n  const containerRef = useRef<DeckGLContainerHandle>();\n  const setTooltip = useCallback((tooltip: TooltipProps['tooltip']) => {\n    const { current } = containerRef;\n    if (current) {\n      current.setTooltip(tooltip);\n    }\n  }, []);\n\n  const { formData, payload, setControlValue, onAddFilter, height, width } =\n    props;\n\n  const viewport: Viewport = useMemo(() => {\n    if (formData.autozoom) {\n      const points =\n        payload?.data?.features?.reduce?.(\n          (acc: [number, number, number, number][], feature: any) => {\n            const bounds = geojsonExtent(feature);\n            if (bounds) {\n              return [...acc, [bounds[0], bounds[1]], [bounds[2], bounds[3]]];\n            }\n\n            return acc;\n          },\n          [],\n        ) || [];\n\n      if (points.length) {\n        return fitViewport(props.viewport, {\n          width,\n          height,\n          points,\n        });\n      }\n    }\n    return props.viewport;\n  }, [\n    formData.autozoom,\n    height,\n    payload?.data?.features,\n    props.viewport,\n    width,\n  ]);\n\n  const layer = getLayer(formData, payload, onAddFilter, setTooltip);\n\n  return (\n    <DeckGLContainerStyledWrapper\n      ref={containerRef}\n      mapboxApiAccessToken={payload.data.mapboxApiKey}\n      viewport={viewport}\n      layers={[layer]}\n      mapStyle={formData.mapbox_style}\n      setControlValue={setControlValue}\n      height={height}\n      width={width}\n    />\n  );\n};\n\nexport default memo(DeckGLGeoJson);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { Color, GridLayer } from 'deck.gl/typed';\nimport {\n  t,\n  CategoricalColorNamespace,\n  JsonObject,\n  QueryFormData,\n} from '@superset-ui/core';\n\nimport { commonLayerProps, getAggFunc } from '../common';\nimport sandboxedEval from '../../utils/sandbox';\nimport { hexToRGB } from '../../utils/colors';\nimport { createDeckGLComponent } from '../../factory';\nimport TooltipRow from '../../TooltipRow';\nimport { TooltipProps } from '../../components/Tooltip';\n\nfunction setTooltipContent(o: JsonObject) {\n  return (\n    <div className=\"deckgl-tooltip\">\n      <TooltipRow\n        // eslint-disable-next-line prefer-template\n        label={t('Longitude and Latitude') + ': '}\n        value={`${o.coordinate[0]}, ${o.coordinate[1]}`}\n      />\n      <TooltipRow\n        // eslint-disable-next-line prefer-template\n        label={t('Height') + ': '}\n        value={`${o.object.elevationValue}`}\n      />\n    </div>\n  );\n}\n\nexport function getLayer(\n  formData: QueryFormData,\n  payload: JsonObject,\n  onAddFilter: () => void,\n  setTooltip: (tooltip: TooltipProps['tooltip']) => void,\n) {\n  const fd = formData;\n  const appliedScheme = fd.color_scheme;\n  const colorScale = CategoricalColorNamespace.getScale(appliedScheme);\n  const colorRange = colorScale\n    .range()\n    .map(color => hexToRGB(color)) as Color[];\n  let data = payload.data.features;\n\n  if (fd.js_data_mutator) {\n    // Applying user defined data mutator if defined\n    const jsFnMutator = sandboxedEval(fd.js_data_mutator);\n    data = jsFnMutator(data);\n  }\n\n  const aggFunc = getAggFunc(fd.js_agg_function, p => p.weight);\n\n  return new GridLayer({\n    id: `grid-layer-${fd.slice_id}` as const,\n    data,\n    cellSize: fd.grid_size,\n    extruded: fd.extruded,\n    colorRange,\n    outline: false,\n    // @ts-ignore\n    getElevationValue: aggFunc,\n    // @ts-ignore\n    getColorValue: aggFunc,\n    ...commonLayerProps(fd, setTooltip, setTooltipContent),\n  });\n}\n\nfunction getPoints(data: JsonObject[]) {\n  return data.map(d => d.position);\n}\n\nexport default createDeckGLComponent(getLayer, getPoints);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { HeatmapLayer, Position, Color } from 'deck.gl/typed';\nimport { t, getSequentialSchemeRegistry, JsonObject } from '@superset-ui/core';\nimport { commonLayerProps } from '../common';\nimport sandboxedEval from '../../utils/sandbox';\nimport { hexToRGB } from '../../utils/colors';\nimport { createDeckGLComponent, getLayerType } from '../../factory';\nimport TooltipRow from '../../TooltipRow';\n\nfunction setTooltipContent(o: JsonObject) {\n  return (\n    <div className=\"deckgl-tooltip\">\n      <TooltipRow\n        label={t('Centroid (Longitude and Latitude): ')}\n        value={`(${o?.coordinate[0]}, ${o?.coordinate[1]})`}\n      />\n    </div>\n  );\n}\nexport const getLayer: getLayerType<unknown> = (\n  formData,\n  payload,\n  onAddFilter,\n  setTooltip,\n) => {\n  const fd = formData;\n  const {\n    intensity = 1,\n    radius_pixels: radiusPixels = 30,\n    aggregation = 'SUM',\n    js_data_mutator: jsFnMutator,\n    linear_color_scheme: colorScheme,\n  } = fd;\n  let data = payload.data.features;\n\n  if (jsFnMutator) {\n    // Applying user defined data mutator if defined\n    const jsFnMutatorFunction = sandboxedEval(fd.js_data_mutator);\n    data = jsFnMutatorFunction(data);\n  }\n\n  const colorScale = getSequentialSchemeRegistry()\n    ?.get(colorScheme)\n    ?.createLinearScale([0, 6]);\n  const colorRange = colorScale\n    ?.range()\n    ?.map(color => hexToRGB(color))\n    ?.reverse() as Color[];\n\n  return new HeatmapLayer({\n    id: `heatmp-layer-${fd.slice_id}` as const,\n    data,\n    intensity,\n    radiusPixels,\n    colorRange,\n    aggregation: aggregation.toUpperCase(),\n    getPosition: (d: { position: Position; weight: number }) => d.position,\n    getWeight: (d: { position: number[]; weight: number }) =>\n      d.weight ? d.weight : 1,\n    ...commonLayerProps(fd, setTooltip, setTooltipContent),\n  });\n};\n\nfunction getPoints(data: any[]) {\n  return data.map(d => d.position);\n}\n\nexport default createDeckGLComponent(getLayer, getPoints);\n","var thirdPi = Math.PI / 3,\n    angles = [0, thirdPi, 2 * thirdPi, 3 * thirdPi, 4 * thirdPi, 5 * thirdPi];\n\nfunction pointX(d) {\n  return d[0];\n}\n\nfunction pointY(d) {\n  return d[1];\n}\n\nexport default function() {\n  var x0 = 0,\n      y0 = 0,\n      x1 = 1,\n      y1 = 1,\n      x = pointX,\n      y = pointY,\n      r,\n      dx,\n      dy;\n\n  function hexbin(points) {\n    var binsById = {}, bins = [], i, n = points.length;\n\n    for (i = 0; i < n; ++i) {\n      if (isNaN(px = +x.call(null, point = points[i], i, points))\n          || isNaN(py = +y.call(null, point, i, points))) continue;\n\n      var point,\n          px,\n          py,\n          pj = Math.round(py = py / dy),\n          pi = Math.round(px = px / dx - (pj & 1) / 2),\n          py1 = py - pj;\n\n      if (Math.abs(py1) * 3 > 1) {\n        var px1 = px - pi,\n            pi2 = pi + (px < pi ? -1 : 1) / 2,\n            pj2 = pj + (py < pj ? -1 : 1),\n            px2 = px - pi2,\n            py2 = py - pj2;\n        if (px1 * px1 + py1 * py1 > px2 * px2 + py2 * py2) pi = pi2 + (pj & 1 ? 1 : -1) / 2, pj = pj2;\n      }\n\n      var id = pi + \"-\" + pj, bin = binsById[id];\n      if (bin) bin.push(point);\n      else {\n        bins.push(bin = binsById[id] = [point]);\n        bin.x = (pi + (pj & 1) / 2) * dx;\n        bin.y = pj * dy;\n      }\n    }\n\n    return bins;\n  }\n\n  function hexagon(radius) {\n    var x0 = 0, y0 = 0;\n    return angles.map(function(angle) {\n      var x1 = Math.sin(angle) * radius,\n          y1 = -Math.cos(angle) * radius,\n          dx = x1 - x0,\n          dy = y1 - y0;\n      x0 = x1, y0 = y1;\n      return [dx, dy];\n    });\n  }\n\n  hexbin.hexagon = function(radius) {\n    return \"m\" + hexagon(radius == null ? r : +radius).join(\"l\") + \"z\";\n  };\n\n  hexbin.centers = function() {\n    var centers = [],\n        j = Math.round(y0 / dy),\n        i = Math.round(x0 / dx);\n    for (var y = j * dy; y < y1 + r; y += dy, ++j) {\n      for (var x = i * dx + (j & 1) * dx / 2; x < x1 + dx / 2; x += dx) {\n        centers.push([x, y]);\n      }\n    }\n    return centers;\n  };\n\n  hexbin.mesh = function() {\n    var fragment = hexagon(r).slice(0, 4).join(\"l\");\n    return hexbin.centers().map(function(p) { return \"M\" + p + \"m\" + fragment; }).join(\"\");\n  };\n\n  hexbin.x = function(_) {\n    return arguments.length ? (x = _, hexbin) : x;\n  };\n\n  hexbin.y = function(_) {\n    return arguments.length ? (y = _, hexbin) : y;\n  };\n\n  hexbin.radius = function(_) {\n    return arguments.length ? (r = +_, dx = r * 2 * Math.sin(thirdPi), dy = r * 1.5, hexbin) : r;\n  };\n\n  hexbin.size = function(_) {\n    return arguments.length ? (x0 = y0 = 0, x1 = +_[0], y1 = +_[1], hexbin) : [x1 - x0, y1 - y0];\n  };\n\n  hexbin.extent = function(_) {\n    return arguments.length ? (x0 = +_[0][0], y0 = +_[0][1], x1 = +_[1][0], y1 = +_[1][1], hexbin) : [[x0, y0], [x1, y1]];\n  };\n\n  return hexbin.radius(1);\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport {\n  Accessor,\n  AccessorFunction,\n  Color,\n  log,\n  Position,\n  Material,\n  UpdateParameters,\n  DefaultProps\n} from '@deck.gl/core';\nimport {ColumnLayer} from '@deck.gl/layers';\n\nimport {defaultColorRange} from '../utils/color-utils';\n\nimport {pointToHexbin} from './hexagon-aggregator';\nimport CPUAggregator from '../utils/cpu-aggregator';\nimport AggregationLayer, {AggregationLayerProps} from '../aggregation-layer';\n\nimport GL from '@luma.gl/constants';\nimport {AggregateAccessor} from '../types';\n\n// eslint-disable-next-line @typescript-eslint/no-empty-function\nfunction nop() {}\n\nconst defaultProps: DefaultProps<HexagonLayerProps> = {\n  // color\n  colorDomain: null,\n  colorRange: defaultColorRange,\n  getColorValue: {type: 'accessor', value: null}, // default value is calcuated from `getColorWeight` and `colorAggregation`\n  getColorWeight: {type: 'accessor', value: 1},\n  colorAggregation: 'SUM',\n  lowerPercentile: {type: 'number', value: 0, min: 0, max: 100},\n  upperPercentile: {type: 'number', value: 100, min: 0, max: 100},\n  colorScaleType: 'quantize',\n  onSetColorDomain: nop,\n\n  // elevation\n  elevationDomain: null,\n  elevationRange: [0, 1000],\n  getElevationValue: {type: 'accessor', value: null}, // default value is calcuated from `getElevationWeight` and `elevationAggregation`\n  getElevationWeight: {type: 'accessor', value: 1},\n  elevationAggregation: 'SUM',\n  elevationLowerPercentile: {type: 'number', value: 0, min: 0, max: 100},\n  elevationUpperPercentile: {type: 'number', value: 100, min: 0, max: 100},\n  elevationScale: {type: 'number', min: 0, value: 1},\n  elevationScaleType: 'linear',\n  onSetElevationDomain: nop,\n\n  radius: {type: 'number', value: 1000, min: 1},\n  coverage: {type: 'number', min: 0, max: 1, value: 1},\n  extruded: false,\n  hexagonAggregator: pointToHexbin,\n  getPosition: {type: 'accessor', value: x => x.position},\n  // Optional material for 'lighting' shader module\n  material: true,\n\n  // data filter\n  _filterData: {type: 'function', value: null, optional: true}\n};\n\n/** All properties supported by by HexagonLayer. */\nexport type HexagonLayerProps<DataT = any> = _HexagonLayerProps<DataT> &\n  AggregationLayerProps<DataT>;\n\n/** Properties added by HexagonLayer. */\ntype _HexagonLayerProps<DataT = any> = {\n  /**\n   * Radius of hexagon bin in meters. The hexagons are pointy-topped (rather than flat-topped).\n   * @default 1000\n   */\n  radius?: number;\n\n  /**\n   * Function to aggregate data into hexagonal bins.\n   * @default d3-hexbin\n   */\n  hexagonAggregator?: (props: any, params: any) => any;\n\n  /**\n   * Color scale input domain.\n   * @default [min(colorWeight), max(colorWeight)]\n   */\n  colorDomain?: [number, number] | null;\n\n  /**\n   * Specified as an array of colors [color1, color2, ...].\n   * @default `6-class YlOrRd` - [colorbrewer](http://colorbrewer2.org/#type=sequential&scheme=YlOrRd&n=6)\n   */\n  colorRange?: Color[];\n\n  /**\n   * Hexagon radius multiplier, clamped between 0 - 1.\n   * @default 1\n   */\n  coverage?: number;\n\n  /**\n   * Elevation scale input domain. The elevation scale is a linear scale that maps number of counts to elevation.\n   * @default [0, max(elevationWeight)]\n   */\n  elevationDomain?: [number, number] | null;\n\n  /**\n   * Elevation scale output range.\n   * @default [0, 1000]\n   */\n  elevationRange?: [number, number];\n\n  /**\n   * Hexagon elevation multiplier.\n   * @default 1\n   */\n  elevationScale?: number;\n\n  /**\n   * Whether to enable cell elevation. If set to false, all cell will be flat.\n   * @default false\n   */\n  extruded?: boolean;\n\n  /**\n   * Filter bins and re-calculate color by `upperPercentile`.\n   * Hexagons with color value larger than the `upperPercentile` will be hidden.\n   * @default 100\n   */\n  upperPercentile?: number;\n\n  /**\n   * Filter bins and re-calculate color by `lowerPercentile`.\n   * Hexagons with color value smaller than the `lowerPercentile` will be hidden.\n   * @default 0\n   */\n  lowerPercentile?: number;\n\n  /**\n   * Filter bins and re-calculate elevation by `elevationUpperPercentile`.\n   * Hexagons with elevation value larger than the `elevationUpperPercentile` will be hidden.\n   * @default 100\n   */\n  elevationUpperPercentile?: number;\n\n  /**\n   * Filter bins and re-calculate elevation by `elevationLowerPercentile`.\n   * Hexagons with elevation value larger than the `elevationLowerPercentile` will be hidden.\n   * @default 0\n   */\n  elevationLowerPercentile?: number;\n\n  /**\n   * Scaling function used to determine the color of the grid cell, default value is 'quantize'.\n   * Supported Values are 'quantize', 'quantile' and 'ordinal'.\n   * @default 'quantize'\n   */\n  colorScaleType?: 'quantize' | 'quantile' | 'ordinal';\n\n  /**\n   * Scaling function used to determine the elevation of the grid cell, only supports 'linear'.\n   */\n  elevationScaleType?: 'linear';\n\n  /**\n   * Material settings for lighting effect. Applies if `extruded: true`.\n   *\n   * @default true\n   * @see https://deck.gl/docs/developer-guide/using-lighting\n   */\n  material?: Material;\n\n  /**\n   * Defines the operation used to aggregate all data object weights to calculate a cell's color value.\n   * @default 'SUM'\n   */\n  colorAggregation?: 'SUM' | 'MEAN' | 'MIN' | 'MAX';\n\n  /**\n   * Defines the operation used to aggregate all data object weights to calculate a cell's elevation value.\n   * @default 'SUM'\n   */\n  elevationAggregation?: 'SUM' | 'MEAN' | 'MIN' | 'MAX';\n\n  /**\n   * Method called to retrieve the position of each object.\n   * @default object => object.position\n   */\n  getPosition?: AccessorFunction<DataT, Position>;\n\n  /**\n   * The weight of a data object used to calculate the color value for a bin.\n   * @default 1\n   */\n  getColorWeight?: Accessor<DataT, number>;\n\n  /**\n   * After data objects are aggregated into bins, this accessor is called on each cell to get the value that its color is based on.\n   * @default null\n   */\n  getColorValue?: AggregateAccessor<DataT> | null;\n\n  /**\n   * The weight of a data object used to calculate the elevation value for a bin.\n   * @default 1\n   */\n  getElevationWeight?: Accessor<DataT, number>;\n\n  /**\n   * After data objects are aggregated into bins, this accessor is called on each cell to get the value that its elevation is based on.\n   * @default null\n   */\n  getElevationValue?: AggregateAccessor<DataT> | null;\n\n  /**\n   * This callback will be called when cell color domain has been calculated.\n   * @default () => {}\n   */\n  onSetColorDomain?: (minMax: [number, number]) => void;\n\n  /**\n   * This callback will be called when cell elevation domain has been calculated.\n   * @default () => {}\n   */\n  onSetElevationDomain?: (minMax: [number, number]) => void;\n\n  /**\n   * (Experimental) Filter data objects\n   */\n  _filterData: null | ((d: DataT) => boolean);\n};\n\n/** Aggregates data into a hexagon-based heatmap. The color and height of a hexagon are determined based on the objects it contains. */\nexport default class HexagonLayer<DataT, ExtraPropsT extends {} = {}> extends AggregationLayer<\n  DataT,\n  ExtraPropsT & Required<_HexagonLayerProps>\n> {\n  static layerName = 'HexagonLayer';\n  static defaultProps = defaultProps;\n\n  state!: AggregationLayer<DataT>['state'] & {\n    cpuAggregator: CPUAggregator;\n    aggregatorState: any;\n  };\n  initializeState() {\n    const cpuAggregator = new CPUAggregator({\n      getAggregator: props => props.hexagonAggregator,\n      getCellSize: props => props.radius\n    });\n\n    this.state = {\n      cpuAggregator,\n      aggregatorState: cpuAggregator.state,\n      vertices: null\n    };\n    const attributeManager = this.getAttributeManager()!;\n    attributeManager.add({\n      positions: {size: 3, type: GL.DOUBLE, accessor: 'getPosition'}\n    });\n    // color and elevation attributes can't be added as attributes\n    // they are calculated using 'getValue' accessor that takes an array of pints.\n  }\n\n  updateState(opts: UpdateParameters<this>) {\n    super.updateState(opts);\n\n    if (opts.changeFlags.propsOrDataChanged) {\n      const aggregatorState = this.state.cpuAggregator.updateState(opts, {\n        viewport: this.context.viewport,\n        attributes: this.getAttributes()\n      });\n      if (this.state.aggregatorState.layerData !== aggregatorState.layerData) {\n        // if user provided custom aggregator and returns hexagonVertices,\n        // Need to recalculate radius and angle based on vertices\n        const {hexagonVertices} = aggregatorState.layerData || {};\n        this.setState({\n          vertices: hexagonVertices && this.convertLatLngToMeterOffset(hexagonVertices)\n        });\n      }\n\n      this.setState({\n        // make a copy of the internal state of cpuAggregator for testing\n        aggregatorState\n      });\n    }\n  }\n\n  convertLatLngToMeterOffset(hexagonVertices) {\n    const {viewport} = this.context;\n    if (Array.isArray(hexagonVertices) && hexagonVertices.length === 6) {\n      // get centroid of hexagons\n      const vertex0 = hexagonVertices[0];\n      const vertex3 = hexagonVertices[3];\n\n      const centroid = [(vertex0[0] + vertex3[0]) / 2, (vertex0[1] + vertex3[1]) / 2];\n      const centroidFlat = viewport.projectFlat(centroid);\n\n      const {metersPerUnit} = viewport.getDistanceScales(centroid);\n\n      // offset all points by centroid to meter offset\n      const vertices = hexagonVertices.map(vt => {\n        const vtFlat = viewport.projectFlat(vt);\n\n        return [\n          (vtFlat[0] - centroidFlat[0]) * metersPerUnit[0],\n          (vtFlat[1] - centroidFlat[1]) * metersPerUnit[1]\n        ];\n      });\n\n      return vertices;\n    }\n\n    log.error('HexagonLayer: hexagonVertices needs to be an array of 6 points')();\n    return null;\n  }\n\n  getPickingInfo({info}) {\n    return this.state.cpuAggregator.getPickingInfo({info});\n  }\n\n  // create a method for testing\n  _onGetSublayerColor(cell) {\n    return this.state.cpuAggregator.getAccessor('fillColor')(cell);\n  }\n\n  // create a method for testing\n  _onGetSublayerElevation(cell) {\n    return this.state.cpuAggregator.getAccessor('elevation')(cell);\n  }\n\n  _getSublayerUpdateTriggers() {\n    return this.state.cpuAggregator.getUpdateTriggers(this.props);\n  }\n\n  renderLayers() {\n    const {elevationScale, extruded, coverage, material, transitions} = this.props;\n    const {aggregatorState, vertices} = this.state;\n\n    const SubLayerClass = this.getSubLayerClass('hexagon-cell', ColumnLayer);\n    const updateTriggers = this._getSublayerUpdateTriggers();\n\n    const geometry = vertices\n      ? {vertices, radius: 1}\n      : {\n          // default geometry\n          radius: aggregatorState.layerData.radiusCommon || 1,\n          radiusUnits: 'common',\n          angle: 90\n        };\n    return new SubLayerClass(\n      {\n        ...geometry,\n        diskResolution: 6,\n        elevationScale,\n        extruded,\n        coverage,\n        material,\n\n        getFillColor: this._onGetSublayerColor.bind(this),\n        getElevation: this._onGetSublayerElevation.bind(this),\n        transitions: transitions && {\n          getFillColor: transitions.getColorValue || transitions.getColorWeight,\n          getElevation: transitions.getElevationValue || transitions.getElevationWeight\n        }\n      },\n      this.getSubLayerProps({\n        id: 'hexagon-cell',\n        updateTriggers\n      }),\n      {\n        data: aggregatorState.layerData.data\n      }\n    );\n  }\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport {hexbin} from 'd3-hexbin';\nimport {createIterable, log} from '@deck.gl/core';\n\n/**\n * Use d3-hexbin to performs hexagonal binning from geo points to hexagons\n * @param {Iterable} data - array of points\n * @param {Number} radius - hexagon radius in meter\n * @param {function} getPosition - get points lon lat\n * @param {Object} viewport - current viewport object\n\n * @return {Object} - hexagons and countRange\n */\nexport function pointToHexbin(props, aggregationParams) {\n  const {data, radius} = props;\n  const {viewport, attributes} = aggregationParams;\n  // get hexagon radius in mercator world unit\n  const centerLngLat = data.length ? getPointsCenter(data, aggregationParams) : null;\n  const radiusCommon = getRadiusInCommon(radius, viewport, centerLngLat);\n\n  // add world space coordinates to points\n  const screenPoints = [];\n  const {iterable, objectInfo} = createIterable(data);\n  const positions = attributes.positions.value;\n  const {size} = attributes.positions.getAccessor();\n  for (const object of iterable) {\n    objectInfo.index++;\n    const posIndex = objectInfo.index * size;\n    const position = [positions[posIndex], positions[posIndex + 1]];\n    const arrayIsFinite = Number.isFinite(position[0]) && Number.isFinite(position[1]);\n    if (arrayIsFinite) {\n      screenPoints.push({\n        screenCoord: viewport.projectFlat(position),\n        source: object,\n        index: objectInfo.index\n      });\n    } else {\n      log.warn('HexagonLayer: invalid position')();\n    }\n  }\n\n  const newHexbin = hexbin()\n    .radius(radiusCommon)\n    .x(d => d.screenCoord[0])\n    .y(d => d.screenCoord[1]);\n\n  const hexagonBins = newHexbin(screenPoints);\n\n  return {\n    hexagons: hexagonBins.map((hex, index) => ({\n      position: viewport.unprojectFlat([hex.x, hex.y]),\n      points: hex,\n      index\n    })),\n    radiusCommon\n  };\n}\n\n/**\n * Get the bounding box of all data points\n */\nexport function getPointsCenter(data, aggregationParams) {\n  const {attributes} = aggregationParams;\n  const positions = attributes.positions.value;\n  const {size} = attributes.positions.getAccessor();\n\n  let minX = Infinity;\n  let minY = Infinity;\n  let maxX = -Infinity;\n  let maxY = -Infinity;\n  let i;\n\n  for (i = 0; i < size * data.length; i += size) {\n    const x = positions[i];\n    const y = positions[i + 1];\n    const arrayIsFinite = Number.isFinite(x) && Number.isFinite(y);\n\n    if (arrayIsFinite) {\n      minX = Math.min(x, minX);\n      maxX = Math.max(x, maxX);\n      minY = Math.min(y, minY);\n      maxY = Math.max(y, maxY);\n    }\n  }\n\n  // return center\n  return [minX, minY, maxX, maxY].every(Number.isFinite)\n    ? [(minX + maxX) / 2, (minY + maxY) / 2]\n    : null;\n}\n\n/**\n * Get radius in mercator world space coordinates from meter\n * @param {Number} radius - in meter\n * @param {Object} viewport - current viewport object\n * @param {Array<Number>} center - data center\n\n * @return {Number} radius in mercator world spcae coordinates\n */\nexport function getRadiusInCommon(radius, viewport, center) {\n  const {unitsPerMeter} = viewport.getDistanceScales(center);\n  // x, y distance should be the same\n  return radius * unitsPerMeter[0];\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { HexagonLayer, Color } from 'deck.gl/typed';\nimport {\n  t,\n  CategoricalColorNamespace,\n  QueryFormData,\n  JsonObject,\n} from '@superset-ui/core';\n\nimport { commonLayerProps, getAggFunc } from '../common';\nimport sandboxedEval from '../../utils/sandbox';\nimport { hexToRGB } from '../../utils/colors';\nimport { createDeckGLComponent } from '../../factory';\nimport TooltipRow from '../../TooltipRow';\nimport { TooltipProps } from '../../components/Tooltip';\n\nfunction setTooltipContent(o: JsonObject) {\n  return (\n    <div className=\"deckgl-tooltip\">\n      <TooltipRow\n        label={t('Centroid (Longitude and Latitude): ')}\n        value={`(${o.coordinate[0]}, ${o.coordinate[1]})`}\n      />\n      <TooltipRow\n        // eslint-disable-next-line prefer-template\n        label={t('Height') + ': '}\n        value={`${o.object.elevationValue}`}\n      />\n    </div>\n  );\n}\n\nexport function getLayer(\n  formData: QueryFormData,\n  payload: JsonObject,\n  onAddFilter: () => void,\n  setTooltip: (tooltip: TooltipProps['tooltip']) => void,\n) {\n  const fd = formData;\n  const appliedScheme = fd.color_scheme;\n  const colorScale = CategoricalColorNamespace.getScale(appliedScheme);\n  const colorRange = colorScale\n    .range()\n    .map(color => hexToRGB(color)) as Color[];\n  let data = payload.data.features;\n\n  if (fd.js_data_mutator) {\n    // Applying user defined data mutator if defined\n    const jsFnMutator = sandboxedEval(fd.js_data_mutator);\n    data = jsFnMutator(data);\n  }\n  const aggFunc = getAggFunc(fd.js_agg_function, p => p?.weight);\n\n  return new HexagonLayer({\n    id: `hex-layer-${fd.slice_id}` as const,\n    data,\n    radius: fd.grid_size,\n    extruded: fd.extruded,\n    colorRange,\n    outline: false,\n    // @ts-ignore\n    getElevationValue: aggFunc,\n    // @ts-ignore\n    getColorValue: aggFunc,\n    ...commonLayerProps(fd, setTooltip, setTooltipContent),\n  });\n}\n\nfunction getPoints(data: JsonObject[]) {\n  return data.map(d => d.position);\n}\n\nexport default createDeckGLComponent(getLayer, getPoints);\n","/* eslint-disable react/no-array-index-key */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { PathLayer } from 'deck.gl/typed';\nimport { JsonObject, QueryFormData } from '@superset-ui/core';\nimport { commonLayerProps } from '../common';\nimport sandboxedEval from '../../utils/sandbox';\nimport { createDeckGLComponent } from '../../factory';\nimport TooltipRow from '../../TooltipRow';\nimport { TooltipProps } from '../../components/Tooltip';\nimport { Point } from '../../types';\n\nfunction setTooltipContent(o: JsonObject) {\n  return (\n    o.object?.extraProps && (\n      <div className=\"deckgl-tooltip\">\n        {Object.keys(o.object.extraProps).map((prop, index) => (\n          <TooltipRow\n            key={`prop-${index}`}\n            label={`${prop}: `}\n            value={`${o.object.extraProps[prop]}`}\n          />\n        ))}\n      </div>\n    )\n  );\n}\n\nexport function getLayer(\n  formData: QueryFormData,\n  payload: JsonObject,\n  onAddFilter: () => void,\n  setTooltip: (tooltip: TooltipProps['tooltip']) => void,\n) {\n  const fd = formData;\n  const c = fd.color_picker;\n  const fixedColor = [c.r, c.g, c.b, 255 * c.a];\n  let data = payload.data.features.map((feature: JsonObject) => ({\n    ...feature,\n    path: feature.path,\n    width: fd.line_width,\n    color: fixedColor,\n  }));\n\n  if (fd.js_data_mutator) {\n    const jsFnMutator = sandboxedEval(fd.js_data_mutator);\n    data = jsFnMutator(data);\n  }\n\n  return new PathLayer({\n    id: `path-layer-${fd.slice_id}` as const,\n    getColor: d => d.color,\n    getPath: d => d.path,\n    getWidth: d => d.width,\n    data,\n    rounded: true,\n    widthScale: 1,\n    widthUnits: fd.line_width_unit,\n    ...commonLayerProps(fd, setTooltip, setTooltipContent),\n  });\n}\n\nfunction getPoints(data: JsonObject[]) {\n  let points: Point[] = [];\n  data.forEach(d => {\n    points = points.concat(d.path);\n  });\n\n  return points;\n}\n\nexport default createDeckGLComponent(getLayer, getPoints);\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport {\n  Accessor,\n  AccessorFunction,\n  Color,\n  CompositeLayer,\n  CompositeLayerProps,\n  createIterable,\n  Layer,\n  LayerDataSource,\n  LayersList,\n  log,\n  Unit,\n  Material,\n  UpdateParameters,\n  DefaultProps\n} from '@deck.gl/core';\nimport SolidPolygonLayer from '../solid-polygon-layer/solid-polygon-layer';\nimport PathLayer from '../path-layer/path-layer';\nimport * as Polygon from '../solid-polygon-layer/polygon';\nimport {replaceInRange} from '../utils';\n\n/**\n * All properties supported by `PolygonLayer`.\n */\nexport type PolygonLayerProps<DataT = any> = _PolygonLayerProps<DataT> & CompositeLayerProps;\n\n/**\n * Properties added by `PolygonLayer`.\n */\ntype _PolygonLayerProps<DataT = any> = {\n  data: LayerDataSource<DataT>;\n  /**\n   * Whether to draw an outline around the polygon (solid fill).\n   *\n   * Note that both the outer polygon as well the outlines of any holes will be drawn.\n   *\n   * @default true\n   */\n  stroked?: boolean;\n\n  /**\n   * Whether to draw a filled polygon (solid fill).\n   *\n   * Note that only the area between the outer polygon and any holes will be filled.\n   *\n   * @default true\n   */\n  filled?: boolean;\n\n  /**\n   * Whether to extrude the polygons.\n   *\n   * Based on the elevations provided by the `getElevation` accessor.\n   *\n   * If set to `false`, all polygons will be flat, this generates less geometry and is faster\n   * than simply returning 0 from getElevation.\n   *\n   * @default false\n   */\n  extruded?: boolean;\n\n  /**\n   * Elevation multiplier.\n   *\n   * The final elevation is calculated by `elevationScale * getElevation(d)`.\n   * `elevationScale` is a handy property to scale all elevation without updating the data.\n   *\n   * @default 1\n   */\n  elevationScale?: number;\n\n  /**\n   * Whether to generate a line wireframe of the hexagon.\n   *\n   * The outline will have \"horizontal\" lines closing the top and bottom polygons and a vertical\n   * line (a \"strut\") for each vertex on the polygon.\n   *\n   * @default false\n   */\n  wireframe?: boolean;\n\n  /**\n   * The units of the line width, one of `meters`, `common`, and `pixels`.\n   *\n   * @default 'meters'\n   * @see Unit.\n   */\n  lineWidthUnits?: Unit;\n\n  /**\n   * The line width multiplier that multiplied to all outlines of `Polygon` and `MultiPolygon`\n   * features if the stroked attribute is true.\n   *\n   * @default 1\n   */\n  lineWidthScale?: number;\n\n  /**\n   * The minimum line width in pixels.\n   *\n   * @default 0\n   */\n  lineWidthMinPixels?: number;\n\n  /**\n   * The maximum line width in pixels\n   *\n   * @default Number.MAX_SAFE_INTEGER\n   */\n  lineWidthMaxPixels?: number;\n\n  /**\n   * Type of joint. If `true`, draw round joints. Otherwise draw miter joints.\n   *\n   * @default false\n   */\n  lineJointRounded?: boolean;\n\n  /**\n   * The maximum extent of a joint in ratio to the stroke width.\n   *\n   * Only works if `lineJointRounded` is false.\n   *\n   * @default 4\n   */\n  lineMiterLimit?: number;\n\n  lineDashJustified?: boolean;\n\n  /** Called on each object in the data stream to retrieve its corresponding polygon. */\n  getPolygon?: AccessorFunction<DataT, any>;\n\n  /**\n   * Fill collor value or accessor.\n   *\n   * @default [0, 0, 0, 255]\n   */\n  getFillColor?: Accessor<DataT, Color>;\n\n  /**\n   * Line color value or accessor.\n   *\n   * @default [0, 0, 0, 255]\n   */\n  getLineColor?: Accessor<DataT, Color>;\n\n  /**\n   * Line width value or accessor.\n   *\n   * @default [0, 0, 0, 255]\n   */\n  getLineWidth?: Accessor<DataT, number>;\n\n  /**\n   * Elevation valur or accessor.\n   *\n   * Only used if `extruded: true`.\n   *\n   * @default 1000\n   */\n  getElevation?: Accessor<DataT, number>;\n\n  /**\n   * This property has been moved to `PathStyleExtension`.\n   *\n   * @deprecated\n   */\n  getLineDashArray?: Accessor<DataT, number> | null;\n\n  /**\n   * If `false`, will skip normalizing the coordinates returned by `getPolygon`.\n   *\n   * **Note**: This prop is experimental\n   *\n   * @default true\n   */\n  _normalize?: boolean;\n\n  /**\n   * Specifies the winding order of rings in the polygon data.\n   *\n   * **Note**: This prop is experimental\n   *\n   * @default 'CW'\n   */\n  _windingOrder?: 'CW' | 'CCW';\n\n  /**\n   * Material settings for lighting effect. Applies if `extruded: true`.\n   *\n   * @default true\n   * @see https://deck.gl/docs/developer-guide/using-lighting\n   */\n  material?: Material;\n};\n\nconst defaultLineColor: [number, number, number, number] = [0, 0, 0, 255];\nconst defaultFillColor: [number, number, number, number] = [0, 0, 0, 255];\n\nconst defaultProps: DefaultProps<PolygonLayerProps> = {\n  stroked: true,\n  filled: true,\n  extruded: false,\n  elevationScale: 1,\n  wireframe: false,\n  _normalize: true,\n  _windingOrder: 'CW',\n\n  lineWidthUnits: 'meters',\n  lineWidthScale: 1,\n  lineWidthMinPixels: 0,\n  lineWidthMaxPixels: Number.MAX_SAFE_INTEGER,\n  lineJointRounded: false,\n  lineMiterLimit: 4,\n\n  getPolygon: {type: 'accessor', value: f => f.polygon},\n  // Polygon fill color\n  getFillColor: {type: 'accessor', value: defaultFillColor},\n  // Point, line and polygon outline color\n  getLineColor: {type: 'accessor', value: defaultLineColor},\n  // Line and polygon outline accessors\n  getLineWidth: {type: 'accessor', value: 1},\n  // Polygon extrusion accessor\n  getElevation: {type: 'accessor', value: 1000},\n\n  // Optional material for 'lighting' shader module\n  material: true\n};\n\n/** A composite layer that renders filled, stroked and/or extruded polygons. */\nexport default class PolygonLayer<DataT = any, ExtraProps extends {} = {}> extends CompositeLayer<\n  Required<_PolygonLayerProps<DataT>> & ExtraProps\n> {\n  static layerName = 'PolygonLayer';\n  static defaultProps = defaultProps;\n\n  initializeState(): void {\n    this.state = {\n      paths: []\n    };\n\n    if (this.props.getLineDashArray) {\n      log.removed('getLineDashArray', 'PathStyleExtension')();\n    }\n  }\n\n  updateState({changeFlags}: UpdateParameters<this>) {\n    const geometryChanged =\n      changeFlags.dataChanged ||\n      (changeFlags.updateTriggersChanged &&\n        (changeFlags.updateTriggersChanged.all || changeFlags.updateTriggersChanged.getPolygon));\n\n    if (geometryChanged && Array.isArray(changeFlags.dataChanged)) {\n      const paths = this.state.paths.slice();\n      const pathsDiff = changeFlags.dataChanged.map(dataRange =>\n        replaceInRange({\n          data: paths,\n          getIndex: p => p.__source.index,\n          dataRange,\n          replace: this._getPaths(dataRange)\n        })\n      );\n      this.setState({paths, pathsDiff});\n    } else if (geometryChanged) {\n      this.setState({\n        paths: this._getPaths(),\n        pathsDiff: null\n      });\n    }\n  }\n\n  private _getPaths(dataRange: {startRow?: number; endRow?: number} = {}): {path: number[]}[] {\n    const {data, getPolygon, positionFormat, _normalize} = this.props;\n    const paths: {path: number[]}[] = [];\n    const positionSize = positionFormat === 'XY' ? 2 : 3;\n    const {startRow, endRow} = dataRange;\n\n    const {iterable, objectInfo} = createIterable(data, startRow, endRow);\n    for (const object of iterable) {\n      objectInfo.index++;\n      let polygon = getPolygon(object, objectInfo);\n      if (_normalize) {\n        polygon = Polygon.normalize(polygon, positionSize);\n      }\n      const {holeIndices} = polygon;\n      const positions = polygon.positions || polygon;\n\n      if (holeIndices) {\n        // split the positions array into `holeIndices.length + 1` rings\n        // holeIndices[-1] falls back to 0\n        // holeIndices[holeIndices.length] falls back to positions.length\n        for (let i = 0; i <= holeIndices.length; i++) {\n          const path = positions.slice(holeIndices[i - 1] || 0, holeIndices[i] || positions.length);\n          paths.push(this.getSubLayerRow({path}, object, objectInfo.index));\n        }\n      } else {\n        paths.push(this.getSubLayerRow({path: positions}, object, objectInfo.index));\n      }\n    }\n    return paths;\n  }\n\n  /* eslint-disable complexity */\n  renderLayers(): Layer | null | LayersList {\n    // Layer composition props\n    const {\n      data,\n      _dataDiff,\n      stroked,\n      filled,\n      extruded,\n      wireframe,\n      _normalize,\n      _windingOrder,\n      elevationScale,\n      transitions,\n      positionFormat\n    } = this.props;\n\n    // Rendering props underlying layer\n    const {\n      lineWidthUnits,\n      lineWidthScale,\n      lineWidthMinPixels,\n      lineWidthMaxPixels,\n      lineJointRounded,\n      lineMiterLimit,\n      lineDashJustified\n    } = this.props;\n\n    // Accessor props for underlying layers\n    const {\n      getFillColor,\n      getLineColor,\n      getLineWidth,\n      getLineDashArray,\n      getElevation,\n      getPolygon,\n      updateTriggers,\n      material\n    } = this.props;\n\n    const {paths, pathsDiff} = this.state;\n\n    const FillLayer = this.getSubLayerClass('fill', SolidPolygonLayer);\n    const StrokeLayer = this.getSubLayerClass('stroke', PathLayer);\n\n    // Filled Polygon Layer\n    const polygonLayer =\n      this.shouldRenderSubLayer('fill', paths) &&\n      new FillLayer(\n        {\n          _dataDiff,\n          extruded,\n          elevationScale,\n\n          filled,\n          wireframe,\n          _normalize,\n          _windingOrder,\n\n          getElevation,\n          getFillColor,\n          getLineColor: extruded && wireframe ? getLineColor : defaultLineColor,\n\n          material,\n          transitions\n        },\n        this.getSubLayerProps({\n          id: 'fill',\n          updateTriggers: updateTriggers && {\n            getPolygon: updateTriggers.getPolygon,\n            getElevation: updateTriggers.getElevation,\n            getFillColor: updateTriggers.getFillColor,\n            // using a legacy API to invalid lineColor attributes\n            // if (extruded && wireframe) has changed\n            lineColors: extruded && wireframe,\n            getLineColor: updateTriggers.getLineColor\n          }\n        }),\n        {\n          data,\n          positionFormat,\n          getPolygon\n        }\n      );\n\n    // Polygon line layer\n    const polygonLineLayer =\n      !extruded &&\n      stroked &&\n      this.shouldRenderSubLayer('stroke', paths) &&\n      new StrokeLayer(\n        {\n          _dataDiff: pathsDiff && (() => pathsDiff),\n          widthUnits: lineWidthUnits,\n          widthScale: lineWidthScale,\n          widthMinPixels: lineWidthMinPixels,\n          widthMaxPixels: lineWidthMaxPixels,\n          jointRounded: lineJointRounded,\n          miterLimit: lineMiterLimit,\n          dashJustified: lineDashJustified,\n\n          // Already normalized\n          _pathType: 'loop',\n\n          transitions: transitions && {\n            getWidth: transitions.getLineWidth,\n            getColor: transitions.getLineColor,\n            getPath: transitions.getPolygon\n          },\n\n          getColor: this.getSubLayerAccessor(getLineColor),\n          getWidth: this.getSubLayerAccessor(getLineWidth),\n          getDashArray: this.getSubLayerAccessor(getLineDashArray)\n        },\n        this.getSubLayerProps({\n          id: 'stroke',\n          updateTriggers: updateTriggers && {\n            getWidth: updateTriggers.getLineWidth,\n            getColor: updateTriggers.getLineColor,\n            getDashArray: updateTriggers.getLineDashArray\n          }\n        }),\n        {\n          data: paths,\n          positionFormat,\n          getPath: x => x.path\n        }\n      );\n\n    return [\n      // If not extruded: flat fill layer is drawn below outlines\n      !extruded && polygonLayer,\n      polygonLineLayer,\n      // If extruded: draw fill layer last for correct blending behavior\n      extruded && polygonLayer\n    ];\n  }\n  /* eslint-enable complexity */\n}\n","/* eslint-disable no-negated-condition */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { extent } from 'd3-array';\nimport { ScaleLinear, ScaleThreshold, scaleThreshold } from 'd3-scale';\nimport {\n  getSequentialSchemeRegistry,\n  JsonObject,\n  QueryFormData,\n  SequentialScheme,\n} from '@superset-ui/core';\nimport { isNumber } from 'lodash';\nimport { hexToRGB } from './utils/colors';\n\nconst DEFAULT_NUM_BUCKETS = 10;\n\nexport type Buckets = {\n  break_points: string[];\n  num_buckets: string;\n};\n\nexport type BucketsWithColorScale = Buckets & {\n  linear_color_scheme: string | string[];\n  opacity: number;\n};\n\nexport function getBreakPoints(\n  {\n    break_points: formDataBreakPoints,\n    num_buckets: formDataNumBuckets,\n  }: Buckets,\n  features: JsonObject[],\n  accessor: (value: JsonObject) => number | undefined,\n) {\n  if (!features) {\n    return [];\n  }\n  if (formDataBreakPoints === undefined || formDataBreakPoints.length === 0) {\n    // compute evenly distributed break points based on number of buckets\n    const numBuckets = formDataNumBuckets\n      ? parseInt(formDataNumBuckets, 10)\n      : DEFAULT_NUM_BUCKETS;\n    const [minValue, maxValue] = extent<JsonObject, number>(\n      features,\n      accessor,\n    ).map((value: number | string | undefined) =>\n      typeof value === 'string' ? parseFloat(value) : value,\n    );\n    if (minValue === undefined || maxValue === undefined) {\n      return [];\n    }\n    const delta = (maxValue - minValue) / numBuckets;\n    const precision =\n      delta === 0 ? 0 : Math.max(0, Math.ceil(Math.log10(1 / delta)));\n    const extraBucket =\n      maxValue > parseFloat(maxValue.toFixed(precision)) ? 1 : 0;\n    const startValue =\n      minValue < parseFloat(minValue.toFixed(precision))\n        ? minValue - 1\n        : minValue;\n\n    return new Array(numBuckets + 1 + extraBucket)\n      .fill(0)\n      .map((_, i) => (startValue + i * delta).toFixed(precision));\n  }\n\n  return formDataBreakPoints.sort(\n    (a: string, b: string) => parseFloat(a) - parseFloat(b),\n  );\n}\n\nexport function getBreakPointColorScaler(\n  {\n    break_points: formDataBreakPoints,\n    num_buckets: formDataNumBuckets,\n    linear_color_scheme: linearColorScheme,\n    opacity,\n  }: BucketsWithColorScale,\n  features: JsonObject[],\n  accessor: (value: JsonObject) => number | undefined,\n) {\n  const breakPoints =\n    formDataBreakPoints || formDataNumBuckets\n      ? getBreakPoints(\n          {\n            break_points: formDataBreakPoints,\n            num_buckets: formDataNumBuckets,\n          },\n          features,\n          accessor,\n        )\n      : null;\n  const colorScheme = Array.isArray(linearColorScheme)\n    ? new SequentialScheme({\n        colors: linearColorScheme,\n        id: 'custom',\n      })\n    : getSequentialSchemeRegistry().get(linearColorScheme);\n\n  if (!colorScheme) {\n    return null;\n  }\n  let scaler: ScaleLinear<string, string> | ScaleThreshold<number, string>;\n  let maskPoint: (v: number | undefined) => boolean;\n  if (breakPoints !== null) {\n    // bucket colors into discrete colors\n    const n = breakPoints.length - 1;\n    const bucketedColors =\n      n > 1\n        ? colorScheme.getColors(n)\n        : [colorScheme.colors[colorScheme.colors.length - 1]];\n\n    // repeat ends\n    const first = bucketedColors[0];\n    const last = bucketedColors[bucketedColors.length - 1];\n    bucketedColors.unshift(first);\n    bucketedColors.push(last);\n\n    const points = breakPoints.map(parseFloat);\n    scaler = scaleThreshold<number, string>()\n      .domain(points)\n      .range(bucketedColors);\n    maskPoint = value => !!value && (value > points[n] || value < points[0]);\n  } else {\n    // interpolate colors linearly\n    const linearScaleDomain = extent(features, accessor);\n    if (!linearScaleDomain.some(isNumber)) {\n      scaler = colorScheme.createLinearScale();\n    } else {\n      scaler = colorScheme.createLinearScale(\n        extent(features, accessor) as number[],\n      );\n    }\n    maskPoint = () => false;\n  }\n\n  return (d: JsonObject): [number, number, number, number] => {\n    const v = accessor(d);\n    if (!v) {\n      return [0, 0, 0, 0];\n    }\n    const c = hexToRGB(scaler(v));\n    if (maskPoint(v)) {\n      c[3] = 0;\n    } else {\n      c[3] = (opacity / 100) * 255;\n    }\n\n    return c;\n  };\n}\n\nexport function getBuckets(\n  fd: QueryFormData & BucketsWithColorScale,\n  features: JsonObject[],\n  accessor: (value: JsonObject) => number | undefined,\n) {\n  const breakPoints = getBreakPoints(fd, features, accessor);\n  const colorScaler = getBreakPointColorScaler(fd, features, accessor);\n  const buckets = {};\n  breakPoints.slice(1).forEach((value, i) => {\n    const range = `${breakPoints[i]} - ${breakPoints[i + 1]}`;\n    const mid =\n      0.5 * (parseFloat(breakPoints[i]) + parseFloat(breakPoints[i + 1]));\n    // fix polygon doesn't show\n    const metricLabel = fd.metric ? fd.metric.label || fd.metric : null;\n    buckets[range] = {\n      color: colorScaler?.({ [metricLabel || fd.metric]: mid }),\n      enabled: true,\n    };\n  });\n\n  return buckets;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { Point } from '../types';\n\n/** Format originally used by the Polygon plugin */\ntype CustomPolygonFeature = {\n  polygon: Point[];\n};\n\n/**\n * Format that is geojson standard\n * https://geojson.org/geojson-spec.html\n */\ntype GeojsonPolygonFeature = {\n  polygon: {\n    type: 'Feature';\n    geometry: {\n      type: 'Polygon';\n      coordinates: Point[][];\n    };\n  };\n};\n\nexport default function getPointsFromPolygon(\n  feature: CustomPolygonFeature | GeojsonPolygonFeature,\n) {\n  return 'geometry' in feature.polygon\n    ? feature.polygon.geometry.coordinates[0]\n    : feature.polygon;\n}\n","/* eslint-disable react/sort-prop-types */\n/* eslint-disable react/jsx-handler-names */\n/* eslint-disable react/no-access-state-in-setstate */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint no-underscore-dangle: [\"error\", { \"allow\": [\"\", \"__timestamp\"] }] */\n\nimport { memo, useCallback, useEffect, useRef, useState } from 'react';\nimport {\n  HandlerFunction,\n  JsonObject,\n  JsonValue,\n  QueryFormData,\n  t,\n} from '@superset-ui/core';\n\nimport { PolygonLayer } from 'deck.gl/typed';\n\nimport Legend from '../../components/Legend';\nimport TooltipRow from '../../TooltipRow';\nimport { getBuckets, getBreakPointColorScaler } from '../../utils';\n\nimport { commonLayerProps } from '../common';\nimport sandboxedEval from '../../utils/sandbox';\nimport getPointsFromPolygon from '../../utils/getPointsFromPolygon';\nimport fitViewport, { Viewport } from '../../utils/fitViewport';\nimport {\n  DeckGLContainerHandle,\n  DeckGLContainerStyledWrapper,\n} from '../../DeckGLContainer';\nimport { TooltipProps } from '../../components/Tooltip';\n\nconst DOUBLE_CLICK_THRESHOLD = 250; // milliseconds\n\nfunction getElevation(\n  d: JsonObject,\n  colorScaler: (d: JsonObject) => [number, number, number, number],\n) {\n  /* in deck.gl 5.3.4 (used in Superset as of 2018-10-24), if a polygon has\n   * opacity zero it will make everything behind it have opacity zero,\n   * effectively showing the map layer no matter what other polygons are\n   * behind it.\n   */\n  return colorScaler(d)[3] === 0 ? 0 : d.elevation;\n}\n\nfunction setTooltipContent(formData: PolygonFormData) {\n  return (o: JsonObject) => {\n    const metricLabel = formData?.metric?.label || formData?.metric;\n\n    return (\n      <div className=\"deckgl-tooltip\">\n        {o.object?.name && (\n          <TooltipRow\n            // eslint-disable-next-line prefer-template\n            label={t('name') + ': '}\n            value={`${o.object.name}`}\n          />\n        )}\n        {o.object?.[formData?.line_column] && (\n          <TooltipRow\n            label={`${formData.line_column}: `}\n            value={`${o.object[formData.line_column]}`}\n          />\n        )}\n        {formData?.metric && (\n          <TooltipRow\n            label={`${metricLabel}: `}\n            value={`${o.object?.[metricLabel]}`}\n          />\n        )}\n      </div>\n    );\n  };\n}\n\nexport function getLayer(\n  formData: PolygonFormData,\n  payload: JsonObject,\n  onAddFilter: HandlerFunction,\n  setTooltip: (tooltip: TooltipProps['tooltip']) => void,\n  selected: JsonObject[],\n  onSelect: (value: JsonValue) => void,\n) {\n  const fd = formData;\n  const fc = fd.fill_color_picker;\n  const sc = fd.stroke_color_picker;\n  let data = [...payload.data.features];\n\n  if (fd.js_data_mutator) {\n    // Applying user defined data mutator if defined\n    const jsFnMutator = sandboxedEval(fd.js_data_mutator);\n    data = jsFnMutator(data);\n  }\n\n  const metricLabel = fd.metric ? fd.metric.label || fd.metric : null;\n  const accessor = (d: JsonObject) => d[metricLabel];\n  // base color for the polygons\n  const baseColorScaler =\n    fd.metric === null\n      ? () => [fc.r, fc.g, fc.b, 255 * fc.a]\n      : getBreakPointColorScaler(fd, data, accessor);\n\n  // when polygons are selected, reduce the opacity of non-selected polygons\n  const colorScaler = (d: JsonObject): [number, number, number, number] => {\n    const baseColor = (baseColorScaler?.(d) as [\n      number,\n      number,\n      number,\n      number,\n    ]) || [0, 0, 0, 0];\n    if (selected.length > 0 && !selected.includes(d[fd.line_column])) {\n      baseColor[3] /= 2;\n    }\n\n    return baseColor;\n  };\n\n  const tooltipContentGenerator =\n    fd.line_column &&\n    fd.metric &&\n    ['json', 'geohash', 'zipcode'].includes(fd.line_type)\n      ? setTooltipContent(fd)\n      : () => null;\n\n  return new PolygonLayer({\n    id: `path-layer-${fd.slice_id}` as const,\n    data,\n    filled: fd.filled,\n    stroked: fd.stroked,\n    getPolygon: getPointsFromPolygon,\n    getFillColor: colorScaler,\n    getLineColor: [sc.r, sc.g, sc.b, 255 * sc.a],\n    getLineWidth: fd.line_width,\n    extruded: fd.extruded,\n    lineWidthUnits: fd.line_width_unit,\n    getElevation: d => getElevation(d, colorScaler),\n    elevationScale: fd.multiplier,\n    fp64: true,\n    ...commonLayerProps(fd, setTooltip, tooltipContentGenerator, onSelect),\n  });\n}\n\nexport type PolygonFormData = QueryFormData & {\n  break_points: string[];\n  num_buckets: string;\n  linear_color_scheme: string | string[];\n  opacity: number;\n};\nexport type DeckGLPolygonProps = {\n  formData: PolygonFormData;\n  payload: JsonObject;\n  setControlValue: (control: string, value: JsonValue) => void;\n  viewport: Viewport;\n  onAddFilter: HandlerFunction;\n  width: number;\n  height: number;\n};\n\nconst DeckGLPolygon = (props: DeckGLPolygonProps) => {\n  const containerRef = useRef<DeckGLContainerHandle>();\n\n  const getAdjustedViewport = useCallback(() => {\n    let viewport = { ...props.viewport };\n    if (props.formData.autozoom) {\n      const features = props.payload.data.features || [];\n      viewport = fitViewport(viewport, {\n        width: props.width,\n        height: props.height,\n        points: features.flatMap(getPointsFromPolygon),\n      });\n    }\n    if (viewport.zoom < 0) {\n      viewport.zoom = 0;\n    }\n    return viewport;\n  }, [props]);\n\n  const [lastClick, setLastClick] = useState(0);\n  const [viewport, setViewport] = useState(getAdjustedViewport());\n  const [stateFormData, setStateFormData] = useState(props.payload.form_data);\n  const [selected, setSelected] = useState<JsonObject[]>([]);\n\n  useEffect(() => {\n    const { payload } = props;\n\n    if (payload.form_data !== stateFormData) {\n      setViewport(getAdjustedViewport());\n      setSelected([]);\n      setLastClick(0);\n      setStateFormData(payload.form_data);\n    }\n  }, [getAdjustedViewport, props, stateFormData, viewport]);\n\n  const setTooltip = useCallback((tooltip: TooltipProps['tooltip']) => {\n    const { current } = containerRef;\n    if (current) {\n      current.setTooltip(tooltip);\n    }\n  }, []);\n\n  const onSelect = useCallback(\n    (polygon: JsonObject) => {\n      const { formData, onAddFilter } = props;\n\n      const now = new Date().getDate();\n      const doubleClick = now - lastClick <= DOUBLE_CLICK_THRESHOLD;\n\n      // toggle selected polygons\n      const selectedCopy = [...selected];\n      if (doubleClick) {\n        selectedCopy.splice(0, selectedCopy.length, polygon);\n      } else if (formData.toggle_polygons) {\n        const i = selectedCopy.indexOf(polygon);\n        if (i === -1) {\n          selectedCopy.push(polygon);\n        } else {\n          selectedCopy.splice(i, 1);\n        }\n      } else {\n        selectedCopy.splice(0, 1, polygon);\n      }\n\n      setSelected(selectedCopy);\n      setLastClick(now);\n      if (formData.table_filter) {\n        onAddFilter(formData.line_column, selected, false, true);\n      }\n    },\n    [lastClick, props, selected],\n  );\n\n  const getLayers = useCallback(() => {\n    if (props.payload.data.features === undefined) {\n      return [];\n    }\n\n    const layer = getLayer(\n      props.formData,\n      props.payload,\n      props.onAddFilter,\n      setTooltip,\n      selected,\n      onSelect,\n    );\n\n    return [layer];\n  }, [\n    onSelect,\n    props.formData,\n    props.onAddFilter,\n    props.payload,\n    selected,\n    setTooltip,\n  ]);\n\n  const { payload, formData, setControlValue } = props;\n\n  const metricLabel = formData.metric\n    ? formData.metric.label || formData.metric\n    : null;\n  const accessor = (d: JsonObject) => d[metricLabel];\n\n  const buckets = getBuckets(formData, payload.data.features, accessor);\n\n  return (\n    <div style={{ position: 'relative' }}>\n      <DeckGLContainerStyledWrapper\n        ref={containerRef}\n        viewport={viewport}\n        layers={getLayers()}\n        setControlValue={setControlValue}\n        mapStyle={formData.mapbox_style}\n        mapboxApiAccessToken={payload.data.mapboxApiKey}\n        width={props.width}\n        height={props.height}\n      />\n\n      {formData.metric !== null && (\n        <Legend\n          categories={buckets}\n          position={formData.legend_position}\n          format={formData.legend_format}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default memo(DeckGLPolygon);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nexport type Unit =\n  | 'square_m'\n  | 'radius_m'\n  | 'radius_km'\n  | 'radius_miles'\n  | 'square_km'\n  | 'square_miles';\n\nexport const defaultViewport = {\n  bearing: 0,\n  latitude: 31.222656842808707,\n  longitude: 6.85236157047845,\n  pitch: 0,\n  zoom: 1,\n};\n\nconst METER_TO_MILE = 1609.34;\n\nexport function unitToRadius(unit: Unit, num: number) {\n  if (unit === 'square_m') {\n    return Math.sqrt(num / Math.PI);\n  }\n  if (unit === 'radius_m') {\n    return num;\n  }\n  if (unit === 'radius_km') {\n    return num * 1000;\n  }\n  if (unit === 'radius_miles') {\n    return num * METER_TO_MILE;\n  }\n  if (unit === 'square_km') {\n    return Math.sqrt(num / Math.PI) * 1000;\n  }\n  if (unit === 'square_miles') {\n    return Math.sqrt(num / Math.PI) * METER_TO_MILE;\n  }\n\n  return null;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ScatterplotLayer } from 'deck.gl/typed';\nimport {\n  Datasource,\n  getMetricLabel,\n  JsonObject,\n  QueryFormData,\n  t,\n} from '@superset-ui/core';\nimport { commonLayerProps } from '../common';\nimport { createCategoricalDeckGLComponent } from '../../factory';\nimport TooltipRow from '../../TooltipRow';\nimport { unitToRadius } from '../../utils/geo';\nimport { TooltipProps } from '../../components/Tooltip';\n\nfunction getPoints(data: JsonObject[]) {\n  return data.map(d => d.position);\n}\n\nfunction setTooltipContent(\n  formData: QueryFormData,\n  verboseMap?: Record<string, string>,\n) {\n  return (o: JsonObject) => {\n    const label =\n      verboseMap?.[formData.point_radius_fixed.value] ||\n      getMetricLabel(formData.point_radius_fixed?.value);\n    return (\n      <div className=\"deckgl-tooltip\">\n        <TooltipRow\n          // eslint-disable-next-line prefer-template\n          label={t('Longitude and Latitude') + ': '}\n          value={`${o.object?.position?.[0]}, ${o.object?.position?.[1]}`}\n        />\n        {o.object?.cat_color && (\n          <TooltipRow\n            // eslint-disable-next-line prefer-template\n            label={t('Category') + ': '}\n            value={`${o.object?.cat_color}`}\n          />\n        )}\n        {o.object?.metric && (\n          <TooltipRow label={`${label}: `} value={`${o.object?.metric}`} />\n        )}\n      </div>\n    );\n  };\n}\n\nexport function getLayer(\n  formData: QueryFormData,\n  payload: JsonObject,\n  onAddFilter: () => void,\n  setTooltip: (tooltip: TooltipProps['tooltip']) => void,\n  datasource: Datasource,\n) {\n  const fd = formData;\n  const dataWithRadius = payload.data.features.map((d: JsonObject) => {\n    let radius = unitToRadius(fd.point_unit, d.radius) || 10;\n    if (fd.multiplier) {\n      radius *= fd.multiplier;\n    }\n    if (d.color) {\n      return { ...d, radius };\n    }\n    const c = fd.color_picker || { r: 0, g: 0, b: 0, a: 1 };\n    const color = [c.r, c.g, c.b, c.a * 255];\n\n    return { ...d, radius, color };\n  });\n\n  return new ScatterplotLayer({\n    id: `scatter-layer-${fd.slice_id}` as const,\n    data: dataWithRadius,\n    fp64: true,\n    getFillColor: d => d.color,\n    getRadius: d => d.radius,\n    radiusMinPixels: Number(fd.min_radius) || undefined,\n    radiusMaxPixels: Number(fd.max_radius) || undefined,\n    stroked: false,\n    ...commonLayerProps(\n      fd,\n      setTooltip,\n      setTooltipContent(fd, datasource?.verboseMap),\n    ),\n  });\n}\n\nexport default createCategoricalDeckGLComponent(getLayer, getPoints);\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nexport default `\\\n#define SHADER_NAME screen-grid-layer-vertex-shader\n#define RANGE_COUNT 6\n\nattribute vec3 positions;\nattribute vec3 instancePositions;\nattribute vec4 instanceCounts;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform vec3 cellScale;\nuniform vec4 minColor;\nuniform vec4 maxColor;\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 colorDomain;\nuniform bool shouldUseMinMax;\nuniform sampler2D maxTexture;\n\nvarying vec4 vColor;\nvarying float vSampleCount;\n\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\n  vec4 outColor = vec4(0., 0., 0., 0.);\n  if (value >= domain.x && value <= domain.y) {\n    float domainRange = domain.y - domain.x;\n    if (domainRange <= 0.) {\n      outColor = colorRange[0];\n    } else {\n      float rangeCount = float(RANGE_COUNT);\n      float rangeStep = domainRange / rangeCount;\n      float idx = floor((value - domain.x) / rangeStep);\n      idx = clamp(idx, 0., rangeCount - 1.);\n      int intIdx = int(idx);\n      outColor = colorRange[intIdx];\n    }\n  }\n  outColor = outColor / 255.;\n  return outColor;\n}\n\nvoid main(void) {\n  vSampleCount = instanceCounts.a;\n\n  float weight = instanceCounts.r;\n  float maxWeight = texture2D(maxTexture, vec2(0.5)).r;\n\n  float step = weight / maxWeight;\n  vec4 minMaxColor = mix(minColor, maxColor, step) / 255.;\n\n  vec2 domain = colorDomain;\n  float domainMaxValid = float(colorDomain.y != 0.);\n  domain.y = mix(maxWeight, colorDomain.y, domainMaxValid);\n  vec4 rangeColor = quantizeScale(domain, colorRange, weight);\n\n  float rangeMinMax = float(shouldUseMinMax);\n  vec4 color = mix(rangeColor, minMaxColor, rangeMinMax);\n  vColor = vec4(color.rgb, color.a * opacity);\n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n\n  gl_Position = vec4(instancePositions + positions * cellScale, 1.);\n}\n`;\n","// Copyright (c) 2015 - 2019 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport GL from '@luma.gl/constants';\nimport {Model, Geometry, FEATURES, hasFeatures, Texture2D, DefaultProps} from '@luma.gl/core';\nimport {Layer, LayerProps, log, picking, UpdateParameters} from '@deck.gl/core';\nimport {defaultColorRange, colorRangeToFlatArray} from '../utils/color-utils';\nimport vs from './screen-grid-layer-vertex.glsl';\nimport fs from './screen-grid-layer-fragment.glsl';\nimport type {_ScreenGridLayerProps} from './screen-grid-layer';\n\nconst DEFAULT_MINCOLOR = [0, 0, 0, 0];\nconst DEFAULT_MAXCOLOR = [0, 255, 0, 255];\nconst COLOR_PROPS = ['minColor', 'maxColor', 'colorRange', 'colorDomain'];\n\nconst defaultProps: DefaultProps<ScreenGridCellLayerProps> = {\n  cellSizePixels: {value: 100, min: 1},\n  cellMarginPixels: {value: 2, min: 0, max: 5},\n\n  colorDomain: null,\n  colorRange: defaultColorRange\n};\n\n/** All properties supported by ScreenGridCellLayer. */\nexport type ScreenGridCellLayerProps<DataT = any> = _ScreenGridCellLayerProps<DataT> & LayerProps;\n\n/** Proprties added by ScreenGridCellLayer. */\nexport type _ScreenGridCellLayerProps<DataT> = _ScreenGridLayerProps<DataT> & {\n  maxTexture: Texture2D;\n};\n\nexport default class ScreenGridCellLayer<DataT = any, ExtraPropsT extends {} = {}> extends Layer<\n  ExtraPropsT & Required<_ScreenGridCellLayerProps<DataT>>\n> {\n  static layerName = 'ScreenGridCellLayer';\n  static defaultProps = defaultProps;\n\n  static isSupported(gl) {\n    return hasFeatures(gl, [FEATURES.TEXTURE_FLOAT]);\n  }\n\n  state!: Layer['state'] & {\n    model: Model;\n  };\n  getShaders() {\n    return {vs, fs, modules: [picking]};\n  }\n\n  initializeState() {\n    const {gl} = this.context;\n    const attributeManager = this.getAttributeManager()!;\n    attributeManager.addInstanced({\n      // eslint-disable-next-line @typescript-eslint/unbound-method\n      instancePositions: {size: 3, update: this.calculateInstancePositions},\n      instanceCounts: {size: 4, noAlloc: true}\n    });\n    this.setState({\n      model: this._getModel(gl)\n    });\n  }\n\n  shouldUpdateState({changeFlags}) {\n    // 'instanceCounts' buffer contetns change on viewport change.\n    return changeFlags.somethingChanged;\n  }\n\n  updateState(params: UpdateParameters<this>) {\n    super.updateState(params);\n\n    const {oldProps, props, changeFlags} = params;\n\n    const attributeManager = this.getAttributeManager()!;\n    if (props.numInstances !== oldProps.numInstances) {\n      attributeManager.invalidateAll();\n    } else if (oldProps.cellSizePixels !== props.cellSizePixels) {\n      attributeManager.invalidate('instancePositions');\n    }\n\n    this._updateUniforms(oldProps, props, changeFlags);\n  }\n\n  draw({uniforms}) {\n    const {parameters, maxTexture} = this.props;\n    const minColor = this.props.minColor || DEFAULT_MINCOLOR;\n    const maxColor = this.props.maxColor || DEFAULT_MAXCOLOR;\n\n    // If colorDomain not specified we use default domain [1, maxCount]\n    // maxCount value will be sampled form maxTexture in vertex shader.\n    const colorDomain = this.props.colorDomain || [1, 0];\n    const {model} = this.state;\n    model\n      .setUniforms(uniforms)\n      .setUniforms({\n        minColor,\n        maxColor,\n        maxTexture,\n        colorDomain\n      })\n      .draw({\n        parameters: {\n          depthTest: false,\n          depthMask: false,\n          ...parameters\n        }\n      });\n  }\n\n  calculateInstancePositions(attribute, {numInstances}) {\n    const {width, height} = this.context.viewport;\n    const {cellSizePixels} = this.props;\n    const numCol = Math.ceil(width / cellSizePixels);\n\n    const {value, size} = attribute;\n\n    for (let i = 0; i < numInstances; i++) {\n      const x = i % numCol;\n      const y = Math.floor(i / numCol);\n      value[i * size + 0] = ((x * cellSizePixels) / width) * 2 - 1;\n      value[i * size + 1] = 1 - ((y * cellSizePixels) / height) * 2;\n      value[i * size + 2] = 0;\n    }\n  }\n\n  // Private Methods\n\n  _getModel(gl: WebGLRenderingContext): Model {\n    return new Model(gl, {\n      ...this.getShaders(),\n      id: this.props.id,\n      geometry: new Geometry({\n        drawMode: GL.TRIANGLE_FAN,\n        attributes: {\n          positions: new Float32Array([0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0])\n        }\n      }),\n      isInstanced: true\n    });\n  }\n\n  _shouldUseMinMax(): boolean {\n    const {minColor, maxColor, colorDomain, colorRange} = this.props;\n    if (minColor || maxColor) {\n      log.deprecated('ScreenGridLayer props: minColor and maxColor', 'colorRange, colorDomain')();\n      return true;\n    }\n    // minColor and maxColor not supplied, check if colorRange or colorDomain supplied.\n    // NOTE: colorDomain and colorRange are experimental features, use them only when supplied.\n    if (colorDomain || colorRange) {\n      return false;\n    }\n    // None specified, use default minColor and maxColor\n    return true;\n  }\n\n  _updateUniforms(oldProps, props, changeFlags): void {\n    const {model} = this.state;\n    if (COLOR_PROPS.some(key => oldProps[key] !== props[key])) {\n      model.setUniforms({shouldUseMinMax: this._shouldUseMinMax()});\n    }\n\n    if (oldProps.colorRange !== props.colorRange) {\n      model.setUniforms({colorRange: colorRangeToFlatArray(props.colorRange)});\n    }\n\n    if (\n      oldProps.cellMarginPixels !== props.cellMarginPixels ||\n      oldProps.cellSizePixels !== props.cellSizePixels ||\n      changeFlags.viewportChanged\n    ) {\n      const {width, height} = this.context.viewport;\n      const {cellSizePixels, cellMarginPixels} = this.props;\n      const margin = cellSizePixels > cellMarginPixels ? cellMarginPixels : 0;\n\n      const cellScale = new Float32Array([\n        ((cellSizePixels - margin) / width) * 2,\n        (-(cellSizePixels - margin) / height) * 2,\n        1\n      ]);\n      model.setUniforms({cellScale});\n    }\n  }\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* fragment shader for the grid-layer */\nexport default `\\\n#define SHADER_NAME screen-grid-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying float vSampleCount;\n\nvoid main(void) {\n  if (vSampleCount <= 0.0) {\n    discard;\n  }\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n`;\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport {\n  Accessor,\n  Color,\n  GetPickingInfoParams,\n  Layer,\n  LayerContext,\n  LayersList,\n  log,\n  PickingInfo,\n  Position,\n  UpdateParameters,\n  DefaultProps\n} from '@deck.gl/core';\nimport GL from '@luma.gl/constants';\nimport type {Texture2D} from '@luma.gl/core';\nimport GPUGridAggregator from '../utils/gpu-grid-aggregation/gpu-grid-aggregator';\nimport {AGGREGATION_OPERATION, getValueFunc} from '../utils/aggregation-operation-utils';\nimport ScreenGridCellLayer from './screen-grid-cell-layer';\nimport GridAggregationLayer, {GridAggregationLayerProps} from '../grid-aggregation-layer';\nimport {getFloatTexture} from '../utils/resource-utils.js';\n\nconst defaultProps: DefaultProps<ScreenGridLayerProps> = {\n  ...ScreenGridCellLayer.defaultProps,\n  getPosition: {type: 'accessor', value: d => d.position},\n  getWeight: {type: 'accessor', value: 1},\n\n  gpuAggregation: true,\n  aggregation: 'SUM'\n};\n\nconst POSITION_ATTRIBUTE_NAME = 'positions';\nconst DIMENSIONS = {\n  data: {\n    props: ['cellSizePixels']\n  },\n  weights: {\n    props: ['aggregation'],\n    accessors: ['getWeight']\n  }\n};\n\n/** All properties supported by ScreenGridLayer. */\nexport type ScreenGridLayerProps<DataT = any> = _ScreenGridLayerProps<DataT> &\n  GridAggregationLayerProps<DataT>;\n\n/** Properties added by ScreenGridLayer. */\nexport type _ScreenGridLayerProps<DataT> = {\n  /**\n   * Unit width/height of the bins.\n   * @default 100\n   */\n  cellSizePixels?: number;\n\n  /**\n   * Cell margin size in pixels.\n   * @default 2\n   */\n  cellMarginPixels?: number;\n\n  /**\n   * Expressed as an rgba array, minimal color that could be rendered by a tile.\n   * @default [0, 0, 0, 255]\n   * @deprecated Deprecated in version 5.2.0, use `colorRange` and `colorDomain` instead.\n   */\n  minColor?: Color | null;\n\n  /**\n   * Expressed as an rgba array, maximal color that could be rendered by a tile.\n   * @default [0, 255, 0, 255]\n   * @deprecated Deprecated in version 5.2.0, use `colorRange` and `colorDomain` instead.\n   */\n  maxColor?: Color | null;\n\n  /**\n   * Color scale input domain. The color scale maps continues numeric domain into discrete color range.\n   * @default [1, max(weight)]\n   */\n  colorDomain?: [number, number] | null;\n\n  /**\n   * Specified as an array of colors [color1, color2, ...].\n   *\n   * @default `6-class YlOrRd` - [colorbrewer](http://colorbrewer2.org/#type=sequential&scheme=YlOrRd&n=6)\n   */\n  colorRange?: Color[];\n\n  /**\n   * Method called to retrieve the position of each object.\n   *\n   * @default d => d.position\n   */\n  getPosition?: Accessor<DataT, Position>;\n\n  /**\n   * The weight of each object.\n   *\n   * @default 1\n   */\n  getWeight?: Accessor<DataT, number>;\n\n  /**\n   * Perform aggregation is performed on GPU.\n   *\n   * NOTE: GPU Aggregation requires WebGL2 support by the browser.\n   * When `gpuAggregation` is set to true and browser doesn't support WebGL2, aggregation falls back to CPU.\n   *\n   * @default true\n   */\n  gpuAggregation?: boolean;\n\n  /**\n   * Defines the type of aggregation operation\n   *\n   * V valid values are 'SUM', 'MEAN', 'MIN' and 'MAX'.\n   *\n   * @default 'SUM'\n   */\n  aggregation?: 'SUM' | 'MEAN' | 'MIN' | 'MAX';\n};\n\n/** Aggregates data into histogram bins and renders them as a grid. */\nexport default class ScreenGridLayer<\n  DataT = any,\n  ExtraProps extends {} = {}\n> extends GridAggregationLayer<DataT, ExtraProps & Required<_ScreenGridLayerProps<DataT>>> {\n  static layerName = 'ScreenGridLayer';\n  static defaultProps = defaultProps;\n\n  state!: GridAggregationLayer<DataT>['state'] & {\n    supported: boolean;\n    gpuGridAggregator?: any;\n    gpuAggregation?: any;\n    weights?: any;\n    maxTexture?: Texture2D;\n  };\n\n  initializeState() {\n    const {gl} = this.context;\n    if (!ScreenGridCellLayer.isSupported(gl)) {\n      // max aggregated value is sampled from a float texture\n      this.setState({supported: false});\n      log.error(`ScreenGridLayer: ${this.id} is not supported on this browser`)();\n      return;\n    }\n    super.initializeAggregationLayer({\n      dimensions: DIMENSIONS,\n      // @ts-expect-error\n      getCellSize: props => props.cellSizePixels // TODO\n    });\n    const weights = {\n      count: {\n        size: 1,\n        operation: AGGREGATION_OPERATION.SUM,\n        needMax: true,\n        maxTexture: getFloatTexture(gl, {id: `${this.id}-max-texture`})\n      }\n    };\n    this.setState({\n      supported: true,\n      projectPoints: true, // aggregation in screen space\n      weights,\n      subLayerData: {attributes: {}},\n      maxTexture: weights.count.maxTexture,\n      positionAttributeName: 'positions',\n      posOffset: [0, 0],\n      translation: [1, -1]\n    });\n    const attributeManager = this.getAttributeManager()!;\n    attributeManager.add({\n      [POSITION_ATTRIBUTE_NAME]: {\n        size: 3,\n        accessor: 'getPosition',\n        type: GL.DOUBLE,\n        fp64: this.use64bitPositions()\n      },\n      // this attribute is used in gpu aggregation path only\n      count: {size: 3, accessor: 'getWeight'}\n    });\n  }\n\n  shouldUpdateState({changeFlags}: UpdateParameters<this>) {\n    return this.state.supported && changeFlags.somethingChanged;\n  }\n\n  updateState(opts: UpdateParameters<this>) {\n    super.updateState(opts);\n  }\n\n  renderLayers(): LayersList | Layer {\n    if (!this.state.supported) {\n      return [];\n    }\n    const {maxTexture, numRow, numCol, weights} = this.state;\n    const {updateTriggers} = this.props;\n    const {aggregationBuffer} = weights.count;\n    const CellLayerClass = this.getSubLayerClass('cells', ScreenGridCellLayer);\n\n    return new CellLayerClass(\n      this.props,\n      this.getSubLayerProps({\n        id: 'cell-layer',\n        updateTriggers\n      }),\n      {\n        data: {attributes: {instanceCounts: aggregationBuffer}},\n        maxTexture,\n        numInstances: numRow * numCol\n      }\n    );\n  }\n\n  finalizeState(context: LayerContext): void {\n    super.finalizeState(context);\n\n    const {aggregationBuffer, maxBuffer, maxTexture} = this.state;\n\n    aggregationBuffer?.delete();\n    maxBuffer?.delete();\n    maxTexture?.delete();\n  }\n\n  getPickingInfo({info}: GetPickingInfoParams): PickingInfo {\n    const {index} = info;\n    if (index >= 0) {\n      const {gpuGridAggregator, gpuAggregation, weights} = this.state;\n      // Get count aggregation results\n      const aggregationResults = gpuAggregation\n        ? gpuGridAggregator.getData('count')\n        : weights.count;\n\n      // Each instance (one cell) is aggregated into single pixel,\n      // Get current instance's aggregation details.\n      info.object = GPUGridAggregator.getAggregationData({\n        pixelIndex: index,\n        ...aggregationResults\n      });\n    }\n\n    return info;\n  }\n\n  // Aggregation Overrides\n\n  updateResults({aggregationData, maxData}) {\n    const {count} = this.state.weights;\n    count.aggregationData = aggregationData;\n    count.aggregationBuffer.setData({data: aggregationData});\n    count.maxData = maxData;\n    count.maxTexture.setImageData({data: maxData});\n  }\n\n  /* eslint-disable complexity, max-statements */\n  updateAggregationState(opts) {\n    const cellSize = opts.props.cellSizePixels;\n    const cellSizeChanged = opts.oldProps.cellSizePixels !== cellSize;\n    const {viewportChanged} = opts.changeFlags;\n    let gpuAggregation = opts.props.gpuAggregation;\n    if (this.state.gpuAggregation !== opts.props.gpuAggregation) {\n      if (gpuAggregation && !GPUGridAggregator.isSupported(this.context.gl)) {\n        log.warn('GPU Grid Aggregation not supported, falling back to CPU')();\n        gpuAggregation = false;\n      }\n    }\n    const gpuAggregationChanged = gpuAggregation !== this.state.gpuAggregation;\n    this.setState({\n      gpuAggregation\n    });\n\n    const positionsChanged = this.isAttributeChanged(POSITION_ATTRIBUTE_NAME);\n\n    const {dimensions} = this.state;\n    const {data, weights} = dimensions;\n    const aggregationDataDirty =\n      positionsChanged ||\n      gpuAggregationChanged ||\n      viewportChanged ||\n      this.isAggregationDirty(opts, {\n        compareAll: gpuAggregation, // check for all (including extentions props) when using gpu aggregation\n        dimension: data\n      });\n    const aggregationWeightsDirty = this.isAggregationDirty(opts, {dimension: weights});\n\n    this.setState({\n      aggregationDataDirty,\n      aggregationWeightsDirty\n    });\n\n    const {viewport} = this.context;\n\n    if (viewportChanged || cellSizeChanged) {\n      const {width, height} = viewport;\n      const numCol = Math.ceil(width / cellSize);\n      const numRow = Math.ceil(height / cellSize);\n      this.allocateResources(numRow, numCol);\n      this.setState({\n        // transformation from clipspace to screen(pixel) space\n        scaling: [width / 2, -height / 2, 1],\n\n        gridOffset: {xOffset: cellSize, yOffset: cellSize},\n        width,\n        height,\n        numCol,\n        numRow\n      });\n    }\n\n    if (aggregationWeightsDirty) {\n      this._updateAccessors(opts);\n    }\n    if (aggregationDataDirty || aggregationWeightsDirty) {\n      this._resetResults();\n    }\n  }\n  /* eslint-enable complexity, max-statements */\n\n  // Private\n\n  _updateAccessors(opts) {\n    const {getWeight, aggregation, data} = opts.props;\n    const {count} = this.state.weights;\n    if (count) {\n      count.getWeight = getWeight;\n      count.operation = AGGREGATION_OPERATION[aggregation];\n    }\n    this.setState({getValue: getValueFunc(aggregation, getWeight, {data})});\n  }\n\n  _resetResults() {\n    const {count} = this.state.weights;\n    if (count) {\n      count.aggregationData = null;\n    }\n  }\n}\n","/* eslint-disable react/sort-prop-types */\n/* eslint-disable react/jsx-handler-names */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint no-underscore-dangle: [\"error\", { \"allow\": [\"\", \"__timestamp\"] }] */\n\nimport { memo, useCallback, useEffect, useRef, useState } from 'react';\nimport { ScreenGridLayer } from 'deck.gl/typed';\nimport { JsonObject, JsonValue, QueryFormData, t } from '@superset-ui/core';\nimport { noop } from 'lodash';\nimport sandboxedEval from '../../utils/sandbox';\nimport { commonLayerProps } from '../common';\nimport TooltipRow from '../../TooltipRow';\n// eslint-disable-next-line import/extensions\nimport fitViewport, { Viewport } from '../../utils/fitViewport';\nimport {\n  DeckGLContainerHandle,\n  DeckGLContainerStyledWrapper,\n} from '../../DeckGLContainer';\nimport { TooltipProps } from '../../components/Tooltip';\n\nfunction getPoints(data: JsonObject[]) {\n  return data.map(d => d.position);\n}\n\nfunction setTooltipContent(o: JsonObject) {\n  return (\n    <div className=\"deckgl-tooltip\">\n      <TooltipRow\n        // eslint-disable-next-line prefer-template\n        label={t('Longitude and Latitude') + ': '}\n        value={`${o?.coordinate?.[0]}, ${o?.coordinate?.[1]}`}\n      />\n      <TooltipRow\n        // eslint-disable-next-line prefer-template\n        label={t('Weight') + ': '}\n        value={`${o.object?.cellWeight}`}\n      />\n    </div>\n  );\n}\n\nexport function getLayer(\n  formData: QueryFormData,\n  payload: JsonObject,\n  onAddFilter: () => void,\n  setTooltip: (tooltip: TooltipProps['tooltip']) => void,\n) {\n  const fd = formData;\n  const c = fd.color_picker;\n  let data = payload.data.features.map((d: JsonObject) => ({\n    ...d,\n    color: [c.r, c.g, c.b, 255 * c.a],\n  }));\n\n  if (fd.js_data_mutator) {\n    // Applying user defined data mutator if defined\n    const jsFnMutator = sandboxedEval(fd.js_data_mutator);\n    data = jsFnMutator(data);\n  }\n\n  // Passing a layer creator function instead of a layer since the\n  // layer needs to be regenerated at each render\n  return new ScreenGridLayer({\n    id: `screengrid-layer-${fd.slice_id}` as const,\n    data,\n    cellSizePixels: fd.grid_size,\n    minColor: [c.r, c.g, c.b, 0],\n    maxColor: [c.r, c.g, c.b, 255 * c.a],\n    outline: false,\n    getWeight: d => d.weight || 0,\n    ...commonLayerProps(fd, setTooltip, setTooltipContent),\n  });\n}\n\nexport type DeckGLScreenGridProps = {\n  formData: QueryFormData;\n  payload: JsonObject;\n  setControlValue: (control: string, value: JsonValue) => void;\n  viewport: Viewport;\n  width: number;\n  height: number;\n  onAddFilter: () => void;\n};\n\nconst DeckGLScreenGrid = (props: DeckGLScreenGridProps) => {\n  const containerRef = useRef<DeckGLContainerHandle>();\n\n  const getAdjustedViewport = useCallback(() => {\n    const features = props.payload.data.features || [];\n\n    const { width, height, formData } = props;\n\n    if (formData.autozoom) {\n      return fitViewport(props.viewport, {\n        width,\n        height,\n        points: getPoints(features),\n      });\n    }\n    return props.viewport;\n  }, [props]);\n\n  const [stateFormData, setStateFormData] = useState(props.payload.form_data);\n  const [viewport, setViewport] = useState(getAdjustedViewport());\n\n  useEffect(() => {\n    if (props.payload.form_data !== stateFormData) {\n      setViewport(getAdjustedViewport());\n      setStateFormData(props.payload.form_data);\n    }\n  }, [getAdjustedViewport, props.payload.form_data, stateFormData]);\n\n  const setTooltip = useCallback((tooltip: TooltipProps['tooltip']) => {\n    const { current } = containerRef;\n    if (current) {\n      current.setTooltip(tooltip);\n    }\n  }, []);\n\n  const getLayers = useCallback(() => {\n    const layer = getLayer(props.formData, props.payload, noop, setTooltip);\n\n    return [layer];\n  }, [props.formData, props.payload, setTooltip]);\n\n  const { formData, payload, setControlValue } = props;\n\n  return (\n    <div>\n      <DeckGLContainerStyledWrapper\n        ref={containerRef}\n        viewport={viewport}\n        layers={getLayers()}\n        setControlValue={setControlValue}\n        mapStyle={formData.mapbox_style}\n        mapboxApiAccessToken={payload.data.mapboxApiKey}\n        width={props.width}\n        height={props.height}\n      />\n    </div>\n  );\n};\n\nexport default memo(DeckGLScreenGrid);\n"],"names":["getExploreLongUrl","formData","endpointType","allowOverflow","extraSearch","datasource","uri","URI","directory","includes","getURIDirectory","search","Object","keys","forEach","key","form_data","object","cache","Set","JSON","stringify","value","has","parse","error","add","safeStringify","standalone","url","toString","length","viz_type","URL_IS_TOO_LONG_TO_SHARE","deck_grid","deck_screengrid","deck_path","deck_hex","deck_scatter","deck_geojson","deck_arc","deck_polygon","deck_heatmap","deck_contour","DeckMulti","props","containerRef","useRef","viewport","setViewport","useState","subSlicesLayers","setSubSlicesLayers","setTooltip","useCallback","tooltip","current","loadLayers","payload","data","slices","subslice","filters","extra_filters","subsliceCopy","SupersetClient","get","endpoint","then","json","layer","layerGenerators","onAddFilter","onSelect","slice_id","catch","prevDeckSlices","usePrevious","deck_slices","useEffect","_isEqual","setControlValue","height","width","layers","values","_jsx","DeckGLContainerStyledWrapper","ref","mapboxApiAccessToken","mapboxApiKey","mapStyle","mapbox_style","onViewportChange","memo","DEFAULT_COLOR","defaultProps","getSourcePosition","type","x","sourcePosition","getTargetPosition","targetPosition","getSourceColor","getTargetColor","getWidth","getHeight","getTilt","greatCircle","widthUnits","widthScale","min","widthMinPixels","widthMaxPixels","Number","MAX_SAFE_INTEGER","ArcLayer","Layer","constructor","args","_defineProperty","getBounds","_this$getAttributeMan","this","getAttributeManager","getShaders","super","vs","fs","modules","project32","picking","wrapLongitude","initializeState","addInstanced","instanceSourcePositions","size","fp64","use64bitPositions","transition","accessor","instanceTargetPositions","instanceSourceColors","colorFormat","normalized","defaultValue","instanceTargetColors","instanceWidths","instanceHeights","instanceTilts","updateState","opts","changeFlags","extensionsChanged","_this$state$model","gl","context","state","model","delete","_getModel","invalidateAll","draw","uniforms","setUniforms","UNIT","useShortestPath","positions","i","concat","Model","id","geometry","Geometry","drawMode","attributes","Float32Array","isInstanced","numSegments","getLayer","fd","features","sc","color_picker","tc","target_color_picker","d","sourceColor","color","r","g","b","a","targetColor","strokeWidth","stroke_width","commonLayerProps","o","_o$object","_o$object$sourcePosit","_o$object2","_o$object2$sourcePosi","_o$object3","_o$object3$targetPosi","_o$object4","_o$object4$targetPosi","_o$object5","_jsxs","className","children","TooltipRow","label","t","dimension","cat_color","createCategoricalDeckGLComponent","points","push","setTooltipContent","_o$object$contour","coordinate","contour","threshold","aggregation","js_data_mutator","jsFnMutator","contours","rawContours","cellSize","map","lowerThreshold","upperThreshold","sandboxedEval","jsFnMutatorFunction","ContourLayer","toUpperCase","getPosition","position","getWeight","weight","createDeckGLComponent","propertyMap","fillColor","fill","strokeColor","alterProps","propOverrides","newProps","k","hexToRGB","recurseGeoJson","node","extraProps","obj","newNode","properties","prop","index","_o$object$extraProps","getFillColor","feature","_feature$properties","getLineColor","_feature$properties2","fc","fill_color_picker","stroke_color_picker","GeoJsonLayer","extruded","filled","stroked","getLineWidth","line_width","pointRadiusScale","point_radius_scale","lineWidthUnits","line_width_unit","DeckGLGeoJson","_payload$data2","useMemo","autozoom","_payload$data","_payload$data$feature","reduce","acc","bounds","geojsonExtent","fitViewport","elevationValue","appliedScheme","color_scheme","colorRange","CategoricalColorNamespace","range","aggFunc","getAggFunc","js_agg_function","p","GridLayer","grid_size","outline","getElevationValue","getColorValue","_getSequentialSchemeR","_getSequentialSchemeR2","_colorScale$range","_colorScale$range$map","intensity","radius_pixels","radiusPixels","linear_color_scheme","colorScheme","colorScale","getSequentialSchemeRegistry","createLinearScale","reverse","HeatmapLayer","thirdPi","Math","PI","angles","pointX","pointY","nop","colorDomain","defaultColorRange","getColorWeight","colorAggregation","lowerPercentile","max","upperPercentile","colorScaleType","onSetColorDomain","elevationDomain","elevationRange","getElevationWeight","elevationAggregation","elevationLowerPercentile","elevationUpperPercentile","elevationScale","elevationScaleType","onSetElevationDomain","radius","coverage","hexagonAggregator","aggregationParams","centerLngLat","getAccessor","minX","Infinity","minY","maxX","maxY","y","isFinite","every","getPointsCenter","radiusCommon","center","unitsPerMeter","getDistanceScales","getRadiusInCommon","screenPoints","iterable","objectInfo","createIterable","posIndex","screenCoord","projectFlat","source","log","warn","newHexbin","dx","dy","x0","y0","x1","y1","hexbin","binsById","bins","n","isNaN","px","call","point","py","pj","round","pi","py1","abs","px1","pi2","pj2","px2","py2","bin","hexagon","angle","sin","cos","join","centers","j","mesh","fragment","slice","_","arguments","extent","hexagons","hex","unprojectFlat","material","_filterData","optional","HexagonLayer","AggregationLayer","cpuAggregator","CPUAggregator","getAggregator","getCellSize","aggregatorState","vertices","propsOrDataChanged","getAttributes","layerData","hexagonVertices","setState","convertLatLngToMeterOffset","Array","isArray","vertex0","vertex3","centroid","centroidFlat","metersPerUnit","vt","vtFlat","getPickingInfo","info","_onGetSublayerColor","cell","_onGetSublayerElevation","_getSublayerUpdateTriggers","getUpdateTriggers","renderLayers","transitions","SubLayerClass","getSubLayerClass","ColumnLayer","updateTriggers","radiusUnits","diskResolution","bind","getElevation","getSubLayerProps","getScale","c","fixedColor","path","PathLayer","getColor","getPath","rounded","defaultLineColor","wireframe","_normalize","_windingOrder","lineWidthScale","lineWidthMinPixels","lineWidthMaxPixels","lineJointRounded","lineMiterLimit","getPolygon","f","polygon","PolygonLayer","CompositeLayer","paths","getLineDashArray","removed","geometryChanged","dataChanged","updateTriggersChanged","all","pathsDiff","dataRange","replaceInRange","getIndex","__source","replace","_getPaths","positionFormat","positionSize","startRow","endRow","Polygon","holeIndices","getSubLayerRow","_dataDiff","lineDashJustified","FillLayer","SolidPolygonLayer","StrokeLayer","polygonLayer","shouldRenderSubLayer","lineColors","jointRounded","miterLimit","dashJustified","_pathType","getSubLayerAccessor","getDashArray","DEFAULT_NUM_BUCKETS","getBreakPoints","break_points","formDataBreakPoints","num_buckets","formDataNumBuckets","undefined","numBuckets","parseInt","minValue","maxValue","parseFloat","delta","precision","ceil","log10","extraBucket","toFixed","startValue","sort","getBreakPointColorScaler","linearColorScheme","opacity","breakPoints","SequentialScheme","colors","scaler","maskPoint","bucketedColors","getColors","first","last","unshift","scaleThreshold","domain","linearScaleDomain","some","v","getPointsFromPolygon","coordinates","selected","metricLabel","metric","baseColorScaler","colorScaler","baseColor","line_column","tooltipContentGenerator","line_type","_formData$metric","name","elevation","multiplier","DeckGLPolygon","getAdjustedViewport","flatMap","zoom","lastClick","setLastClick","stateFormData","setStateFormData","setSelected","now","Date","getDate","doubleClick","selectedCopy","splice","toggle_polygons","indexOf","table_filter","getLayers","buckets","mid","enabled","getBuckets","style","Legend","categories","legend_position","format","legend_format","METER_TO_MILE","verboseMap","_formData$point_radiu","_o$object$position","_o$object2$position","_o$object6","point_radius_fixed","getMetricLabel","dataWithRadius","unit","point_unit","num","sqrt","ScatterplotLayer","getRadius","radiusMinPixels","min_radius","radiusMaxPixels","max_radius","DEFAULT_MINCOLOR","DEFAULT_MAXCOLOR","COLOR_PROPS","cellSizePixels","cellMarginPixels","ScreenGridCellLayer","isSupported","hasFeatures","FEATURES","TEXTURE_FLOAT","instancePositions","update","calculateInstancePositions","instanceCounts","noAlloc","shouldUpdateState","somethingChanged","params","oldProps","attributeManager","numInstances","invalidate","_updateUniforms","parameters","maxTexture","minColor","maxColor","depthTest","depthMask","attribute","numCol","floor","_shouldUseMinMax","deprecated","shouldUseMinMax","colorRangeToFlatArray","viewportChanged","margin","cellScale","gpuAggregation","POSITION_ATTRIBUTE_NAME","DIMENSIONS","weights","accessors","ScreenGridLayer","GridAggregationLayer","supported","initializeAggregationLayer","dimensions","count","operation","AGGREGATION_OPERATION","SUM","needMax","getFloatTexture","projectPoints","subLayerData","positionAttributeName","posOffset","translation","numRow","aggregationBuffer","finalizeState","maxBuffer","gpuGridAggregator","aggregationResults","getData","GPUGridAggregator","getAggregationData","pixelIndex","updateResults","aggregationData","maxData","setData","setImageData","updateAggregationState","cellSizeChanged","gpuAggregationChanged","positionsChanged","isAttributeChanged","aggregationDataDirty","isAggregationDirty","compareAll","aggregationWeightsDirty","allocateResources","scaling","gridOffset","xOffset","yOffset","_updateAccessors","_resetResults","getValue","getValueFunc","_o$coordinate","_o$coordinate2","cellWeight","DeckGLScreenGrid","_noop"],"sourceRoot":""}
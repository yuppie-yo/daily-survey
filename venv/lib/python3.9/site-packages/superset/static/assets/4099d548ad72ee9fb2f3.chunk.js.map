{"version":3,"file":"4099d548ad72ee9fb2f3.chunk.js","mappings":"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","sources":["webpack://superset/./src/dashboard/components/nativeFilters/utils.ts","webpack://superset/./src/features/datasets/DatasetSelectLabel/index.tsx","webpack://superset/./src/pages/ChartCreation/index.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  AdhocFilter,\n  Behavior,\n  DataMaskStateWithId,\n  EXTRA_FORM_DATA_APPEND_KEYS,\n  EXTRA_FORM_DATA_OVERRIDE_KEYS,\n  ExtraFormData,\n  isFeatureEnabled,\n  FeatureFlag,\n  Filter,\n  getChartMetadataRegistry,\n  QueryFormData,\n  t,\n} from '@superset-ui/core';\nimport { DashboardLayout } from 'src/dashboard/types';\nimport extractUrlParams from 'src/dashboard/util/extractUrlParams';\nimport { CHART_TYPE, TAB_TYPE } from '../../util/componentTypes';\nimport { DASHBOARD_GRID_ID, DASHBOARD_ROOT_ID } from '../../util/constants';\nimport getBootstrapData from '../../../utils/getBootstrapData';\n\nconst getDefaultRowLimit = (): number => {\n  const bootstrapData = getBootstrapData();\n  const nativeFilterDefaultRowLimit =\n    bootstrapData?.common?.conf?.NATIVE_FILTER_DEFAULT_ROW_LIMIT;\n  return nativeFilterDefaultRowLimit || 1000;\n};\n\nexport const getFormData = ({\n  datasetId,\n  dependencies = {},\n  groupby,\n  defaultDataMask,\n  controlValues,\n  filterType,\n  sortMetric,\n  adhoc_filters,\n  time_range,\n  granularity_sqla,\n  type,\n  dashboardId,\n  id,\n}: Partial<Filter> & {\n  dashboardId: number;\n  datasetId?: number;\n  dependencies?: object;\n  groupby?: string;\n  adhoc_filters?: AdhocFilter[];\n  time_range?: string;\n}): Partial<QueryFormData> => {\n  const otherProps: {\n    datasource?: string;\n    groupby?: string[];\n    sortMetric?: string;\n  } = {};\n  if (datasetId) {\n    otherProps.datasource = `${datasetId}__table`;\n  }\n  if (groupby) {\n    otherProps.groupby = [groupby];\n  }\n  if (sortMetric) {\n    otherProps.sortMetric = sortMetric;\n  }\n  return {\n    ...controlValues,\n    ...otherProps,\n    adhoc_filters: adhoc_filters ?? [],\n    extra_filters: [],\n    extra_form_data: dependencies,\n    granularity_sqla,\n    metrics: ['count'],\n    row_limit: getDefaultRowLimit(),\n    showSearch: true,\n    defaultValue: defaultDataMask?.filterState?.value,\n    time_range,\n    url_params: extractUrlParams('regular'),\n    inView: true,\n    viz_type: filterType,\n    type,\n    dashboardId,\n    native_filter_id: id,\n  };\n};\n\nexport function mergeExtraFormData(\n  originalExtra: ExtraFormData = {},\n  newExtra: ExtraFormData = {},\n): ExtraFormData {\n  const mergedExtra: ExtraFormData = {};\n  EXTRA_FORM_DATA_APPEND_KEYS.forEach((key: string) => {\n    const mergedValues = [\n      ...(originalExtra[key] || []),\n      ...(newExtra[key] || []),\n    ];\n    if (mergedValues.length) {\n      mergedExtra[key] = mergedValues;\n    }\n  });\n  EXTRA_FORM_DATA_OVERRIDE_KEYS.forEach((key: string) => {\n    const originalValue = originalExtra[key];\n    if (originalValue !== undefined) {\n      mergedExtra[key] = originalValue;\n    }\n    const newValue = newExtra[key];\n    if (newValue !== undefined) {\n      mergedExtra[key] = newValue;\n    }\n  });\n  return mergedExtra;\n}\n\nexport function isCrossFilter(vizType: string) {\n  // @ts-ignore need export from superset-ui `ItemWithValue`\n  return getChartMetadataRegistry().items[vizType]?.value.behaviors?.includes(\n    Behavior.InteractiveChart,\n  );\n}\n\nexport function getExtraFormData(\n  dataMask: DataMaskStateWithId,\n  filterIdsAppliedOnChart: string[],\n): ExtraFormData {\n  let extraFormData: ExtraFormData = {};\n  filterIdsAppliedOnChart.forEach(key => {\n    extraFormData = mergeExtraFormData(\n      extraFormData,\n      dataMask[key]?.extraFormData ?? {},\n    );\n  });\n  return extraFormData;\n}\n\nexport function nativeFilterGate(behaviors: Behavior[]): boolean {\n  return (\n    !behaviors.includes(Behavior.NativeFilter) ||\n    (isFeatureEnabled(FeatureFlag.DashboardCrossFilters) &&\n      behaviors.includes(Behavior.InteractiveChart))\n  );\n}\n\nconst isComponentATab = (\n  dashboardLayout: DashboardLayout,\n  componentId: string,\n) => dashboardLayout?.[componentId]?.type === TAB_TYPE;\n\nconst findTabsWithChartsInScopeHelper = (\n  dashboardLayout: DashboardLayout,\n  chartsInScope: number[],\n  componentId: string,\n  tabIds: string[],\n  tabsToHighlight: Set<string>,\n  visited: Set<string>,\n) => {\n  if (visited.has(componentId)) {\n    return;\n  }\n  visited.add(componentId);\n  if (\n    dashboardLayout?.[componentId]?.type === CHART_TYPE &&\n    chartsInScope.includes(dashboardLayout[componentId]?.meta?.chartId)\n  ) {\n    tabIds.forEach(tabsToHighlight.add, tabsToHighlight);\n  }\n  if (\n    dashboardLayout?.[componentId]?.children?.length === 0 ||\n    (isComponentATab(dashboardLayout, componentId) &&\n      tabsToHighlight.has(componentId))\n  ) {\n    return;\n  }\n  dashboardLayout[componentId]?.children.forEach(childId =>\n    findTabsWithChartsInScopeHelper(\n      dashboardLayout,\n      chartsInScope,\n      childId,\n      isComponentATab(dashboardLayout, childId) ? [...tabIds, childId] : tabIds,\n      tabsToHighlight,\n      visited,\n    ),\n  );\n};\n\nexport const findTabsWithChartsInScope = (\n  dashboardLayout: DashboardLayout,\n  chartsInScope: number[],\n) => {\n  const dashboardRoot = dashboardLayout[DASHBOARD_ROOT_ID];\n  const rootChildId = dashboardRoot.children[0];\n  const hasTopLevelTabs = rootChildId !== DASHBOARD_GRID_ID;\n  const tabsInScope = new Set<string>();\n  const visited = new Set<string>();\n  if (hasTopLevelTabs) {\n    dashboardLayout[rootChildId]?.children?.forEach(tabId =>\n      findTabsWithChartsInScopeHelper(\n        dashboardLayout,\n        chartsInScope,\n        tabId,\n        [tabId],\n        tabsInScope,\n        visited,\n      ),\n    );\n  } else {\n    Object.values(dashboardLayout)\n      .filter(element => element?.type === TAB_TYPE)\n      .forEach(element =>\n        findTabsWithChartsInScopeHelper(\n          dashboardLayout,\n          chartsInScope,\n          element.id,\n          [element.id],\n          tabsInScope,\n          visited,\n        ),\n      );\n  }\n  return tabsInScope;\n};\n\nexport const getFilterValueForDisplay = (\n  value?: string[] | null | string | number | object,\n): string => {\n  if (value === null || value === undefined) {\n    return '';\n  }\n  if (typeof value === 'string' || typeof value === 'number') {\n    return `${value}`;\n  }\n  if (Array.isArray(value)) {\n    return value.join(', ');\n  }\n  if (typeof value === 'object') {\n    return JSON.stringify(value);\n  }\n  return t('Unknown value');\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { Tooltip } from 'src/components/Tooltip';\nimport { styled, t } from '@superset-ui/core';\n\ntype Database = {\n  database_name: string;\n};\n\nexport type Dataset = {\n  id: number;\n  table_name: string;\n  datasource_type?: string;\n  schema: string;\n  database: Database;\n};\n\nconst TooltipContent = styled.div`\n  ${({ theme }) => `\n    .tooltip-header {\n      font-size: ${theme.typography.sizes.m}px;\n      font-weight: ${theme.typography.weights.bold};\n    }\n\n    .tooltip-description {\n      margin-top: ${theme.gridUnit * 2}px;\n      display: -webkit-box;\n      -webkit-line-clamp: 20;\n      -webkit-box-orient: vertical;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n  `}\n`;\n\nconst StyledLabelContainer = styled.div`\n  ${({ theme }) => `\n    left: ${theme.gridUnit * 3}px;\n    right: ${theme.gridUnit * 3}px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    display: block;\n  `}\n`;\n\nconst StyledLabel = styled.span`\n  ${({ theme }) => `\n    left: ${theme.gridUnit * 3}px;\n    right: ${theme.gridUnit * 3}px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    display: block;\n  `}\n`;\n\nconst StyledDetailWrapper = styled.div`\n  display: grid;\n  grid-template-columns: auto auto;\n  justify-content: start;\n  width: 100%;\n`;\n\nconst StyledLabelDetail = styled.span`\n  ${({\n    theme: {\n      typography: { sizes, weights },\n    },\n  }) => `\n    overflow: hidden;\n    text-overflow: ellipsis;\n    font-size: ${sizes.s}px;\n    font-weight: ${weights.light};\n    line-height: 1.6;\n  `}\n`;\n\nconst isValidValue = (value: string): boolean =>\n  !['null', 'none'].includes(value.toLowerCase()) && value.trim() !== '';\n\nexport const DatasetSelectLabel = (item: Dataset) => (\n  <Tooltip\n    mouseEnterDelay={0.2}\n    placement=\"right\"\n    title={\n      <TooltipContent>\n        <div className=\"tooltip-header\">\n          {item.table_name && isValidValue(item.table_name)\n            ? item.table_name\n            : t('Not defined')}\n        </div>\n        <div className=\"tooltip-description\">\n          <div>\n            {t('Database')}: {item.database.database_name}\n          </div>\n          <div>\n            {t('Schema')}:{' '}\n            {item.schema && isValidValue(item.schema)\n              ? item.schema\n              : t('Not defined')}\n          </div>\n        </div>\n      </TooltipContent>\n    }\n  >\n    <StyledLabelContainer>\n      <StyledLabel>\n        {item.table_name && isValidValue(item.table_name)\n          ? item.table_name\n          : item.database.database_name}\n      </StyledLabel>\n      <StyledDetailWrapper>\n        <StyledLabelDetail>{item.database.database_name}</StyledLabelDetail>\n        {item.schema && isValidValue(item.schema) && (\n          <StyledLabelDetail>&nbsp;- {item.schema}</StyledLabelDetail>\n        )}\n      </StyledDetailWrapper>\n    </StyledLabelContainer>\n  </Tooltip>\n);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { PureComponent, ReactNode } from 'react';\nimport rison from 'rison';\nimport querystring from 'query-string';\nimport {\n  isDefined,\n  JsonResponse,\n  styled,\n  SupersetClient,\n  t,\n} from '@superset-ui/core';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport { FilterPlugins, URL_PARAMS } from 'src/constants';\nimport { Link, withRouter, RouteComponentProps } from 'react-router-dom';\nimport Button from 'src/components/Button';\nimport { AsyncSelect, Steps } from 'src/components';\nimport withToasts from 'src/components/MessageToasts/withToasts';\n\nimport VizTypeGallery, {\n  MAX_ADVISABLE_VIZ_GALLERY_WIDTH,\n} from 'src/explore/components/controls/VizTypeControl/VizTypeGallery';\nimport { findPermission } from 'src/utils/findPermission';\nimport { UserWithPermissionsAndRoles } from 'src/types/bootstrapTypes';\nimport getBootstrapData from 'src/utils/getBootstrapData';\nimport {\n  Dataset,\n  DatasetSelectLabel,\n} from 'src/features/datasets/DatasetSelectLabel';\n\nexport interface ChartCreationProps extends RouteComponentProps {\n  user: UserWithPermissionsAndRoles;\n  addSuccessToast: (arg: string) => void;\n}\n\nexport type ChartCreationState = {\n  datasource?: { label: string; value: string };\n  datasetName?: string | string[] | null;\n  vizType: string | null;\n  canCreateDataset: boolean;\n};\n\nconst ESTIMATED_NAV_HEIGHT = 56;\nconst ELEMENTS_EXCEPT_VIZ_GALLERY = ESTIMATED_NAV_HEIGHT + 250;\n\nconst bootstrapData = getBootstrapData();\nconst denyList: string[] = (\n  bootstrapData.common.conf.VIZ_TYPE_DENYLIST || []\n).concat(Object.values(FilterPlugins));\n\nconst StyledContainer = styled.div`\n  ${({ theme }) => `\n    flex: 1 1 auto;\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n    width: 100%;\n    max-width: ${MAX_ADVISABLE_VIZ_GALLERY_WIDTH}px;\n    max-height: calc(100vh - ${ESTIMATED_NAV_HEIGHT}px);\n    border-radius: ${theme.gridUnit}px;\n    background-color: ${theme.colors.grayscale.light5};\n    margin-left: auto;\n    margin-right: auto;\n    padding-left: ${theme.gridUnit * 4}px;\n    padding-right: ${theme.gridUnit * 4}px;\n    padding-bottom: ${theme.gridUnit * 4}px;\n\n    h3 {\n      padding-bottom: ${theme.gridUnit * 3}px;\n    }\n\n    & .dataset {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n      margin-bottom: ${theme.gridUnit * 5}px;\n\n      & > div {\n        min-width: 200px;\n        width: 300px;\n      }\n\n      & > span {\n        color: ${theme.colors.grayscale.light1};\n        margin-left: ${theme.gridUnit * 4}px;\n      }\n    }\n\n    & .viz-gallery {\n      border: 1px solid ${theme.colors.grayscale.light2};\n      border-radius: ${theme.gridUnit}px;\n      margin: ${theme.gridUnit}px 0px;\n      max-height: calc(100vh - ${ELEMENTS_EXCEPT_VIZ_GALLERY}px);\n      flex: 1;\n    }\n\n    & .footer {\n      flex: 1;\n      display: flex;\n      flex-direction: row;\n      justify-content: flex-end;\n      align-items: center;\n\n      & > span {\n        color: ${theme.colors.grayscale.light1};\n        margin-right: ${theme.gridUnit * 4}px;\n      }\n    }\n\n    /* The following extra ampersands (&&&&) are used to boost selector specificity */\n\n    &&&& .ant-steps-item-tail {\n      display: none;\n    }\n\n    &&&& .ant-steps-item-icon {\n      margin-right: ${theme.gridUnit * 2}px;\n      width: ${theme.gridUnit * 5}px;\n      height: ${theme.gridUnit * 5}px;\n      line-height: ${theme.gridUnit * 5}px;\n    }\n\n    &&&& .ant-steps-item-title {\n      line-height: ${theme.gridUnit * 5}px;\n    }\n\n    &&&& .ant-steps-item-content {\n      overflow: unset;\n\n      .ant-steps-item-description {\n        margin-top: ${theme.gridUnit}px;\n        padding-bottom: ${theme.gridUnit}px;\n      }\n    }\n\n    &&&& .ant-tooltip-open {\n      display: inline;\n    }\n\n    &&&& .ant-select-selector {\n      padding: 0;\n    }\n\n    &&&& .ant-select-selection-placeholder {\n      padding-left: ${theme.gridUnit * 3}px;\n    }\n\n    &&&& .ant-select-selection-item {\n      padding-left: ${theme.gridUnit * 3}px;\n    }\n  `}\n`;\n\nconst StyledStepTitle = styled.span`\n  ${({\n    theme: {\n      typography: { sizes, weights },\n    },\n  }) => `\n      font-size: ${sizes.m}px;\n      font-weight: ${weights.bold};\n    `}\n`;\n\nconst StyledStepDescription = styled.div`\n  ${({ theme: { gridUnit } }) => `\n    margin-top: ${gridUnit * 4}px;\n    margin-bottom: ${gridUnit * 3}px;\n  `}\n`;\n\nexport class ChartCreation extends PureComponent<\n  ChartCreationProps,\n  ChartCreationState\n> {\n  constructor(props: ChartCreationProps) {\n    super(props);\n    this.state = {\n      vizType: null,\n      canCreateDataset: findPermission(\n        'can_write',\n        'Dataset',\n        props.user.roles,\n      ),\n    };\n\n    this.changeDatasource = this.changeDatasource.bind(this);\n    this.changeVizType = this.changeVizType.bind(this);\n    this.gotoSlice = this.gotoSlice.bind(this);\n    this.loadDatasources = this.loadDatasources.bind(this);\n    this.onVizTypeDoubleClick = this.onVizTypeDoubleClick.bind(this);\n  }\n\n  componentDidMount() {\n    const params = querystring.parse(window.location.search)?.dataset as string;\n    if (params) {\n      this.loadDatasources(params, 0, 1).then(r => {\n        const datasource = r.data[0];\n        // override here to force styling of option label\n        // which expects a reactnode instead of string\n        // @ts-expect-error\n        datasource.label = datasource.customLabel;\n        this.setState({ datasource });\n      });\n      this.props.addSuccessToast(t('The dataset has been saved'));\n    }\n  }\n\n  exploreUrl() {\n    const dashboardId = getUrlParam(URL_PARAMS.dashboardId);\n    let url = `/explore/?viz_type=${this.state.vizType}&datasource=${this.state.datasource?.value}`;\n    if (isDefined(dashboardId)) {\n      url += `&dashboard_id=${dashboardId}`;\n    }\n    return url;\n  }\n\n  gotoSlice() {\n    this.props.history.push(this.exploreUrl());\n  }\n\n  changeDatasource(datasource: { label: string; value: string }) {\n    this.setState({ datasource });\n  }\n\n  changeVizType(vizType: string | null) {\n    this.setState({ vizType });\n  }\n\n  isBtnDisabled() {\n    return !(this.state.datasource?.value && this.state.vizType);\n  }\n\n  onVizTypeDoubleClick() {\n    if (!this.isBtnDisabled()) {\n      this.gotoSlice();\n    }\n  }\n\n  loadDatasources(search: string, page: number, pageSize: number) {\n    const query = rison.encode({\n      columns: [\n        'id',\n        'table_name',\n        'datasource_type',\n        'database.database_name',\n        'schema',\n      ],\n      filters: [{ col: 'table_name', opr: 'ct', value: search }],\n      page,\n      page_size: pageSize,\n      order_column: 'table_name',\n      order_direction: 'asc',\n    });\n    return SupersetClient.get({\n      endpoint: `/api/v1/dataset/?q=${query}`,\n    }).then((response: JsonResponse) => {\n      const list: {\n        customLabel: ReactNode;\n        id: number;\n        label: string;\n        value: string;\n      }[] = response.json.result.map((item: Dataset) => ({\n        id: item.id,\n        value: `${item.id}__${item.datasource_type}`,\n        customLabel: DatasetSelectLabel(item),\n        label: item.table_name,\n      }));\n      return {\n        data: list,\n        totalCount: response.json.count,\n      };\n    });\n  }\n\n  render() {\n    const isButtonDisabled = this.isBtnDisabled();\n    const VIEW_INSTRUCTIONS_TEXT = t('view instructions');\n    const datasetHelpText = this.state.canCreateDataset ? (\n      <span data-test=\"dataset-write\">\n        <Link to=\"/dataset/add/\" data-test=\"add-chart-new-dataset\">\n          {t('Add a dataset')}{' '}\n        </Link>\n        {t('or')}{' '}\n        <a\n          href=\"https://superset.apache.org/docs/creating-charts-dashboards/creating-your-first-dashboard/#registering-a-new-table\"\n          rel=\"noopener noreferrer\"\n          target=\"_blank\"\n          data-test=\"add-chart-new-dataset-instructions\"\n        >\n          {`${VIEW_INSTRUCTIONS_TEXT} `}\n          <i className=\"fa fa-external-link\" />\n        </a>\n        .\n      </span>\n    ) : (\n      <span data-test=\"no-dataset-write\">\n        <a\n          href=\"https://superset.apache.org/docs/creating-charts-dashboards/creating-your-first-dashboard/#registering-a-new-table\"\n          rel=\"noopener noreferrer\"\n          target=\"_blank\"\n        >\n          {`${VIEW_INSTRUCTIONS_TEXT} `}\n          <i className=\"fa fa-external-link\" />\n        </a>\n        .\n      </span>\n    );\n\n    return (\n      <StyledContainer>\n        <h3>{t('Create a new chart')}</h3>\n        <Steps direction=\"vertical\" size=\"small\">\n          <Steps.Step\n            title={<StyledStepTitle>{t('Choose a dataset')}</StyledStepTitle>}\n            status={this.state.datasource?.value ? 'finish' : 'process'}\n            description={\n              <StyledStepDescription className=\"dataset\">\n                <AsyncSelect\n                  autoFocus\n                  ariaLabel={t('Dataset')}\n                  name=\"select-datasource\"\n                  onChange={this.changeDatasource}\n                  options={this.loadDatasources}\n                  optionFilterProps={['id', 'label']}\n                  placeholder={t('Choose a dataset')}\n                  showSearch\n                  value={this.state.datasource}\n                />\n                {datasetHelpText}\n              </StyledStepDescription>\n            }\n          />\n          <Steps.Step\n            title={<StyledStepTitle>{t('Choose chart type')}</StyledStepTitle>}\n            status={this.state.vizType ? 'finish' : 'process'}\n            description={\n              <StyledStepDescription>\n                <VizTypeGallery\n                  denyList={denyList}\n                  className=\"viz-gallery\"\n                  onChange={this.changeVizType}\n                  onDoubleClick={this.onVizTypeDoubleClick}\n                  selectedViz={this.state.vizType}\n                />\n              </StyledStepDescription>\n            }\n          />\n        </Steps>\n        <div className=\"footer\">\n          {isButtonDisabled && (\n            <span>\n              {t('Please select both a Dataset and a Chart type to proceed')}\n            </span>\n          )}\n          <Button\n            buttonStyle=\"primary\"\n            disabled={isButtonDisabled}\n            onClick={this.gotoSlice}\n          >\n            {t('Create new chart')}\n          </Button>\n        </div>\n      </StyledContainer>\n    );\n  }\n}\n\nexport default withRouter(withToasts(ChartCreation));\n"],"names":["getDefaultRowLimit","_bootstrapData$common","_bootstrapData$common2","bootstrapData","getBootstrapData","common","conf","NATIVE_FILTER_DEFAULT_ROW_LIMIT","getFormData","datasetId","dependencies","groupby","defaultDataMask","controlValues","filterType","sortMetric","adhoc_filters","time_range","granularity_sqla","type","dashboardId","id","_defaultDataMask$filt","otherProps","datasource","extra_filters","extra_form_data","metrics","row_limit","showSearch","defaultValue","filterState","value","url_params","extractUrlParams","inView","viz_type","native_filter_id","mergeExtraFormData","originalExtra","newExtra","mergedExtra","EXTRA_FORM_DATA_APPEND_KEYS","forEach","key","mergedValues","length","EXTRA_FORM_DATA_OVERRIDE_KEYS","originalValue","undefined","newValue","getExtraFormData","dataMask","filterIdsAppliedOnChart","extraFormData","_dataMask$key$extraFo","_dataMask$key","nativeFilterGate","behaviors","includes","Behavior","NativeFilter","isFeatureEnabled","FeatureFlag","DashboardCrossFilters","InteractiveChart","isComponentATab","dashboardLayout","componentId","_dashboardLayout$comp","TAB_TYPE","findTabsWithChartsInScopeHelper","chartsInScope","tabIds","tabsToHighlight","visited","_dashboardLayout$comp2","_dashboardLayout$comp3","_dashboardLayout$comp4","_dashboardLayout$comp5","_dashboardLayout$comp6","_dashboardLayout$comp7","has","add","CHART_TYPE","meta","chartId","children","childId","findTabsWithChartsInScope","rootChildId","DASHBOARD_ROOT_ID","hasTopLevelTabs","DASHBOARD_GRID_ID","tabsInScope","Set","_dashboardLayout$root","_dashboardLayout$root2","tabId","Object","values","filter","element","getFilterValueForDisplay","Array","isArray","join","JSON","stringify","t","TooltipContent","styled","div","theme","typography","sizes","m","weights","bold","gridUnit","StyledLabelContainer","StyledLabel","span","StyledDetailWrapper","StyledLabelDetail","s","light","isValidValue","toLowerCase","trim","DatasetSelectLabel","item","_jsx","Tooltip","mouseEnterDelay","placement","title","_jsxs","className","table_name","database","database_name","schema","denyList","VIZ_TYPE_DENYLIST","concat","FilterPlugins","StyledContainer","MAX_ADVISABLE_VIZ_GALLERY_WIDTH","colors","grayscale","light5","light1","light2","StyledStepTitle","StyledStepDescription","ChartCreation","PureComponent","constructor","props","super","this","state","vizType","canCreateDataset","findPermission","user","roles","changeDatasource","bind","changeVizType","gotoSlice","loadDatasources","onVizTypeDoubleClick","componentDidMount","_querystring$parse","params","querystring","window","location","search","dataset","then","r","data","label","customLabel","setState","addSuccessToast","exploreUrl","_this$state$datasourc","getUrlParam","URL_PARAMS","url","isDefined","history","push","isBtnDisabled","_this$state$datasourc2","page","pageSize","query","rison","columns","filters","col","opr","page_size","order_column","order_direction","SupersetClient","get","endpoint","response","json","result","map","datasource_type","totalCount","count","render","_this$state$datasourc3","isButtonDisabled","VIEW_INSTRUCTIONS_TEXT","datasetHelpText","Link","to","href","rel","target","Steps","direction","size","Step","status","description","AsyncSelect","autoFocus","ariaLabel","name","onChange","options","optionFilterProps","placeholder","VizTypeGallery","onDoubleClick","selectedViz","Button","buttonStyle","disabled","onClick","withRouter","withToasts"],"sourceRoot":""}
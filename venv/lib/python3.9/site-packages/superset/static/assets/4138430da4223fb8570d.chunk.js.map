{"version":3,"file":"4138430da4223fb8570d.chunk.js","mappings":"iSA8BA,MAAMA,EAAY,CAChBC,KAAMC,IAAAA,QACJA,IAAAA,MAAgB,CACdC,OAAQD,IAAAA,OACRE,OAAQF,IAAAA,OACRG,MAAOH,IAAAA,UAGXI,MAAOJ,IAAAA,OACPK,OAAQL,IAAAA,OACRM,YAAaN,IAAAA,QAGTO,GAAeC,EAAAA,EAAAA,IAAmBC,EAAAA,QAAcC,OAEtD,SAASC,EAAOC,EAASC,GACvB,MAAM,KAAEd,EAAI,MAAEK,EAAK,OAAEC,EAAM,YAAEC,EAAW,QAAEQ,GAAYD,EAChDE,EAAMC,IAAAA,OAAUJ,GACtBG,EAAIE,QAAQ,gCAAgC,GAC5C,MAMMC,EAAad,EAFX,EAFC,EAKHe,EAAcd,EANb,EAEG,EAMVU,EAAIK,UAAU,KAAKC,SACnB,MAAMC,EAAUP,EACbQ,OAAO,OACPC,KAAK,QAAS,kBACdC,MAAM,UAAW,GACdC,EAAMX,EACTQ,OAAO,OACPC,KAAK,QAASN,EAZT,EAFC,GAeNM,KAAK,SAAUL,EAhBX,EAEG,GAePI,OAAO,KACPC,KAAK,YAAa,kBACfG,EAAUC,EAA0BC,SAASvB,GAE7CwB,ECnEO,WACb,IAAIA,EAAS,CAAC,EACVC,EAAY,GACZC,EAAc,EACdC,EAAO,CAAC,EAAG,GACXC,EAAQ,GACRC,EAAQ,GA4PZ,SAASC,IAiBP,SAASC,EAAqBC,EAAGC,GAC/B,OAAOD,EAAErC,OAAOuC,EAAID,EAAEtC,OAAOuC,CAC/B,CAEA,SAASC,EAAqBH,EAAGC,GAC/B,OAAOD,EAAEpC,OAAOsC,EAAID,EAAErC,OAAOsC,CAC/B,CAtBAN,EAAMQ,SAAQ,SAASC,GACrBA,EAAKC,YAAYC,KAAKJ,GACtBE,EAAKG,YAAYD,KAAKR,EACxB,IACAH,EAAMQ,SAAQ,SAASC,GACrB,IAAII,EAAK,EAAGC,EAAK,EACjBL,EAAKC,YAAYF,SAAQ,SAASO,GAChCA,EAAKF,GAAKA,EACVA,GAAME,EAAKC,EACb,IACAP,EAAKG,YAAYJ,SAAQ,SAASO,GAChCA,EAAKD,GAAKA,EACVA,GAAMC,EAAKC,EACb,GACF,GASF,CAEA,SAASC,EAAOR,GACd,OAAOA,EAAKH,EAAIG,EAAKO,GAAK,CAC5B,CAEA,SAAS/C,EAAM8C,GACb,OAAOA,EAAK9C,KACd,CAEA,OA5RA2B,EAAOC,UAAY,SAASqB,GAC1B,OAAKC,UAAUC,QACfvB,GAAaqB,EACNtB,GAFuBC,CAGhC,EAEAD,EAAOE,YAAc,SAASoB,GAC5B,OAAKC,UAAUC,QACftB,GAAeoB,EACRtB,GAFuBE,CAGhC,EAEAF,EAAOI,MAAQ,SAASkB,GACtB,OAAKC,UAAUC,QACfpB,EAAQkB,EACDtB,GAFuBI,CAGhC,EAEAJ,EAAOK,MAAQ,SAASiB,GACtB,OAAKC,UAAUC,QACfnB,EAAQiB,EACDtB,GAFuBK,CAGhC,EAEAL,EAAOG,KAAO,SAASmB,GACrB,OAAKC,UAAUC,QACfrB,EAAOmB,EACAtB,GAFuBG,CAGhC,EAEAH,EAAOyB,OAAS,SAASC,GAMvB,OAqCAtB,EAAMQ,SAAQ,SAASC,GACrBA,EAAKC,YAAc,GACnBD,EAAKG,YAAc,EACrB,IACAX,EAAMO,SAAQ,SAASO,GACrB,IAAIhD,EAASgD,EAAKhD,OACdC,EAAS+C,EAAK/C,OACI,iBAAXD,IAAqBA,EAASgD,EAAKhD,OAASiC,EAAMe,EAAKhD,SAC5C,iBAAXC,IAAqBA,EAAS+C,EAAK/C,OAASgC,EAAMe,EAAK/C,SAClED,EAAO2C,YAAYa,KAAKR,GACxB/C,EAAO4C,YAAYW,KAAKR,EAC1B,IAKAf,EAAMQ,SAAQ,SAASC,GACrBA,EAAKxC,MAAQuD,KAAKC,KAChB,IAAAC,KAAIjB,EAAKC,YAAazC,IACtB,IAAAyD,KAAIjB,EAAKG,YAAa3C,GAE1B,IAOF,WAKE,IAJA,IACI0D,EAuCqBC,EAxCrBC,EAAiB7B,EAEjB8B,EAAI,EAEDD,EAAeT,QACpBO,EAAY,GACZE,EAAerB,SAAQ,SAASC,GAC9BA,EAAKqB,EAAIA,EACTrB,EAAKsB,GAAKlC,EACVY,EAAKC,YAAYF,SAAQ,SAASO,GAC5BY,EAAUK,QAAQjB,EAAK/C,QAAU,GACnC2D,EAAUJ,KAAKR,EAAK/C,OAExB,GACF,IACA6D,EAAiBF,IACfG,GAgBN,SAAwBA,GACtB9B,EAAMQ,SAAQ,SAASC,GAChBA,EAAKC,YAAYU,SACpBX,EAAKqB,EAAIA,EAAI,EAEjB,GACF,EAlBEG,CAAeH,GAoBUF,GAnBN7B,EAAK,GAAKF,IAAciC,EAAI,GAoB/C9B,EAAMQ,SAAQ,SAASC,GACrBA,EAAKqB,GAAKF,CACZ,GArBF,CA3FEM,GAmHF,SAA2BZ,GACzB,IAiBMa,EAjBFC,GAAiB,UAChBC,KAAI,SAASC,GAAK,OAAOA,EAAER,CAAG,IAC9BS,SAAS,EAAAC,WACTC,QAAQzC,GACR0C,KAAI,SAASJ,GAAK,OAAOA,EAAEK,MAAQ,IAalCR,GAAK,IAAAS,KAAIR,GAAgB,SAASpC,GACpC,OAAQD,EAAK,IAAMC,EAAMoB,OAAS,GAAKtB,IAAe,IAAA4B,KAAI1B,EAAO/B,EACnE,IAEAmE,EAAe5B,SAAQ,SAASR,GAC9BA,EAAMQ,SAAQ,SAASC,EAAMoC,GAC3BpC,EAAKH,EAAIuC,EACTpC,EAAKO,GAAKP,EAAKxC,MAAQkE,CACzB,GACF,IAEAlC,EAAMO,SAAQ,SAASO,GACrBA,EAAKC,GAAKD,EAAK9C,MAAQkE,CACzB,IAtBFW,IACA,IAAK,IAAIC,EAAQ,EAAGzB,EAAa,IAAKA,EACpC0B,EAAiBD,GAAS,KAC1BD,IACAG,EAAiBF,GACjBD,IAoBF,SAASG,EAAiBF,GAUxB,SAASG,EAAenC,GACtB,OAAOE,EAAOF,EAAKhD,QAAUgD,EAAK9C,KACpC,CAXAmE,EAAe5B,SAAQ,SAASR,GAC9BA,EAAMQ,SAAQ,SAASC,GACrB,GAAIA,EAAKG,YAAYQ,OAAQ,CAC3B,IAAId,GAAI,IAAAoB,KAAIjB,EAAKG,YAAasC,IAAkB,IAAAxB,KAAIjB,EAAKG,YAAa3C,GACtEwC,EAAKH,IAAMA,EAAIW,EAAOR,IAASsC,CACjC,CACF,GACF,GAKF,CAEA,SAASC,EAAiBD,GAUxB,SAASI,EAAepC,GACtB,OAAOE,EAAOF,EAAK/C,QAAU+C,EAAK9C,KACpC,CAXAmE,EAAegB,QAAQC,UAAU7C,SAAQ,SAASR,GAChDA,EAAMQ,SAAQ,SAASC,GACrB,GAAIA,EAAKC,YAAYU,OAAQ,CAC3B,IAAId,GAAI,IAAAoB,KAAIjB,EAAKC,YAAayC,IAAkB,IAAAzB,KAAIjB,EAAKC,YAAazC,GACtEwC,EAAKH,IAAMA,EAAIW,EAAOR,IAASsC,CACjC,CACF,GACF,GAKF,CAEA,SAASD,IACPV,EAAe5B,SAAQ,SAASR,GAC9B,IAAIS,EACAO,EAGA6B,EAFAS,EAAK,EACLC,EAAIvD,EAAMoB,OAKd,IADApB,EAAMW,KAAK6C,GACNX,EAAI,EAAGA,EAAIU,IAAKV,GAEnB7B,EAAKsC,GADL7C,EAAOT,EAAM6C,IACEvC,GACN,IAAGG,EAAKH,GAAKU,GACtBsC,EAAK7C,EAAKH,EAAIG,EAAKO,GAAKlB,EAK1B,IADAkB,EAAKsC,EAAKxD,EAAcC,EAAK,IACpB,EAIP,IAHAuD,EAAK7C,EAAKH,GAAKU,EAGV6B,EAAIU,EAAI,EAAGV,GAAK,IAAKA,GAExB7B,GADAP,EAAOT,EAAM6C,IACHvC,EAAIG,EAAKO,GAAKlB,EAAcwD,GAC7B,IAAG7C,EAAKH,GAAKU,GACtBsC,EAAK7C,EAAKH,CAGhB,GACF,CAEA,SAASkD,EAAepD,EAAGC,GACzB,OAAOD,EAAEE,EAAID,EAAEC,CACjB,CACF,CAtNEmD,CAAkBnC,GAClBpB,IACON,CACT,EAEAA,EAAO8D,SAAW,WAEhB,OADAxD,IACON,CACT,EAEAA,EAAOmB,KAAO,WACZ,IAAI4C,EAAY,GAEhB,SAAS5C,EAAKuB,GACZ,IC5DkBlC,EAAGC,ED4DjBuD,EAAKtB,EAAEvE,OAAO+D,EAAIQ,EAAEvE,OAAOgE,GAC3B8B,EAAKvB,EAAEtE,OAAO8D,EACdgC,GC7DD1D,IADeA,ED8DSwD,GC7DhBvD,IADUA,ED8DUwD,GC7DZ,SAASE,GAC9B,OAAO3D,GAAK,EAAI2D,GAAK1D,EAAI0D,CAC3B,GD4DQC,EAAKF,EAAGH,GACRM,EAAKH,EAAG,EAAIH,GACZL,EAAKhB,EAAEvE,OAAOuC,EAAIgC,EAAEzB,GAAKyB,EAAEtB,GAAK,EAChCkD,EAAK5B,EAAEtE,OAAOsC,EAAIgC,EAAExB,GAAKwB,EAAEtB,GAAK,EACpC,MAAO,IAAM4C,EAAK,IAAMN,EACjB,IAAMU,EAAK,IAAMV,EACjB,IAAMW,EAAK,IAAMC,EACjB,IAAML,EAAK,IAAMK,CAC1B,CAQA,OANAnD,EAAK4C,UAAY,SAASzC,GACxB,OAAKC,UAAUC,QACfuC,GAAazC,EACNH,GAFuB4C,CAGhC,EAEO5C,CACT,EAwNOnB,CACT,CDlOiBuE,GACZtE,UAAU,IACVC,YAAY,IACZC,KAAK,CAACf,EAAYC,IAEfmF,EAAOxE,EAAOmB,OAEpB,IAAIf,EAAQ,CAAC,EAEb,MAAMC,EAAQpC,EAAK6E,KAAI2B,IACrB,MAAMtD,EAAO,IAAKsD,GAOlB,OANAtD,EAAKhD,OACHiC,EAAMe,EAAKhD,UAAYiC,EAAMe,EAAKhD,QAAU,CAAEuG,KAAMvD,EAAKhD,SAC3DgD,EAAK/C,OACHgC,EAAMe,EAAK/C,UAAYgC,EAAMe,EAAK/C,QAAU,CAAEsG,KAAMvD,EAAK/C,SAC3D+C,EAAK9C,MAAQsG,OAAOxD,EAAK9C,OAElB8C,CAAI,IAwCb,SAASyD,EAAYlC,GACnBlD,EACGqF,MAAK,IApCV,SAAwBnC,GACtB,IAAImC,EAEJ,GAAInC,EAAE5B,YAEJ+D,EAAO,GAAGnC,EAAEgC,kCAAkCjG,EAC5CiE,EAAErE,oBAEC,CACL,MAAMyG,EAAMrG,EAAaiE,EAAErE,OACrB0G,EAAgB7F,IAAAA,MAAUwD,EAAErE,MAAQqE,EAAEvE,OAAOE,MAAS,IAAK,GAC3D2G,EAAgB9F,IAAAA,MAAUwD,EAAErE,MAAQqE,EAAEtE,OAAOC,MAAS,IAAK,GAEjEwG,EAAO,CACL,gDACAC,EACA,gBACA,yBACA,sBACAH,OAAOM,SAASF,GAAiBA,EAAgB,MACjD,eACArC,EAAEvE,OAAOuG,KACT,QACA,sBACEC,OAAOM,SAASD,GAAiBA,EAAgB,mBAEnDtC,EAAEtE,OAAOsG,KACT,UACAQ,KAAK,GACT,CAEA,OAAOL,CACT,CAIgBM,CAAezC,KAC1B0C,aACAC,SAAS,KACZ,MAAQ9G,OAAQ+G,EAAehH,MAAOiH,GAAiB/F,EACpDqB,OACA2E,wBACHhG,EACGG,MACC,OACA,GAAGiC,KAAKoB,IAAI9D,IAAAA,MAASuG,QAAU,GAAInH,EAAQiH,QAE5C5F,MACC,MACA,GAAGiC,KAAKoB,IAAI9D,IAAAA,MAASwG,QAAU,GAAInH,EAAS+G,QAE7C3F,MAAM,WAAY,YAClBA,MAAM,UAAW,IACtB,CAEA,SAASgG,IACPnG,EAAQ4F,aAAaC,SAAS,KAAK1F,MAAM,UAAW,EACtD,CA7DAS,EAAQlB,IAAAA,OAAUkB,GAElBJ,EAAOI,MAAMA,GAAOC,MAAMA,GAAOoB,OAAO,IA6DxC,MAAMN,EAAOvB,EACVH,OAAO,KACPH,UAAU,SACVrB,KAAKoC,GACLuF,QACAnG,OAAO,QACPC,KAAK,QAAS,QACdA,KAAK,IAAK8E,GACV7E,MAAM,gBAAgB+C,GAAKd,KAAKC,IAAI,EAAGa,EAAEtB,MACzCL,MAAK,CAACP,EAAGC,IAAMA,EAAEW,GAAKZ,EAAEY,KACxByE,GAAG,YAAajB,GAChBiB,GAAG,WAAYF,GAclB,SAASG,IAAmB,IAADC,EACzB,MAAMC,EAAoC,OAA5BD,EAAG9G,EAAIK,UAAU,SAAS,IAAEyG,EAAI,GACxCE,GAAsBC,EAAAA,EAAAA,IAAuBF,GAEnDA,EAASpF,SAAQuF,IACf,MAAMC,EAAOD,EAAGE,qBAAqB,QAAQ,GAEzCD,IACEH,EAAoBK,SAASH,GAC/BC,EAAKG,UAAUC,IAAI,aAEnBJ,EAAKG,UAAUhH,OAAO,aAE1B,GAEJ,CAEA,MAAMsB,EAAOjB,EACVH,OAAO,KACPH,UAAU,SACVrB,KAAKmC,GACLwF,QACAnG,OAAO,KACPC,KAAK,QAAS,QACdA,KAAK,aAAagD,GAAK,aAAaA,EAAER,KAAKQ,EAAEhC,OAC7C+F,KACCvH,IAAAA,SACGwH,OACAC,QAAOjE,GAAKA,IACZmD,GAAG,aAAa,WACfe,KAAKC,WAAWpH,OAAOmH,KACzB,IACCf,GAAG,QA5CV,SAAkBnD,GAChBxD,IAAAA,OAAU0H,MAAMlH,KACd,YACA,aAAagD,EAAER,KAAMQ,EAAEhC,EAAIkB,KAAKC,IAC9B,EACAD,KAAKoB,IAAIzE,EAASmE,EAAEtB,GAAIlC,IAAAA,MAASwB,QAGrCV,EAAO8D,WACP3C,EAAKzB,KAAK,IAAK8E,EACjB,IAmCOqB,GAAG,UAAWC,IAGrBjF,EACGpB,OAAO,QACPC,KAAK,UAAUgD,GAAMA,EAAEtB,GAHJ,EAGyBsB,EAAEtB,GAH3B,IAInB1B,KAAK,QAASM,EAAOC,aACrBN,MAAM,QAAQ+C,IACb,MAAMgC,EAAOhC,EAAEgC,MAAQ,MAGvB,OAFAhC,EAAEoE,MAAQjH,EAAQ6E,EAAM1F,GAEjB0D,EAAEoE,KAAK,IAEfnH,MAAM,UAAU+C,GAAKxD,IAAAA,IAAOwD,EAAEoE,OAAOC,OAAO,KAC5ClB,GAAG,YAAajB,GAChBiB,GAAG,WAAYF,GAElB9E,EACGpB,OAAO,QACPC,KAAK,KAAM,GACXA,KAAK,KAAKgD,GAAKA,EAAEtB,GAAK,IACtB1B,KAAK,KAAM,SACXA,KAAK,cAAe,OACpBA,KAAK,YAAa,MAClB0G,MAAK1D,GAAKA,EAAEgC,OACZhF,KAAK,QAAS,aACdsH,QAAOtE,GAAKA,EAAER,EAAI9C,EAAa,IAC/BM,KAAK,IAAK,EAAIM,EAAOC,aACrBP,KAAK,cAAe,SAEvBoG,GACF,CAEAjH,EAAOoI,YAAc,SACrBpI,EAAOb,UAAYA,EAEnB,U,gBGjOA,MAAMkJ,GAAcC,EAAAA,EAAAA,GAASC,GAEvBC,EAAkBA,EAAGC,eAAcC,MACvCC,EAAAA,EAAAA,IAAA,OAAKF,UAAWA,EAAUG,UACxBD,EAAAA,EAAAA,IAACN,EAAW,IAAKK,MAIrBF,EAAgBrJ,UAAY,CAC1BsJ,UAAWpJ,IAAAA,OAAiBwJ,YAG9B,SAAeC,EAAAA,EAAAA,IAAON,EAAgB;IAClC,EAAGO,WAAY,0HAKOA,EAAMC,QAAQC,8IAKPF,EAAMG,OAAOC,UAAUC,iCACjCL,EAAMM,WAAWC,MAAMC,iFAK5BR,EAAMG,OAAOC,UAAUK,mCACfT,EAAMC,QAAQS,wDAEZV,EAAMC,QAAQU,sLAUtBX,EAAMG,OAAOC,UAAUQ,2BACT,EAAjBZ,EAAMa,iCACJb,EAAMM,WAAWC,MAAMC,sBAC3BR,EAAMG,OAAOC,UAAUK,mCACZT,EAAMG,OAAOC,UAAUC;iECjBnC,SAAUd,EACtBuB,EACAC,GAEA,MAAMC,UAA4BC,EAAAA,UAGhCC,WAAAA,CAAY/J,GACVgK,MAAMhK,GAAO,KAHfiK,eAAS,EAIPpC,KAAKqC,gBAAkBrC,KAAKqC,gBAAgBC,KAAKtC,KACnD,CAEAuC,iBAAAA,GACEvC,KAAKwC,SACP,CAEAC,kBAAAA,GACEzC,KAAKwC,SACP,CAEAE,oBAAAA,GACE1C,KAAKoC,eAAYO,EACJ,MAATZ,GAAAA,EAAWW,sBACbX,EAAUW,qBAAqBJ,KAAKtC,KAApC+B,EAEJ,CAEAM,eAAAA,CAAgBO,GACd5C,KAAKoC,UAAYQ,CACnB,CAEAJ,OAAAA,GACMxC,KAAKoC,WACPN,EAAS9B,KAAKoC,UAAWpC,KAAK7H,MAElC,CAEA0K,MAAAA,GACE,MAAM,GAAEC,EAAE,UAAEpC,GAAcV,KAAK7H,MAE/B,OAAOyI,EAAAA,EAAAA,IAAA,OAAKgC,IAAK5C,KAAKqC,gBAAiBS,GAAIA,EAAIpC,UAAWA,GAC5D,EAGF,MAAMqC,EACJf,EAgBF,OAdIF,EAASzB,cACX0C,EAAgB1C,YAAcyB,EAASzB,aAGrCyB,EAAS1K,YACX2L,EAAgB3L,UAAY,IACvB2L,EAAgB3L,aAChB0K,EAAS1K,YAGZ0K,EAASkB,eACXD,EAAgBC,aAAelB,EAASkB,cAGnChB,CACT,C","sources":["webpack://superset/./plugins/legacy-plugin-chart-sankey/src/Sankey.js","webpack://superset/./node_modules/d3-sankey/src/sankey.js","webpack://superset/./node_modules/d3-sankey/node_modules/d3-interpolate/src/number.js","webpack://superset/./plugins/legacy-plugin-chart-sankey/src/ReactSankey.jsx","webpack://superset/./packages/superset-ui-core/src/chart/components/reactify.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable no-param-reassign */\n/* eslint-disable react/sort-prop-types */\nimport d3 from 'd3';\nimport PropTypes from 'prop-types';\nimport { sankey as d3Sankey } from 'd3-sankey';\nimport {\n  getNumberFormatter,\n  NumberFormats,\n  CategoricalColorNamespace,\n} from '@superset-ui/core';\nimport { getOverlappingElements } from './utils';\n\nconst propTypes = {\n  data: PropTypes.arrayOf(\n    PropTypes.shape({\n      source: PropTypes.string,\n      target: PropTypes.string,\n      value: PropTypes.number,\n    }),\n  ),\n  width: PropTypes.number,\n  height: PropTypes.number,\n  colorScheme: PropTypes.string,\n};\n\nconst formatNumber = getNumberFormatter(NumberFormats.FLOAT);\n\nfunction Sankey(element, props) {\n  const { data, width, height, colorScheme, sliceId } = props;\n  const div = d3.select(element);\n  div.classed(`superset-legacy-chart-sankey`, true);\n  const margin = {\n    top: 5,\n    right: 5,\n    bottom: 5,\n    left: 5,\n  };\n  const innerWidth = width - margin.left - margin.right;\n  const innerHeight = height - margin.top - margin.bottom;\n\n  div.selectAll('*').remove();\n  const tooltip = div\n    .append('div')\n    .attr('class', 'sankey-tooltip')\n    .style('opacity', 0);\n  const svg = div\n    .append('svg')\n    .attr('width', innerWidth + margin.left + margin.right)\n    .attr('height', innerHeight + margin.top + margin.bottom)\n    .append('g')\n    .attr('transform', `translate(${margin.left},${margin.top})`);\n  const colorFn = CategoricalColorNamespace.getScale(colorScheme);\n\n  const sankey = d3Sankey()\n    .nodeWidth(15)\n    .nodePadding(10)\n    .size([innerWidth, innerHeight]);\n\n  const path = sankey.link();\n\n  let nodes = {};\n  // Compute the distinct nodes from the links.\n  const links = data.map(row => {\n    const link = { ...row };\n    link.source =\n      nodes[link.source] || (nodes[link.source] = { name: link.source });\n    link.target =\n      nodes[link.target] || (nodes[link.target] = { name: link.target });\n    link.value = Number(link.value);\n\n    return link;\n  });\n  nodes = d3.values(nodes);\n\n  sankey.nodes(nodes).links(links).layout(32);\n\n  function getTooltipHtml(d) {\n    let html;\n\n    if (d.sourceLinks) {\n      // is node\n      html = `${d.name} Value: <span class='emph'>${formatNumber(\n        d.value,\n      )}</span>`;\n    } else {\n      const val = formatNumber(d.value);\n      const sourcePercent = d3.round((d.value / d.source.value) * 100, 1);\n      const targetPercent = d3.round((d.value / d.target.value) * 100, 1);\n\n      html = [\n        \"<div class=''>Path Value: <span class='emph'>\",\n        val,\n        '</span></div>',\n        \"<div class='percents'>\",\n        \"<span class='emph'>\",\n        Number.isFinite(sourcePercent) ? sourcePercent : '100',\n        '%</span> of ',\n        d.source.name,\n        '<br/>',\n        `<span class='emph'>${\n          Number.isFinite(targetPercent) ? targetPercent : '--'\n        }%</span> of `,\n        d.target.name,\n        '</div>',\n      ].join('');\n    }\n\n    return html;\n  }\n\n  function onmouseover(d) {\n    tooltip\n      .html(() => getTooltipHtml(d))\n      .transition()\n      .duration(200);\n    const { height: tooltipHeight, width: tooltipWidth } = tooltip\n      .node()\n      .getBoundingClientRect();\n    tooltip\n      .style(\n        'left',\n        `${Math.min(d3.event.offsetX + 10, width - tooltipWidth)}px`,\n      )\n      .style(\n        'top',\n        `${Math.min(d3.event.offsetY + 10, height - tooltipHeight)}px`,\n      )\n      .style('position', 'absolute')\n      .style('opacity', 0.95);\n  }\n\n  function onmouseout() {\n    tooltip.transition().duration(100).style('opacity', 0);\n  }\n\n  const link = svg\n    .append('g')\n    .selectAll('.link')\n    .data(links)\n    .enter()\n    .append('path')\n    .attr('class', 'link')\n    .attr('d', path)\n    .style('stroke-width', d => Math.max(1, d.dy))\n    .sort((a, b) => b.dy - a.dy)\n    .on('mouseover', onmouseover)\n    .on('mouseout', onmouseout);\n\n  function dragmove(d) {\n    d3.select(this).attr(\n      'transform',\n      `translate(${d.x},${(d.y = Math.max(\n        0,\n        Math.min(height - d.dy, d3.event.y),\n      ))})`,\n    );\n    sankey.relayout();\n    link.attr('d', path);\n  }\n\n  function checkVisibility() {\n    const elements = div.selectAll('.node')[0] ?? [];\n    const overlappingElements = getOverlappingElements(elements);\n\n    elements.forEach(el => {\n      const text = el.getElementsByTagName('text')[0];\n\n      if (text) {\n        if (overlappingElements.includes(el)) {\n          text.classList.add('opacity-0');\n        } else {\n          text.classList.remove('opacity-0');\n        }\n      }\n    });\n  }\n\n  const node = svg\n    .append('g')\n    .selectAll('.node')\n    .data(nodes)\n    .enter()\n    .append('g')\n    .attr('class', 'node')\n    .attr('transform', d => `translate(${d.x},${d.y})`)\n    .call(\n      d3.behavior\n        .drag()\n        .origin(d => d)\n        .on('dragstart', function dragStart() {\n          this.parentNode.append(this);\n        })\n        .on('drag', dragmove)\n        .on('dragend', checkVisibility),\n    );\n  const minRectHeight = 5;\n  node\n    .append('rect')\n    .attr('height', d => (d.dy > minRectHeight ? d.dy : minRectHeight))\n    .attr('width', sankey.nodeWidth())\n    .style('fill', d => {\n      const name = d.name || 'N/A';\n      d.color = colorFn(name, sliceId);\n\n      return d.color;\n    })\n    .style('stroke', d => d3.rgb(d.color).darker(2))\n    .on('mouseover', onmouseover)\n    .on('mouseout', onmouseout);\n\n  node\n    .append('text')\n    .attr('x', -6)\n    .attr('y', d => d.dy / 2)\n    .attr('dy', '.35em')\n    .attr('text-anchor', 'end')\n    .attr('transform', null)\n    .text(d => d.name)\n    .attr('class', 'opacity-0')\n    .filter(d => d.x < innerWidth / 2)\n    .attr('x', 6 + sankey.nodeWidth())\n    .attr('text-anchor', 'start');\n\n  checkVisibility();\n}\n\nSankey.displayName = 'Sankey';\nSankey.propTypes = propTypes;\n\nexport default Sankey;\n","import {ascending, min, sum} from \"d3-array\";\nimport {nest} from \"d3-collection\";\nimport {interpolateNumber} from \"d3-interpolate\";\n\nexport default function() {\n  var sankey = {},\n      nodeWidth = 24,\n      nodePadding = 8,\n      size = [1, 1],\n      nodes = [],\n      links = [];\n\n  sankey.nodeWidth = function(_) {\n    if (!arguments.length) return nodeWidth;\n    nodeWidth = +_;\n    return sankey;\n  };\n\n  sankey.nodePadding = function(_) {\n    if (!arguments.length) return nodePadding;\n    nodePadding = +_;\n    return sankey;\n  };\n\n  sankey.nodes = function(_) {\n    if (!arguments.length) return nodes;\n    nodes = _;\n    return sankey;\n  };\n\n  sankey.links = function(_) {\n    if (!arguments.length) return links;\n    links = _;\n    return sankey;\n  };\n\n  sankey.size = function(_) {\n    if (!arguments.length) return size;\n    size = _;\n    return sankey;\n  };\n\n  sankey.layout = function(iterations) {\n    computeNodeLinks();\n    computeNodeValues();\n    computeNodeBreadths();\n    computeNodeDepths(iterations);\n    computeLinkDepths();\n    return sankey;\n  };\n\n  sankey.relayout = function() {\n    computeLinkDepths();\n    return sankey;\n  };\n\n  sankey.link = function() {\n    var curvature = .5;\n\n    function link(d) {\n      var x0 = d.source.x + d.source.dx,\n          x1 = d.target.x,\n          xi = interpolateNumber(x0, x1),\n          x2 = xi(curvature),\n          x3 = xi(1 - curvature),\n          y0 = d.source.y + d.sy + d.dy / 2,\n          y1 = d.target.y + d.ty + d.dy / 2;\n      return \"M\" + x0 + \",\" + y0\n           + \"C\" + x2 + \",\" + y0\n           + \" \" + x3 + \",\" + y1\n           + \" \" + x1 + \",\" + y1;\n    }\n\n    link.curvature = function(_) {\n      if (!arguments.length) return curvature;\n      curvature = +_;\n      return link;\n    };\n\n    return link;\n  };\n\n  // Populate the sourceLinks and targetLinks for each node.\n  // Also, if the source and target are not objects, assume they are indices.\n  function computeNodeLinks() {\n    nodes.forEach(function(node) {\n      node.sourceLinks = [];\n      node.targetLinks = [];\n    });\n    links.forEach(function(link) {\n      var source = link.source,\n          target = link.target;\n      if (typeof source === \"number\") source = link.source = nodes[link.source];\n      if (typeof target === \"number\") target = link.target = nodes[link.target];\n      source.sourceLinks.push(link);\n      target.targetLinks.push(link);\n    });\n  }\n\n  // Compute the value (size) of each node by summing the associated links.\n  function computeNodeValues() {\n    nodes.forEach(function(node) {\n      node.value = Math.max(\n        sum(node.sourceLinks, value),\n        sum(node.targetLinks, value)\n      );\n    });\n  }\n\n  // Iteratively assign the breadth (x-position) for each node.\n  // Nodes are assigned the maximum breadth of incoming neighbors plus one;\n  // nodes with no incoming links are assigned breadth zero, while\n  // nodes with no outgoing links are assigned the maximum breadth.\n  function computeNodeBreadths() {\n    var remainingNodes = nodes,\n        nextNodes,\n        x = 0;\n\n    while (remainingNodes.length) {\n      nextNodes = [];\n      remainingNodes.forEach(function(node) {\n        node.x = x;\n        node.dx = nodeWidth;\n        node.sourceLinks.forEach(function(link) {\n          if (nextNodes.indexOf(link.target) < 0) {\n            nextNodes.push(link.target);\n          }\n        });\n      });\n      remainingNodes = nextNodes;\n      ++x;\n    }\n\n    //\n    moveSinksRight(x);\n    scaleNodeBreadths((size[0] - nodeWidth) / (x - 1));\n  }\n\n  // function moveSourcesRight() {\n  //   nodes.forEach(function(node) {\n  //     if (!node.targetLinks.length) {\n  //       node.x = min(node.sourceLinks, function(d) { return d.target.x; }) - 1;\n  //     }\n  //   });\n  // }\n\n  function moveSinksRight(x) {\n    nodes.forEach(function(node) {\n      if (!node.sourceLinks.length) {\n        node.x = x - 1;\n      }\n    });\n  }\n\n  function scaleNodeBreadths(kx) {\n    nodes.forEach(function(node) {\n      node.x *= kx;\n    });\n  }\n\n  function computeNodeDepths(iterations) {\n    var nodesByBreadth = nest()\n        .key(function(d) { return d.x; })\n        .sortKeys(ascending)\n        .entries(nodes)\n        .map(function(d) { return d.values; });\n\n    //\n    initializeNodeDepth();\n    resolveCollisions();\n    for (var alpha = 1; iterations > 0; --iterations) {\n      relaxRightToLeft(alpha *= .99);\n      resolveCollisions();\n      relaxLeftToRight(alpha);\n      resolveCollisions();\n    }\n\n    function initializeNodeDepth() {\n      var ky = min(nodesByBreadth, function(nodes) {\n        return (size[1] - (nodes.length - 1) * nodePadding) / sum(nodes, value);\n      });\n\n      nodesByBreadth.forEach(function(nodes) {\n        nodes.forEach(function(node, i) {\n          node.y = i;\n          node.dy = node.value * ky;\n        });\n      });\n\n      links.forEach(function(link) {\n        link.dy = link.value * ky;\n      });\n    }\n\n    function relaxLeftToRight(alpha) {\n      nodesByBreadth.forEach(function(nodes) {\n        nodes.forEach(function(node) {\n          if (node.targetLinks.length) {\n            var y = sum(node.targetLinks, weightedSource) / sum(node.targetLinks, value);\n            node.y += (y - center(node)) * alpha;\n          }\n        });\n      });\n\n      function weightedSource(link) {\n        return center(link.source) * link.value;\n      }\n    }\n\n    function relaxRightToLeft(alpha) {\n      nodesByBreadth.slice().reverse().forEach(function(nodes) {\n        nodes.forEach(function(node) {\n          if (node.sourceLinks.length) {\n            var y = sum(node.sourceLinks, weightedTarget) / sum(node.sourceLinks, value);\n            node.y += (y - center(node)) * alpha;\n          }\n        });\n      });\n\n      function weightedTarget(link) {\n        return center(link.target) * link.value;\n      }\n    }\n\n    function resolveCollisions() {\n      nodesByBreadth.forEach(function(nodes) {\n        var node,\n            dy,\n            y0 = 0,\n            n = nodes.length,\n            i;\n\n        // Push any overlapping nodes down.\n        nodes.sort(ascendingDepth);\n        for (i = 0; i < n; ++i) {\n          node = nodes[i];\n          dy = y0 - node.y;\n          if (dy > 0) node.y += dy;\n          y0 = node.y + node.dy + nodePadding;\n        }\n\n        // If the bottommost node goes outside the bounds, push it back up.\n        dy = y0 - nodePadding - size[1];\n        if (dy > 0) {\n          y0 = node.y -= dy;\n\n          // Push any overlapping nodes back up.\n          for (i = n - 2; i >= 0; --i) {\n            node = nodes[i];\n            dy = node.y + node.dy + nodePadding - y0;\n            if (dy > 0) node.y -= dy;\n            y0 = node.y;\n          }\n        }\n      });\n    }\n\n    function ascendingDepth(a, b) {\n      return a.y - b.y;\n    }\n  }\n\n  function computeLinkDepths() {\n    nodes.forEach(function(node) {\n      node.sourceLinks.sort(ascendingTargetDepth);\n      node.targetLinks.sort(ascendingSourceDepth);\n    });\n    nodes.forEach(function(node) {\n      var sy = 0, ty = 0;\n      node.sourceLinks.forEach(function(link) {\n        link.sy = sy;\n        sy += link.dy;\n      });\n      node.targetLinks.forEach(function(link) {\n        link.ty = ty;\n        ty += link.dy;\n      });\n    });\n\n    function ascendingSourceDepth(a, b) {\n      return a.source.y - b.source.y;\n    }\n\n    function ascendingTargetDepth(a, b) {\n      return a.target.y - b.target.y;\n    }\n  }\n\n  function center(node) {\n    return node.y + node.dy / 2;\n  }\n\n  function value(link) {\n    return link.value;\n  }\n\n  return sankey;\n}\n","export default function(a, b) {\n  return a = +a, b = +b, function(t) {\n    return a * (1 - t) + b * t;\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { reactify, styled } from '@superset-ui/core';\nimport PropTypes from 'prop-types';\nimport SanKey from './Sankey';\n\nconst ReactSanKey = reactify(SanKey);\n\nconst SankeyComponent = ({ className, ...otherProps }) => (\n  <div className={className}>\n    <ReactSanKey {...otherProps} />\n  </div>\n);\n\nSankeyComponent.propTypes = {\n  className: PropTypes.string.isRequired,\n};\n\nexport default styled(SankeyComponent)`\n  ${({ theme }) => `\n    .superset-legacy-chart-sankey {\n      .node {\n        rect {\n          cursor: move;\n          fill-opacity: ${theme.opacity.heavy};\n          shape-rendering: crispEdges;\n        }\n        text {\n          pointer-events: none;\n          text-shadow: 0 1px 0 ${theme.colors.grayscale.light5};\n          font-size: ${theme.typography.sizes.s}px;\n        }\n      }\n      .link {\n        fill: none;\n        stroke: ${theme.colors.grayscale.dark2};\n        stroke-opacity: ${theme.opacity.light};\n        &:hover {\n          stroke-opacity: ${theme.opacity.mediumLight};\n        }\n      }\n      .opacity-0 {\n        opacity: 0;\n      }\n    }\n    .sankey-tooltip {\n      position: absolute;\n      width: auto;\n      background: ${theme.colors.grayscale.light2};\n      padding: ${theme.gridUnit * 3}px;\n      font-size: ${theme.typography.sizes.s}px;\n      color: ${theme.colors.grayscale.dark2};\n      border: 1px solid ${theme.colors.grayscale.light5};\n      text-align: center;\n      pointer-events: none;\n    }\n  `}\n`;\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n// eslint-disable-next-line no-restricted-syntax -- whole React import is required for `reactify.test.tsx` Jest test passing.\nimport React, { Component, ComponentClass, WeakValidationMap } from 'react';\n\n// TODO: Note that id and className can collide between Props and ReactifyProps\n// leading to (likely) unexpected behaviors. We should either require Props to not\n// contain an id/className, or not combine them (via intersection), instead preferring\n// wrapping (composition). As an example:\n// interface MyProps {\n//   id: number;\n// }\n// function myRender(container: HTMLDivElement, props: Readonly<MyProps>): void {\n//   props.id // unusable: id is string & number\n// }\n// new (reactify(myRender))({ id: 5 }); // error: id has to be string & number\n\nexport type ReactifyProps = {\n  id?: string;\n  className?: string;\n};\n\n// TODO: add more React lifecycle callbacks as needed\nexport type LifeCycleCallbacks = {\n  componentWillUnmount?: () => void;\n};\n\nexport interface RenderFuncType<Props> {\n  (container: HTMLDivElement, props: Readonly<Props & ReactifyProps>): void;\n  displayName?: string;\n  defaultProps?: Partial<Props & ReactifyProps>;\n  propTypes?: WeakValidationMap<Props & ReactifyProps>;\n}\n\nexport default function reactify<Props extends object>(\n  renderFn: RenderFuncType<Props>,\n  callbacks?: LifeCycleCallbacks,\n): ComponentClass<Props & ReactifyProps> {\n  class ReactifiedComponent extends Component<Props & ReactifyProps> {\n    container?: HTMLDivElement;\n\n    constructor(props: Props & ReactifyProps) {\n      super(props);\n      this.setContainerRef = this.setContainerRef.bind(this);\n    }\n\n    componentDidMount() {\n      this.execute();\n    }\n\n    componentDidUpdate() {\n      this.execute();\n    }\n\n    componentWillUnmount() {\n      this.container = undefined;\n      if (callbacks?.componentWillUnmount) {\n        callbacks.componentWillUnmount.bind(this)();\n      }\n    }\n\n    setContainerRef(ref: HTMLDivElement) {\n      this.container = ref;\n    }\n\n    execute() {\n      if (this.container) {\n        renderFn(this.container, this.props);\n      }\n    }\n\n    render() {\n      const { id, className } = this.props;\n\n      return <div ref={this.setContainerRef} id={id} className={className} />;\n    }\n  }\n\n  const ReactifiedClass: ComponentClass<Props & ReactifyProps> =\n    ReactifiedComponent;\n\n  if (renderFn.displayName) {\n    ReactifiedClass.displayName = renderFn.displayName;\n  }\n  // eslint-disable-next-line react/forbid-foreign-prop-types\n  if (renderFn.propTypes) {\n    ReactifiedClass.propTypes = {\n      ...ReactifiedClass.propTypes,\n      ...renderFn.propTypes,\n    };\n  }\n  if (renderFn.defaultProps) {\n    ReactifiedClass.defaultProps = renderFn.defaultProps;\n  }\n\n  return ReactifiedComponent;\n}\n"],"names":["propTypes","data","PropTypes","source","target","value","width","height","colorScheme","formatNumber","getNumberFormatter","NumberFormats","FLOAT","Sankey","element","props","sliceId","div","d3","classed","innerWidth","innerHeight","selectAll","remove","tooltip","append","attr","style","svg","colorFn","CategoricalColorNamespace","getScale","sankey","nodeWidth","nodePadding","size","nodes","links","computeLinkDepths","ascendingSourceDepth","a","b","y","ascendingTargetDepth","forEach","node","sourceLinks","sort","targetLinks","sy","ty","link","dy","center","_","arguments","length","layout","iterations","push","Math","max","sum","nextNodes","kx","remainingNodes","x","dx","indexOf","moveSinksRight","computeNodeBreadths","ky","nodesByBreadth","key","d","sortKeys","ascending","entries","map","values","min","i","resolveCollisions","alpha","relaxRightToLeft","relaxLeftToRight","weightedSource","weightedTarget","slice","reverse","y0","n","ascendingDepth","computeNodeDepths","relayout","curvature","x0","x1","xi","t","x2","x3","y1","d3Sankey","path","row","name","Number","onmouseover","html","val","sourcePercent","targetPercent","isFinite","join","getTooltipHtml","transition","duration","tooltipHeight","tooltipWidth","getBoundingClientRect","offsetX","offsetY","onmouseout","enter","on","checkVisibility","_div$selectAll$","elements","overlappingElements","getOverlappingElements","el","text","getElementsByTagName","includes","classList","add","call","drag","origin","this","parentNode","color","darker","filter","displayName","ReactSanKey","reactify","SanKey","SankeyComponent","className","otherProps","_jsx","children","isRequired","styled","theme","opacity","heavy","colors","grayscale","light5","typography","sizes","s","dark2","light","mediumLight","light2","gridUnit","renderFn","callbacks","ReactifiedComponent","Component","constructor","super","container","setContainerRef","bind","componentDidMount","execute","componentDidUpdate","componentWillUnmount","undefined","ref","render","id","ReactifiedClass","defaultProps"],"sourceRoot":""}
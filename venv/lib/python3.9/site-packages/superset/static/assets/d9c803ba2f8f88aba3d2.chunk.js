"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[8366],{334634:(t,e,o)=>{o.d(e,{F:()=>g});var n=o(618446),a=o.n(n),r=o(667294),l=o(490530),i=o(516145),s=o(785716),c=o(751995),u=o(332103),d=o(135944);const p=c.iK.div`
  ${({theme:t,top:e,left:o})=>`\n    position: absolute;\n    top: ${e}px;\n    left: ${o}px;\n    padding: ${2*t.gridUnit}px;\n    margin: ${2*t.gridUnit}px;\n    background: ${t.colors.grayscale.dark2};\n    color: ${t.colors.grayscale.light5};\n    maxWidth: 300px;\n    fontSize: ${t.typography.sizes.s}px;\n    zIndex: 9;\n    pointerEvents: none;\n  `}
`;function h(t){const{tooltip:e}=t;if(null==e)return null;const{x:o,y:n,content:a}=e,r="string"==typeof a?(0,u.Ul)(a):a;return(0,d.tZ)(p,{top:n,left:o,children:r})}const f=(0,r.memo)((0,r.forwardRef)(((t,e)=>{const[o,n]=(0,r.useState)(null),[c,u]=(0,r.useState)(null),[p,f]=(0,r.useState)(t.viewport),g=(0,s.D)(t.viewport);(0,r.useImperativeHandle)(e,(()=>({setTooltip:n})),[]);const m=(0,r.useCallback)((()=>{if(c&&Date.now()-c>250){const e=t.setControlValue;e&&e("viewport",p),u(null)}}),[c,t.setControlValue,p]);(0,r.useEffect)((()=>{const t=setInterval(m,250);return clearInterval(t)}),[m]),(0,r.useEffect)((()=>{a()(t.viewport,g)||f(t.viewport)}),[g,t.viewport]);const y=(0,r.useCallback)((({viewState:t})=>{f(t),u(Date.now())}),[]),b=(0,r.useCallback)((()=>t.layers.some((t=>"function"==typeof t))?t.layers.map((t=>"function"==typeof t?t():t)):t.layers),[t.layers]),{children:v=null,height:w,width:x}=t;return(0,d.BX)(d.HY,{children:[(0,d.BX)("div",{style:{position:"relative",width:x,height:w},children:[(0,d.tZ)(i.Z,{controller:!0,width:x,height:w,layers:b(),viewState:p,glOptions:{preserveDrawingBuffer:!0},onViewStateChange:y,children:(0,d.tZ)(l.Z3,{preserveDrawingBuffer:!0,mapStyle:t.mapStyle||"light",mapboxApiAccessToken:t.mapboxApiAccessToken})}),v]}),(0,d.tZ)(h,{tooltip:o})]})}))),g=(0,c.iK)(f)`
  .deckgl-tooltip > div {
    overflow: hidden;
    text-overflow: ellipsis;
  }
`},51805:(t,e,o)=>{o.d(e,{Z:()=>a});var n=o(135944);const a=({label:t,value:e})=>(0,n.BX)("div",{children:[t,(0,n.tZ)("strong",{children:e})]})},570325:(t,e,o)=>{o.d(e,{Z:()=>u});var n=o(667294),a=o(751995),r=o(767190),l=o(135944);const i=a.iK.div`
  ${({theme:t})=>`\n    font-size: ${t.typography.sizes.s}px;\n    position: absolute;\n    background: ${t.colors.grayscale.light5};\n    box-shadow: 0 0 ${t.gridUnit}px ${t.colors.grayscale.light2};\n    margin: ${6*t.gridUnit}px;\n    padding: ${3*t.gridUnit}px ${5*t.gridUnit}px;\n    outline: none;\n    overflow-y: scroll;\n    max-height: 200px;\n\n    & ul {\n      list-style: none;\n      padding-left: 0;\n      margin: 0;\n\n      & li a {\n        display: flex;\n        color: ${t.colors.grayscale.base};\n        text-decoration: none;\n        padding: ${t.gridUnit}px 0;\n\n        & span {\n          margin-right: ${t.gridUnit}px;\n        }\n      }\n    }\n  `}
`,s=" - ",c=({format:t=null,forceCategorical:e=!1,position:o="tr",categories:n={},toggleCategory:a=(()=>{}),showSingleCategory:c=(()=>{})})=>{const u=o=>{if(!t||e)return o;const n=parseFloat(o);return(0,r.uf)(t,n)},d=e=>{if(!t)return e;if(e.includes(s)){const t=e.split(s);return u(t[0])+s+u(t[1])}return u(e)};if(0===Object.keys(n).length||null===o)return null;const p=Object.entries(n).map((([t,e])=>{const o={color:`rgba(${e.color.join(", ")})`},n=e.enabled?"◼":"◻";return(0,l.tZ)("li",{children:(0,l.BX)("a",{href:"#",role:"button",onClick:()=>a(t),onDoubleClick:()=>c(t),children:[(0,l.tZ)("span",{style:o,children:n})," ",d(t)]})},t)})),h={position:"absolute",["t"===(null==o?void 0:o.charAt(0))?"top":"bottom"]:"0px",["r"===(null==o?void 0:o.charAt(1))?"right":"left"]:"10px"};return(0,l.tZ)(i,{className:"dupa",style:h,children:(0,l.tZ)("ul",{children:p})})},u=(0,n.memo)(c)},589691:(t,e,o)=>{o.d(e,{B:()=>v,G:()=>b});var n=o(618446),a=o.n(n),r=o(667294),l=o(785716),i=o(334634),s=o(328062),c=o(570325),u=o(889503),d=o(363241),p=o(340461),h=o(135944);const{getScale:f}=s;function g(t,e){const o=t.color_picker||{r:0,g:0,b:0,a:1},n=[o.r,o.g,o.b,255*o.a],a=t.color_scheme,r=f(a),l={};return e.forEach((e=>{if(null!=e.cat_color&&!l.hasOwnProperty(e.cat_color)){let a;a=t.dimension?(0,u.hexToRGB)(r(e.cat_color,t.sliceId),255*o.a):n,l[e.cat_color]={color:a,enabled:!0}}})),l}const m=t=>{const e=(0,r.useRef)(null),o=(0,r.useCallback)((()=>{let e={...t.viewport};return t.formData.autozoom&&(e=(0,p.Z)(e,{width:t.width,height:t.height,points:t.getPoints(t.payload.data.features||[])})),e.zoom<0&&(e.zoom=0),e}),[t]),[n,a]=(0,r.useState)(g(t.formData,t.payload.data.features||[])),[l,s]=(0,r.useState)(t.payload.form_data),[m,y]=(0,r.useState)(o());(0,r.useEffect)((()=>{if(t.payload.form_data!==l){const e=t.payload.data.features||[],n=g(t.formData,e);y(o()),s(t.payload.form_data),a(n)}}),[o,t,l]);const b=(0,r.useCallback)((t=>{const{current:o}=e;o&&o.setTooltip(t)}),[]),v=(0,r.useCallback)(((t,e)=>{const o=e.color_picker||{r:0,g:0,b:0,a:1},n=e.color_scheme,a=f(n);return t.map((t=>{let n;return e.dimension?(n=(0,u.hexToRGB)(a(t.cat_color,e.sliceId),255*o.a),{...t,color:n}):t}))}),[]),w=(0,r.useCallback)((()=>{const{getLayer:e,payload:o,formData:a,onAddFilter:r}=t;let l=o.data.features?[...o.data.features]:[];return l=v(l,a),a.js_data_mutator&&(l=(0,d.Z)(a.js_data_mutator)(l)),a.dimension&&(l=l.filter((t=>{var e;return null==(e=n[t.cat_color])?void 0:e.enabled}))),[e(a,{...o,data:{...o.data,features:l}},r,b,t.datasource)]}),[v,n,t,b]),x=(0,r.useCallback)((t=>{const e=n[t],o={...n,[t]:{...e,enabled:!e.enabled}};Object.values(o).every((t=>!t.enabled))&&Object.values(o).forEach((t=>{t.enabled=!0})),a(o)}),[n]),k=(0,r.useCallback)((t=>{const e={...n};Object.values(e).forEach((t=>{t.enabled=!1})),e[t].enabled=!0,a(e)}),[n]);return(0,h.BX)("div",{style:{position:"relative"},children:[(0,h.tZ)(i.F,{ref:e,viewport:m,layers:w(),setControlValue:t.setControlValue,mapStyle:t.formData.mapbox_style,mapboxApiAccessToken:t.mapboxApiKey,width:t.width,height:t.height}),(0,h.tZ)(c.Z,{forceCategorical:!0,categories:n,format:t.formData.legend_format,position:t.formData.legend_position,showSingleCategory:k,toggleCategory:x})]})},y=(0,r.memo)(m);function b(t,e){return(0,r.memo)((o=>{const n=(0,r.useRef)(),s=(0,l.D)(o.formData),c=(0,l.D)(o.payload),[u,d]=(0,r.useState)((()=>{const{width:t,height:n,formData:a}=o;return a.autozoom?(0,p.Z)(o.viewport,{width:t,height:n,points:e(o.payload.data.features)}):o.viewport})()),f=(0,r.useCallback)((t=>{const{current:e}=n;e&&(null==e||e.setTooltip(t))}),[]),g=(0,r.useCallback)((e=>{const{formData:o,payload:n,onAddFilter:a}=e;return t(o,n,a,f)}),[f]),[m,y]=(0,r.useState)(g(o));(0,r.useEffect)((()=>{const t={...s,viewport:null},e={...o.formData,viewport:null};a()(t,e)&&c===o.payload||y(g(o))}),[g,s,c,o]);const{formData:b,payload:v,setControlValue:w,height:x,width:k}=o;return(0,h.tZ)(i.F,{ref:n,mapboxApiAccessToken:v.data.mapboxApiKey,viewport:u,layers:[m],mapStyle:b.mapbox_style,setControlValue:w,width:k,height:x,onViewportChange:d})}))}function v(t,e){return function(o){const{datasource:n,formData:a,height:r,payload:l,setControlValue:i,viewport:s,width:c}=o;return(0,h.tZ)(y,{datasource:n,formData:a,mapboxApiKey:l.data.mapboxApiKey,setControlValue:i,viewport:s,getLayer:t,payload:l,getPoints:e,width:c,height:r})}}},58371:(t,e,o)=>{o.d(e,{N:()=>r,Z:()=>i});var n=o(804065),a=o(363241);function r(t,e,o,n){const r=t;let l,i,s=o;return r.js_tooltip&&(s=(0,a.Z)(r.js_tooltip)),s&&(l=t=>(t.picked?e({content:s(t),x:t.x,y:t.y}):e(null),!0)),r.js_onclick_href?i=t=>{const e=(0,a.Z)(r.js_onclick_href)(t);return window.open(e),!0}:r.table_filter&&void 0!==n&&(i=t=>(n(t.object[r.line_column]),!0)),{onClick:i,onHover:l,pickable:Boolean(l)}}const l={p1:.01,p5:.05,p95:.95,p99:.99};function i(t="sum",e=null){if("count"===t)return t=>t.length;let o;return o=t in l?(o,a)=>{let r;return r=e?o.sort(((t,o)=>n.ascending(e(t),e(o)))):o.sort(n.ascending),n.quantile(r,l[t],a)}:n[t],e?t=>o(t.map((t=>e(t)))):t=>o(t)}},889503:(t,e,o)=>{o.r(e),o.d(e,{hexToRGB:()=>a});var n=o(250667);function a(t,e=255){if(!t)return[0,0,0,e];const{r:o,g:a,b:r}=(0,n.B8)(t);return[o,a,r,e]}},340461:(t,e,o)=>{o.d(e,{Z:()=>s});var n=o(517013),a=o(804065);const r=[-90,90],l=[-180,180];function i([t,e],[o,n],a=.25){return t<e?[t,e]:[Math.max(o,t-a),Math.min(n,e+a)]}function s(t,{points:e,width:o,height:s,minExtent:c,maxZoom:u,offset:d,padding:p=20}){const{bearing:h,pitch:f}=t,g=function(t){const e=i((0,a.extent)(t,(t=>t[1])),r),o=i((0,a.extent)(t,(t=>t[0])),l);return[[o[0],e[0]],[o[1],e[1]]]}(e);try{return{...(0,n.Xg)({bounds:g,width:o,height:s,minExtent:c,maxZoom:u,offset:d,padding:p}),bearing:h,pitch:f}}catch(t){console.error("Could not fit viewport",t)}return t}},363241:(t,e,o)=>{o.d(e,{Z:()=>c});var n=o(455140),a=o.n(n),r=o(59050),l=o(804065),i=o(889503);const s={console,_:r.ZP,colors:i,d3array:l};function c(t,e,o){const n={},r=`SAFE_EVAL_${Math.floor(1e6*Math.random())}`;n[r]={};const l=`${r}=${t}`,i={...s,...e};Object.keys(i).forEach((t=>{n[t]=i[t]}));try{return a().runInNewContext(l,n,o),n[r]}catch(t){return()=>t}}}}]);
//# sourceMappingURL=d9c803ba2f8f88aba3d2.chunk.js.map